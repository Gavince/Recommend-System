<div class="post-inner"><div class="post-inner-content __reader_view_article_wrap_475967129820986__"><p>自 Embedding 的概念问世以来，Embedding 的探索和应用就没有停止过，Word2Vec、Sentence2Vec、Doc2Vec、Item2Vec，甚至 Everything2Vec。对，“万物皆可 Embedding”。几年来，Embedding 在推荐系统中的应用也越来越多，方式众多，技法新颖。</p><p>在之前的文章中，<a href="https://lumingdong.cn/text-content-analysis-algorithms.html">《文本内容分析算法》</a>和 <a href="https://lumingdong.cn/recommendation-algorithm-based-on-matrix-decomposition.html">《基于矩阵分解的推荐算法》</a>文中都稍有提及 Embedding 的概念，由于 Embedding 太过重要，本文我们将详细讲解 Embedding 的相关知识，以及在推荐系统中的一些应用，因篇幅限制，关于 Embedding 在推荐系统中的应用实践我分为了两篇文章来讲述，本篇主讲 Embedding 以及相关延伸方法，另外一篇是大厂的 Embedding 实践应用，是更加偏 tricks 的一些应用实践总结。</p><div id="ez-toc-container" class="counter-hierarchy counter-decimal"><div class="ez-toc-title-container"><p class="ez-toc-title">目录</p> <span class="ez-toc-title-toggle"><a class="ez-toc-pull-right ez-toc-btn ez-toc-btn-xs ez-toc-btn-default ez-toc-toggle"><i class="ez-toc-glyphicon ez-toc-icon-toggle"></i></a></span></div><nav><ul class="ez-toc-list"><li><a href="#Embedding的理解" title="Embedding的理解">Embedding的理解</a></li><li><a href="#Word2Vec" title="Word2Vec">Word2Vec</a><ul><li><a href="#Word2Vec的原理" title="Word2Vec的原理">Word2Vec的原理</a></li><li><a href="#Word2Vec的网络结构" title="Word2Vec的网络结构">Word2Vec的网络结构</a></li><li><a href="#从权重矩阵到词向量" title="从权重矩阵到词向量">从权重矩阵到词向量</a></li><li><a href="#Word2Vec的优化方法" title="Word2Vec的优化方法">Word2Vec的优化方法</a></li><li><a href="#Word2Vec在推荐中的应用" title="Word2Vec在推荐中的应用">Word2Vec在推荐中的应用</a></li></ul></li><li><a href="#Item2Vec" title="Item2Vec">Item2Vec</a><ul><li><a href="#从Word2Vec到Item2Vec" title="从Word2Vec到Item2Vec">从Word2Vec到Item2Vec</a></li><li><a href="#端到端和非端到端的Embedding" title="端到端和非端到端的Embedding">端到端和非端到端的Embedding</a></li><li><a href="#Embedding质量的评估" title="Embedding质量的评估">Embedding质量的评估</a></li></ul></li><li><a href="#Graph_Embedding" title="Graph Embedding">Graph Embedding</a><ul><li><a href="#DeepWalk" title="DeepWalk">DeepWalk</a></li><li><a href="#LINE" title="LINE">LINE</a></li><li><a href="#Node2Vec" title="Node2Vec">Node2Vec</a></li><li><a href="#EGES" title="EGES">EGES</a></li></ul></li><li><a href="#总结" title="总结">总结</a></li><li><a href="#参考资料" title="参考资料">参考资料</a></li></ul></nav></div><h2 id="Embedding的理解"><em>1.</em><span class="ez-toc-section" id="Embedding的理解">Embedding的理解</span></h2><p>Embedding，即嵌入，起先源自于 NLP 领域，称为<strong>词嵌入（word embedding）</strong>，主要是利用背景信息构建词汇的分布式表示，最终可以可以得到一种词的向量化表达，即用一个抽象的稠密向量来表征一个词。</p><p>Embedding 在数学上表示一个映射（mapping），也是一个函数（function），即 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-1-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1" style="width: 5.806em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.616em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1004.62em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2"><span class="mi" id="MathJax-Span-3" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-4" style="font-family: MathJax_Main; padding-left: 0.3em;">:</span><span class="mi" id="MathJax-Span-5" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-6" style="font-family: MathJax_Main; padding-left: 0.3em;">→</span><span class="mi" id="MathJax-Span-7" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-1">f: X \rightarrow Y</script>， 其中该函数是 injective（就是我们所说的单射函数，每个 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-2-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-8" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.8em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-9"><span class="mi" id="MathJax-Span-10" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-2">Y</script> 只有唯一的 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-3-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-11" style="width: 1.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.85em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-12"><span class="mi" id="MathJax-Span-13" style="font-family: MathJax_Math-italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-3">X</script> 对应，反之亦然）和 structure-preserving（结构保存，比如在 X 所属的空间上 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-4-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-14" style="width: 4.913em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.872em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1003.87em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-15"><span class="msubsup" id="MathJax-Span-16"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.85em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-17" style="font-family: MathJax_Math-italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.846em;"><span class="mn" id="MathJax-Span-18" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-19" style="font-family: MathJax_Main; padding-left: 0.3em;">&lt;</span><span class="msubsup" id="MathJax-Span-20" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.85em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-21" style="font-family: MathJax_Math-italic;">X<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.846em;"><span class="mn" id="MathJax-Span-22" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-4">X_1 < X_2</script>, 那么映射后在 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-5-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-23" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.8em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-24"><span class="mi" id="MathJax-Span-25" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5">Y</script> 所属空间上同理 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-6-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-26" style="width: 4.268em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.375em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1003.38em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-27"><span class="msubsup" id="MathJax-Span-28"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-29" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-30" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-31" style="font-family: MathJax_Main; padding-left: 0.3em;">&lt;</span><span class="msubsup" id="MathJax-Span-32" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-33" style="font-family: MathJax_Math-italic;">Y<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-34" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-6">Y_1 < Y_2</script>）的。那么对于 word embedding，就是将单词 word 映射到另外一个空间，其中这个映射具有 injective 和 structure-preserving 的特点。</p><p>“嵌入” 本身是一个数学概念。我们这里通俗理解，<strong>如果将词看作是文本的最小单元，词嵌入本身是一种特别的映射过程，即将文本空间中的某个词，通过一定的方法，映射或者说嵌入到另一个数值向量空间，原来的整数全部变为实数，是用连续向量表示离散变量的方法。之所以称之为 embedding，是因为这种表示方法往往伴随着一种降维的意思，就像高维事物拍扁了嵌入到另一个低维空间中一样。</strong></p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174058.jpg" alt="" width="504" height="355" /></noscript><img class="aligncenter ls-is-cached lazyloaded" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174058.jpg" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174058.jpg" alt="" width="504" height="355"></p><p>Embedding 这种向量化表达过程通常伴随以下变化：</p><ul><li>高维——&gt; 低维</li><li>稀疏——&gt; 稠密</li><li>离散——&gt; 连续</li><li>整数——&gt; 实数</li></ul><p>不难发现，<strong>经过 Embedding 向量化表达后的数据，其实变得更加适合深度神经网络的训练和学习，也有利于工业界数据的工程化处理。</strong><u>高维稀疏数据对于机器学习的参数学习和相关计算都不太友好</u>（<strong>高维易引发 “维度之灾”，使空间距离很难有效衡量，另外高维经常使参数数量变得非常多，计算复杂度增加，也容易导致过拟合；稀疏容易造成梯度消失，导致无法有效完成参数学习</strong>），因此通常特别稀疏的离散数据更适合使用 Embedding 代替传统 One-Hot 编码方式。</p><p>此外，<strong>Embedding 虽然是一种降维表示，但是却携带了语义信息，而且这种表示方式并不局限于词，可以是句子、文档、物品、人等等，Embedding 能够很好地挖掘嵌入实体间的内部关联，即便降维也能保留这种潜在关系</strong>，这简直就是 “神来之笔”，怪不得说万物皆可 Embedding。</p><p><u>词嵌入的维度表示某个隐含语义</u>，一个词可能隐藏很多语义信息，比如北京，可能包含 “首都、中国、北方、直辖市、大城市” 等等，这些语义在所有文本上是有限的，比如 128 个，于是每个词就用一个 128 维的向量表达，<u>向量中各个维度上的值大小代表了词包含各个语义的多少。</u></p><p>本质上来说，经过 <strong>Word Embedding</strong> 之后，各个单词就组合成了一个相对低维空间上的一组向量，这些向量之间的远近关系则由他们之间的语义关系决定。</p><p>因为上面提到的特性，使用 Embedding 可带来诸多好处：</p><ul><li>不丢失信息的情况下降低维度</li><li>矩阵及向量运行便于并行</li><li>向量空间具有物理意义，比如可以根据距离比较相似性</li><li>可以在多个不同的维度上具有相似性</li><li>线性规则：king - man = queen - woman</li></ul><p>Embedding 的这种携带语义信息以及保留嵌入实体间的潜在关系的特性，使 Embedding 有了更多用武之地，例如：</p><ul><li><strong>计算相似度</strong>，比如 <strong>man</strong> 和 <strong>woman</strong> 的相似度比 <strong>man</strong> 和 <strong>apple</strong> 的相似度高</li><li><strong>在一组单词中找出与众不同的一个</strong>，例如在如下词汇列表中：<strong>[dog, cat, chicken, boy]</strong>，利用词向量可以识别出 <strong>boy</strong> 和其他三个词不是一类。</li><li><strong>直接进行词的运算</strong>，例如经典的：<strong>woman + king - man = queen</strong></li><li><strong>表征文本</strong>，如累加得到一个文本的稠密向量，或平均表征一个更大的主体；</li><li><strong>方便聚类</strong>，会得到比使用词向量聚类更好的语义聚类效果。</li><li><strong>由于携带了语义信息，还可以计算一段文字出现的可能性</strong>，也就是说，这段文字是否<strong>通顺</strong>。</li></ul><p>上面的嵌入实体是单词，如果换成推荐物品（item），上面的一些用法，是不是让你眼前一亮呢？</p><h2 id="Word2Vec"><em>2.</em><span class="ez-toc-section" id="Word2Vec">Word2Vec</span></h2><p>📚 <a href="https://lumingdong.cn/go/r2g083" rel="nofollow,noindex noopener noreferrer" target="_blank">Distributed Representations of Words and Phrases and their Compositionality</a></p><p>📚 <a href="https://lumingdong.cn/go/ns6cqn" rel="nofollow,noindex noopener noreferrer" target="_blank">word2vec Parameter Learning Explained</a></p><p>📚 <a href="https://lumingdong.cn/go/le1abn" rel="nofollow,noindex noopener noreferrer" target="_blank">word2vec Explained: deriving Mikolov et al.'s negative-sampling word-embedding method</a></p><p>词嵌入表示通常会用到谷歌提出的 Word2Vec 工具库，另外 <u>fastText</u> 和 <u>TensorFlow</u> 中也可以实现 Embedding 的功能。这个小节我们借助 Word2Vec 工具的模型实现来更加深入理解 Embedding。</p><h3 id="Word2Vec的原理"><em>2.1.</em><span class="ez-toc-section" id="Word2Vec的原理">Word2Vec的原理</span></h3><p>Word2Vec 是用浅层神经网络学习得到每个词的向量表达，而且在工程上进行了优化，使得百万词的规模在单机上可以几分钟轻松跑出来。它有两种网络结构，分别是 CBOW（Continues Bag of Words）和 Skip-gram，两种网络结构图见下图。</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174145.jpg" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174145.jpg" alt=""></p><p>这两种结构都是假定每个词都跟其相邻的词的关系最密切，不同的是 CBOW 模型的动机是每个词都是由相邻的词决定的，所以 CBOW 的输入是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-7-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-35" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.04em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-36"><span class="msubsup" id="MathJax-Span-37"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-38" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-39" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-7">w_t</script> 周边的词，预测的输出是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-8-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-40" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.04em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-41"><span class="msubsup" id="MathJax-Span-42"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-43" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-44" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-8">w_t </script> ，而 Skip-gram 模型的动机则是每个词都决定了相邻的词，输入是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-9-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-45" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.04em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-46"><span class="msubsup" id="MathJax-Span-47"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-48" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-49" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-9">w_t</script> ，输出是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-10-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-50" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.04em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-51"><span class="msubsup" id="MathJax-Span-52"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-53" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-54" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-10">w_t</script> 周边的词。这里相邻的词通常由一个滑动窗口来获得，滑动窗口的长度为 2c+1（目标词前后各选 c 个词），从句子左边滑倒右边，每滑一次，窗口中的词就形成了我们的一个正样本。如上图，这里的 c 设为 2，其中 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-11-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-55" style="width: 2.334em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.838em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1001.74em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-56"><span class="mi" id="MathJax-Span-57" style="font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-58" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-59" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-60" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-11">w(t)</script> 是当前所关注的词，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-12-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-61" style="width: 4.467em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.524em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1003.42em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-62"><span class="mi" id="MathJax-Span-63" style="font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-64" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-65" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-66" style="font-family: MathJax_Main; padding-left: 0.201em;">−</span><span class="mn" id="MathJax-Span-67" style="font-family: MathJax_Main; padding-left: 0.201em;">2</span><span class="mo" id="MathJax-Span-68" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-12">w(t−2)</script>、<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-13-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-69" style="width: 4.467em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.524em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1003.42em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-70"><span class="mi" id="MathJax-Span-71" style="font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-72" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-73" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-74" style="font-family: MathJax_Main; padding-left: 0.201em;">−</span><span class="mn" id="MathJax-Span-75" style="font-family: MathJax_Main; padding-left: 0.201em;">1</span><span class="mo" id="MathJax-Span-76" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-13">w(t−1)</script>、<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-14-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-77" style="width: 4.467em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.524em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1003.42em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-78"><span class="mi" id="MathJax-Span-79" style="font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-80" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-81" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-82" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="mn" id="MathJax-Span-83" style="font-family: MathJax_Main; padding-left: 0.201em;">1</span><span class="mo" id="MathJax-Span-84" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-14">w(t+1)</script>、<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-15-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-85" style="width: 4.467em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.524em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1003.42em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-86"><span class="mi" id="MathJax-Span-87" style="font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-88" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-89" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-90" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="mn" id="MathJax-Span-91" style="font-family: MathJax_Main; padding-left: 0.201em;">2</span><span class="mo" id="MathJax-Span-92" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-15">w(t+2)</script> 是上下文中出现的词。</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174215.jpg" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174215.jpg" alt=""></p><p><u>经验上讲 Skip-gram 的效果要更好一点</u>，我们以 Skip-gram 为例，理解一下原理。上面讲到通过滑动窗口可以获取到训练样本，有了训练样本之后我们就可以着手定义优化目标了，既然每个词 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-16-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-93" style="width: 5.707em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.516em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1004.42em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-94"><span class="mi" id="MathJax-Span-95" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-96" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-97"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-98" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="texatom" id="MathJax-Span-99"><span class="mrow" id="MathJax-Span-100"><span class="mi" id="MathJax-Span-101" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-102" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mi" id="MathJax-Span-103" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="texatom" id="MathJax-Span-104"><span class="mrow" id="MathJax-Span-105"><span class="mo" id="MathJax-Span-106" style="font-family: MathJax_Main;">|</span></span></span><span class="msubsup" id="MathJax-Span-107"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-108" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-109" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-110" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-16">p(w_{t+j}|w_t)</script> 都决定了相邻词 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-17-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-111" style="width: 2.383em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.89em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-112"><span class="msubsup" id="MathJax-Span-113"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-114" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="texatom" id="MathJax-Span-115"><span class="mrow" id="MathJax-Span-116"><span class="mi" id="MathJax-Span-117" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-118" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mi" id="MathJax-Span-119" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-17">w_{t+j}</script>，基于极大似然，我们希望所有样本的条件概率 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-18-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-120" style="width: 5.707em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.516em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1004.42em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-121"><span class="mi" id="MathJax-Span-122" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-123" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-124"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-125" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="texatom" id="MathJax-Span-126"><span class="mrow" id="MathJax-Span-127"><span class="mi" id="MathJax-Span-128" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-129" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mi" id="MathJax-Span-130" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="texatom" id="MathJax-Span-131"><span class="mrow" id="MathJax-Span-132"><span class="mo" id="MathJax-Span-133" style="font-family: MathJax_Main;">|</span></span></span><span class="msubsup" id="MathJax-Span-134"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-135" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-136" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-137" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-18">p(w_{t+j}|w_t)</script> 之积最大，于是有：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-19-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-138" style="width: 19.497em; display: inline-block;"><span style="display: inline-block; position: relative; width: 15.479em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.548em, 1015.38em, 3.971em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-139"><span class="msubsup" id="MathJax-Span-140"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.65em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-141" style="font-family: MathJax_Math-italic;">J<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.697em;"><span class="mi" id="MathJax-Span-142" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-143" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-144" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-145" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-146" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="munderover" id="MathJax-Span-147" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.292em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.24em, 4.616em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-148" style="font-family: MathJax_Size2; vertical-align: 0em;">∏</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.09em, 4.268em, -999.998em); top: -2.924em; left: 0.052em;"><span class="texatom" id="MathJax-Span-149"><span class="mrow" id="MathJax-Span-150"><span class="mi" id="MathJax-Span-151" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-152" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-153" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.276em, 1000.5em, 4.169em, -999.998em); top: -5.156em; left: 0.399em;"><span class="mi" id="MathJax-Span-154" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-155" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 3.971em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.24em, 4.616em, -999.998em); top: -4.015em; left: 1.342em;"><span class="mo" id="MathJax-Span-156" style="font-family: MathJax_Size2; vertical-align: 0em;">∏</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1003.92em, 4.417em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-157"><span class="mrow" id="MathJax-Span-158"><span class="mo" id="MathJax-Span-159" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-160" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-161" style="font-size: 70.7%; font-family: MathJax_Main;">≤</span><span class="mi" id="MathJax-Span-162" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-163" style="font-size: 70.7%; font-family: MathJax_Main;">≤</span><span class="mi" id="MathJax-Span-164" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-165" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-166" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-167" style="font-size: 70.7%; font-family: MathJax_Main;">≠</span><span class="mn" id="MathJax-Span-168" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-169" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">p</span><span class="mo" id="MathJax-Span-170" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-171"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-172" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="texatom" id="MathJax-Span-173"><span class="mrow" id="MathJax-Span-174"><span class="mi" id="MathJax-Span-175" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-176" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mi" id="MathJax-Span-177" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-178" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="msubsup" id="MathJax-Span-179" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-180" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-181" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-182" style="font-family: MathJax_Main;">;</span><span class="mspace" id="MathJax-Span-183" style="height: 0em; vertical-align: 0em; width: 0.3em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-184" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">θ</span><span class="mo" id="MathJax-Span-185" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.809em; border-left: 0px solid; width: 0px; height: 4.066em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-19">J^\prime (\theta) = \prod_{t=1}^T \prod_{-c\le j \le c,j \ne0} p(w_{t+j} \mid w_t ;\; \theta)</script></p><p>转为<u>最大化对数似然</u>：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-20-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-186" style="width: 19.596em; display: inline-block;"><span style="display: inline-block; position: relative; width: 15.528em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.548em, 1015.43em, 3.971em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-187"><span class="mi" id="MathJax-Span-188" style="font-family: MathJax_Math-italic;">J<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-189" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-190" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-191" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-192" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="munderover" id="MathJax-Span-193" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-194" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.09em, 4.268em, -999.998em); top: -2.924em; left: 0.151em;"><span class="texatom" id="MathJax-Span-195"><span class="mrow" id="MathJax-Span-196"><span class="mi" id="MathJax-Span-197" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-198" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-199" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.276em, 1000.5em, 4.169em, -999.998em); top: -5.156em; left: 0.499em;"><span class="mi" id="MathJax-Span-200" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-201" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 3.971em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 1.243em;"><span class="mo" id="MathJax-Span-202" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1003.92em, 4.417em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-203"><span class="mrow" id="MathJax-Span-204"><span class="mo" id="MathJax-Span-205" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-206" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-207" style="font-size: 70.7%; font-family: MathJax_Main;">≤</span><span class="mi" id="MathJax-Span-208" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-209" style="font-size: 70.7%; font-family: MathJax_Main;">≤</span><span class="mi" id="MathJax-Span-210" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-211" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-212" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-213" style="font-size: 70.7%; font-family: MathJax_Main;">≠</span><span class="mn" id="MathJax-Span-214" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-215" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-216"></span><span class="mi" id="MathJax-Span-217" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">p</span><span class="mo" id="MathJax-Span-218" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-219"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-220" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="texatom" id="MathJax-Span-221"><span class="mrow" id="MathJax-Span-222"><span class="mi" id="MathJax-Span-223" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-224" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mi" id="MathJax-Span-225" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-226" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="msubsup" id="MathJax-Span-227" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-228" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-229" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-230" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.809em; border-left: 0px solid; width: 0px; height: 4.066em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-20">J(\theta) = \sum_{t=1}^T \sum_{-c\le j \le c, j \ne0} \log p(w_{t+j} \mid w_t)</script></p><p>其中，T 是文本长度，即单词总数，c 是窗口大小，另外<u>单词一般需要先用 One-Hot 编码</u>。</p><p>其实从上面的图中可以看出，在实际训练学习过程中，训练样本是由中心词和其上下文词组成一个个 Pair 对，那我们可以将目标函数写成一个更容易理解的的式子：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-21-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-231" style="width: 13.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.518em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.342em, 1010.42em, 4.02em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-232"><span class="mi" id="MathJax-Span-233" style="font-family: MathJax_Main;">arg</span><span class="mo" id="MathJax-Span-234"></span><span class="munder" id="MathJax-Span-235" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.84em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-236" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.35em, 4.268em, -999.998em); top: -3.321em; left: 0.747em;"><span class="mi" id="MathJax-Span-237" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-238" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.598em;"><span class="mo" id="MathJax-Span-239" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-240"><span class="mrow" id="MathJax-Span-241"><span class="mo" id="MathJax-Span-242" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-243" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-244" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-245" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-246" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-247" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-248" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-249" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-250"></span><span class="mi" id="MathJax-Span-251" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">p</span><span class="mo" id="MathJax-Span-252" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-253" style="font-family: MathJax_Math-italic;">c</span><span class="texatom" id="MathJax-Span-254"><span class="mrow" id="MathJax-Span-255"><span class="mo" id="MathJax-Span-256" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-257" style="font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-258" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.872em; border-left: 0px solid; width: 0px; height: 3.128em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-21">\arg \underset{\theta}{\max} \sum_{(w, c) \in D} \log p(c|w)</script></p><p>其中，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-22-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-259" style="width: 3.028em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.383em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1002.28em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-260"><span class="mo" id="MathJax-Span-261" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-262" style="font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-263" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-264" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">c</span><span class="mo" id="MathJax-Span-265" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-22">(w, c)</script> 表示中心词 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-23-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-266" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.65em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-267"><span class="mi" id="MathJax-Span-268" style="font-family: MathJax_Math-italic;">w</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-23">w</script> 与其上下文词 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-24-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-269" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.45em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-270"><span class="mi" id="MathJax-Span-271" style="font-family: MathJax_Math-italic;">c</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-24">c</script> 构成的样本对，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-25-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-272" style="width: 1.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.8em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-273"><span class="mi" id="MathJax-Span-274" style="font-family: MathJax_Math-italic;">D</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-25">D</script> 是语料中所有单词及其上下文词构成的样本对集合，这里的 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-26-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-275" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.45em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-276"><span class="mi" id="MathJax-Span-277" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-26">\theta</script> 为<strong>待定参数集</strong>。</p><p>接下来的问题是怎么定义 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-27-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-278" style="width: 3.475em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1002.63em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-279"><span class="mi" id="MathJax-Span-280" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-281" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-282" style="font-family: MathJax_Math-italic;">c</span><span class="texatom" id="MathJax-Span-283"><span class="mrow" id="MathJax-Span-284"><span class="mo" id="MathJax-Span-285" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-286" style="font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-287" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-27">p(c|w)</script> ，作为一个多分类问题，最简单最直接的方法当然是直接用 Softmax 函数，同时我们希望用隐向量来表示每个词。</p><p>于是设 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-28-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-288" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.04em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-289"><span class="msubsup" id="MathJax-Span-290"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-291" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-292" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-28">v_w</script> 为中心词 w 的词向量，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-29-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-293" style="width: 1.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.85em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-294"><span class="msubsup" id="MathJax-Span-295"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-296" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-297" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-29">v_c</script> 为上下文词 c 向量，向量维度等于设置的隐藏层单元数量。整个语料共有 V 个单词，也就是词汇表单词数。</p><p>因此：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-30-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-298" style="width: 27.185em; display: inline-block;"><span style="display: inline-block; position: relative; width: 21.58em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.796em, 1021.58em, 3.822em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-299"><span class="mi" id="MathJax-Span-300" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-301" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-302" style="font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-303" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="mi" id="MathJax-Span-304" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">w</span><span class="mo" id="MathJax-Span-305" style="font-family: MathJax_Main;">;</span><span class="mi" id="MathJax-Span-306" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">θ</span><span class="mo" id="MathJax-Span-307" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-308" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="texatom" id="MathJax-Span-309" style="padding-left: 0.3em;"><span class="mrow" id="MathJax-Span-310"><span class="mi" id="MathJax-Span-311" style="font-family: MathJax_Main;">S</span><span class="mi" id="MathJax-Span-312" style="font-family: MathJax_Main;">o</span><span class="mi" id="MathJax-Span-313" style="font-family: MathJax_Main;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mi" id="MathJax-Span-314" style="font-family: MathJax_Main;">t</span><span class="mi" id="MathJax-Span-315" style="font-family: MathJax_Main;">m</span><span class="mi" id="MathJax-Span-316" style="font-family: MathJax_Main;">a</span><span class="mi" id="MathJax-Span-317" style="font-family: MathJax_Main;">x</span></span></span><span class="mo" id="MathJax-Span-318" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-319"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-320" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-321" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-322" style="font-family: MathJax_Main; padding-left: 0.201em;">⋅</span><span class="msubsup" id="MathJax-Span-323" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-324" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-325" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-326" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-327" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-328" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 7.393em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.127em, 1004.81em, 4.417em, -999.998em); top: -4.71em; left: 50%; margin-left: -2.478em;"><span class="mrow" id="MathJax-Span-329"><span class="mi" id="MathJax-Span-330" style="font-family: MathJax_Main;">exp</span><span class="mo" id="MathJax-Span-331"></span><span class="mo" id="MathJax-Span-332" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-333"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-334" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-335" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-336" style="font-family: MathJax_Main; padding-left: 0.201em;">⋅</span><span class="msubsup" id="MathJax-Span-337" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-338" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-339" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-340" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.929em, 1007.2em, 4.467em, -999.998em); top: -3.073em; left: 50%; margin-left: -3.619em;"><span class="mrow" id="MathJax-Span-341"><span class="munderover" id="MathJax-Span-342"><span style="display: inline-block; position: relative; width: 2.284em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1001em, 4.417em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-343" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.6em, 4.169em, -999.998em); top: -4.511em; left: 1.044em;"><span class="mi" id="MathJax-Span-344" style="font-size: 70.7%; font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.151em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.24em, 4.169em, -999.998em); top: -3.718em; left: 1.044em;"><span class="texatom" id="MathJax-Span-345"><span class="mrow" id="MathJax-Span-346"><span class="mi" id="MathJax-Span-347" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-348" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-349" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-350" style="font-family: MathJax_Main; padding-left: 0.151em;">exp</span><span class="mo" id="MathJax-Span-351"></span><span class="mo" id="MathJax-Span-352" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-353"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-354" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-355" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-356" style="font-family: MathJax_Main; padding-left: 0.201em;">⋅</span><span class="msubsup" id="MathJax-Span-357" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-358" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-359" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-360" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1007.39em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 7.393em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.622em; border-left: 0px solid; width: 0px; height: 3.503em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-30">p(c \mid w; \theta) = \mathrm{Softmax} (v_w \cdot v_c) = \frac{\exp(v_w \cdot v_c)} {\sum_{i=1}^V \exp(v_w \cdot v_i)}</script></p><p>带入上面的目标函数，可以得到：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-31-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-361" style="width: 31.649em; display: inline-block;"><span style="display: inline-block; position: relative; width: 25.102em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.548em, 1025em, 4.02em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-362"><span class="mi" id="MathJax-Span-363" style="font-family: MathJax_Main;">arg</span><span class="mo" id="MathJax-Span-364"></span><span class="munder" id="MathJax-Span-365" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.84em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-366" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.35em, 4.268em, -999.998em); top: -3.321em; left: 0.747em;"><span class="mi" id="MathJax-Span-367" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-368" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.598em;"><span class="mo" id="MathJax-Span-369" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-370"><span class="mrow" id="MathJax-Span-371"><span class="mo" id="MathJax-Span-372" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-373" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-374" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-375" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-376" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-377" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-378" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-379" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-380"></span><span class="mi" id="MathJax-Span-381" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">p</span><span class="mo" id="MathJax-Span-382" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-383" style="font-family: MathJax_Math-italic;">c</span><span class="texatom" id="MathJax-Span-384"><span class="mrow" id="MathJax-Span-385"><span class="mo" id="MathJax-Span-386" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-387" style="font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-388" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-389" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="munderover" id="MathJax-Span-390" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.598em;"><span class="mo" id="MathJax-Span-391" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-392"><span class="mrow" id="MathJax-Span-393"><span class="mo" id="MathJax-Span-394" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-395" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-396" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-397" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-398" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-399" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-400" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-401" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-402" style="font-family: MathJax_Main;">log</span><span class="mo" id="MathJax-Span-403"></span><span class="msubsup" id="MathJax-Span-404" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.086em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-405" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.449em;"><span class="texatom" id="MathJax-Span-406"><span class="mrow" id="MathJax-Span-407"><span class="msubsup" id="MathJax-Span-408"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-409" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-410" style="font-size: 50%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-411" style="font-size: 70.7%; font-family: MathJax_Main;">⋅</span><span class="msubsup" id="MathJax-Span-412"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-413" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-414" style="font-size: 50%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-415" style="font-family: MathJax_Main; padding-left: 0.201em;">−</span><span class="mi" id="MathJax-Span-416" style="font-family: MathJax_Main; padding-left: 0.201em;">log</span><span class="mo" id="MathJax-Span-417"></span><span class="munderover" id="MathJax-Span-418" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-419" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.09em, 4.268em, -999.998em); top: -2.924em; left: 0.151em;"><span class="texatom" id="MathJax-Span-420"><span class="mrow" id="MathJax-Span-421"><span class="mi" id="MathJax-Span-422" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-423" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-424" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.276em, 1000.55em, 4.169em, -999.998em); top: -5.156em; left: 0.449em;"><span class="mi" id="MathJax-Span-425" style="font-size: 70.7%; font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.151em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-426" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.086em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-427" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.449em;"><span class="texatom" id="MathJax-Span-428"><span class="mrow" id="MathJax-Span-429"><span class="msubsup" id="MathJax-Span-430"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-431" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-432" style="font-size: 50%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-433" style="font-size: 70.7%; font-family: MathJax_Main;">⋅</span><span class="msubsup" id="MathJax-Span-434"><span style="display: inline-block; position: relative; width: 0.548em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-435" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-436" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-437" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.872em; border-left: 0px solid; width: 0px; height: 4.128em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-31">\arg \underset{\theta}{\max} \sum_{(w, c) \in D} \log p(c|w)=\sum_{(w, c) \in D}(\log e^{v_w \cdot v_c}-\log \sum_{i=1}^V e^{v_w \cdot v_i})</script></p><p>其中，参数 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-32-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-438" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.45em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-439"><span class="mi" id="MathJax-Span-440" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-32">\theta</script> 是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-33-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-441" style="width: 1.639em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.292em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.29em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-442"><span class="msubsup" id="MathJax-Span-443"><span style="display: inline-block; position: relative; width: 1.292em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-444" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="texatom" id="MathJax-Span-445"><span class="mrow" id="MathJax-Span-446"><span class="msubsup" id="MathJax-Span-447"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-448" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.499em;"><span class="mi" id="MathJax-Span-449" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-33">v_{w_i}</script> 和 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-34-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-450" style="width: 1.391em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.09em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-451"><span class="msubsup" id="MathJax-Span-452"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-453" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="texatom" id="MathJax-Span-454"><span class="mrow" id="MathJax-Span-455"><span class="msubsup" id="MathJax-Span-456"><span style="display: inline-block; position: relative; width: 0.548em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.3em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-457" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.3em;"><span class="mi" id="MathJax-Span-458" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-34">v_{c_i}</script>，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-35-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-459" style="width: 6.104em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.814em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1004.81em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-460"><span class="mi" id="MathJax-Span-461" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-462" style="font-family: MathJax_Main; padding-left: 0.3em;">∈</span><span class="mn" id="MathJax-Span-463" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-464" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-465" style="font-family: MathJax_Main; padding-left: 0.151em;">⋯</span><span class="mo" id="MathJax-Span-466" style="font-family: MathJax_Main; padding-left: 0.151em;">,</span><span class="mi" id="MathJax-Span-467" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-35">i \in 1, \cdots, d</script>，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-36-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-468" style="width: 0.697em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.548em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.55em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-469"><span class="mi" id="MathJax-Span-470" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-36">d</script> 是向量维度。</p><p>这两个单词的隐向量的点积表示语义的接近程度，其实点积的物理意义就是词之间的距离，点积越大，表明两个单词的语义越接近，向量点积展开如下：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-37-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-471" style="width: 19.1em; display: inline-block;"><span style="display: inline-block; position: relative; width: 15.131em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.548em, 1015.13em, 3.772em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-472"><span class="msubsup" id="MathJax-Span-473"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-474" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-475" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-476" style="font-family: MathJax_Main; padding-left: 0.201em;">⋅</span><span class="msubsup" id="MathJax-Span-477" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-478" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-479" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-480" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-481" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-482" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.499em;"><span class="mi" id="MathJax-Span-483" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-484" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-485"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-486" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-487" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-488" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-489" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-490" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.475em, 1000.25em, 4.12em, -999.998em); top: -4.313em; left: 0.499em;"><span class="mo" id="MathJax-Span-491" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-492" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-493"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-494" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-495" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-496" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="munderover" id="MathJax-Span-497" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-498" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.09em, 4.268em, -999.998em); top: -2.924em; left: 0.151em;"><span class="texatom" id="MathJax-Span-499"><span class="mrow" id="MathJax-Span-500"><span class="mi" id="MathJax-Span-501" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-502" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-503" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.276em, 1000.35em, 4.169em, -999.998em); top: -5.156em; left: 0.548em;"><span class="mi" id="MathJax-Span-504" style="font-size: 70.7%; font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-505" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-506" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.3em, 4.169em, -999.998em); top: -4.363em; left: 0.499em;"><span class="mi" id="MathJax-Span-507" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-508" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-509" style="font-family: MathJax_Main; padding-left: 0.201em;">×</span><span class="msubsup" id="MathJax-Span-510" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-511" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.3em, 4.169em, -999.998em); top: -4.363em; left: 0.499em;"><span class="mi" id="MathJax-Span-512" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.4em, 4.169em, -999.998em); top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-513" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.559em; border-left: 0px solid; width: 0px; height: 3.816em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-37">v_w \cdot v_c=v_w^Tv_c=v_w'v_c = \sum_{i=1}^d v_w^i \times v_c^i</script></p><p>（注：向量点积在不同的论文有不同的表示形式，本文为了推导后面的负例采样优化，写法与第三篇论文的写法保持一致。）</p><p>而 Softmax 的作用就是将点积转换成概率，下图的例子可以辅助理解<sup class="md-footnote"><a href="#dfref-footnote-1" name="ref-footnote-1">1</a></sup>：</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729155502.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729155502.png" alt=""></p><h3 id="Word2Vec的网络结构"><em>2.2.</em><span class="ez-toc-section" id="Word2Vec的网络结构">Word2Vec的网络结构</span></h3><p>CBOW 和 Skip-gram 都可以表示成由输入层（Input）、映射层（Projection）和输出层（Output）组成的神经网络。</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174236.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174236.png" alt=""></p><p>输入层中的每个词通常由独热编码（One-Hot）方式表示，即所有词均表示成一个 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-38-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-514" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.8em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-515"><span class="mi" id="MathJax-Span-516" style="font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-38">V</script> 维向量，其中 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-39-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-517" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.8em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-518"><span class="mi" id="MathJax-Span-519" style="font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-39">V</script> 为词汇表中单词的总数。在向量中，每个词都将与之对应的维度置为 1，其余维度的值均设为 0。</p><p>在映射层（也就是隐含层）中，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-40-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-520" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.89em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-521"><span class="mi" id="MathJax-Span-522" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-40">N</script> 个隐含单元（Hidden Units）的取值可以由 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-41-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-523" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.8em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-524"><span class="mi" id="MathJax-Span-525" style="font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-41">V</script> 维输入向量以及连接输入和隐含单元之间的 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-42-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-526" style="width: 3.624em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.879em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1002.88em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-527"><span class="mi" id="MathJax-Span-528" style="font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span><span class="mo" id="MathJax-Span-529" style="font-family: MathJax_Main; padding-left: 0.201em;">×</span><span class="mi" id="MathJax-Span-530" style="font-family: MathJax_Math-italic; padding-left: 0.201em;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-42">V×N</script> 维权重矩阵 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-43-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-531" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1001.04em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-532"><span class="mi" id="MathJax-Span-533" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-43">W</script> 计算得到。在 CBOW 中，还需要将各个输入词所计算出的隐含单元求和。需注意的是，<strong>Word2Vec 网络中的隐含层没有使用任何非线性激活函数，或者可以勉强说用的是线性激活函数（Linear Activation Function）。因为 Word2Vec 不是为了做语言模型，它不需要预测的更准，加入非线性激活函数没有什么实际意义，反而会降低 Word2Vec 的性能。</strong></p><p>同理，输出层向量的值可以通过隐含层向量，以及连接隐含层和输出层之间的 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-44-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-534" style="width: 3.624em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.879em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1002.88em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-535"><span class="mi" id="MathJax-Span-536" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-537" style="font-family: MathJax_Main; padding-left: 0.201em;">×</span><span class="mi" id="MathJax-Span-538" style="font-family: MathJax_Math-italic; padding-left: 0.201em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-44">N\times V</script> 维权重矩阵 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-45-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-539" style="width: 1.788em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.391em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1001.39em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-540"><span class="msup" id="MathJax-Span-541"><span style="display: inline-block; position: relative; width: 1.391em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-542" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 1.143em;"><span class="mo" id="MathJax-Span-543" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-45">W’</script> 计算得到。输出层也是一个 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-46-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-544" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.8em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-545"><span class="mi" id="MathJax-Span-546" style="font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-46">V</script> 维向量，每维与词汇表中的一个单词相对应。最后，对输出层向量应用 Softmax 激活函数，可以计算出每个单词的生成概率。</p><p>再之后，利用反向传播来训练神经网络的权重即可。</p><p>不过上图的网络结构是单个上下文的一个示例，即当前词预测下一个词，对于真正的多词上下文的 CBOW 和 Skip-gram，通常是下面的结构：</p><p><a href="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174249.jpg"><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174249.jpg" alt="" width="837" height="663" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20837%20663%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174249.jpg" alt="" width="837" height="663"></a></p><p>以 Skip-gram 模型为例，其前向传播公式为：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-47-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-547" style="width: 33.881em; display: inline-block;"><span style="display: inline-block; position: relative; width: 26.887em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.052em, 1026.89em, 4.318em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-548"><span class="mtable" id="MathJax-Span-549"><span style="display: inline-block; position: relative; width: 26.59em; height: 0px; margin-right: 0.151em; margin-left: 0.151em;"><span style="position: absolute; clip: rect(2.532em, 1002.04em, 6.55em, -999.998em); top: -4.71em; left: 0em;"><span style="display: inline-block; position: relative; width: 2.086em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.64em, 4.169em, -999.998em); top: -5.355em; right: 0em;"><span class="mtd" id="MathJax-Span-550"><span class="mrow" id="MathJax-Span-551"><span class="texatom" id="MathJax-Span-552"><span class="mrow" id="MathJax-Span-553"><span class="mtext" id="MathJax-Span-554" style="font-family: MathJax_Main-bold;">h</span></span></span><span class="mo" id="MathJax-Span-555" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1002.04em, 4.318em, -999.998em); top: -3.966em; right: 0em;"><span class="mtd" id="MathJax-Span-565"><span class="mrow" id="MathJax-Span-566"><span class="msubsup" id="MathJax-Span-567"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.65em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="texatom" id="MathJax-Span-568"><span class="mrow" id="MathJax-Span-569"><span class="mtext" id="MathJax-Span-570" style="font-family: MathJax_Main-bold;">u</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.647em;"><span class="mi" id="MathJax-Span-571" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-572" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1002.04em, 4.417em, -999.998em); top: -2.577em; right: 0em;"><span class="mtd" id="MathJax-Span-604"><span class="mrow" id="MathJax-Span-605"><span class="msubsup" id="MathJax-Span-606"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.6em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="texatom" id="MathJax-Span-607"><span class="mrow" id="MathJax-Span-608"><span class="mtext" id="MathJax-Span-609" style="font-family: MathJax_Main-bold;">y</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.767em; left: 0.598em;"><span class="mi" id="MathJax-Span-610" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-611" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.715em;"></span></span><span style="position: absolute; clip: rect(2.532em, 1024.51em, 6.798em, -999.998em); top: -4.908em; left: 2.086em;"><span style="display: inline-block; position: relative; width: 24.506em; height: 0px;"><span style="position: absolute; clip: rect(2.979em, 1019.94em, 4.169em, -999.998em); top: -5.355em; left: 50%; margin-left: -9.968em;"><span class="mtd" id="MathJax-Span-556"><span class="mrow" id="MathJax-Span-557"><span class="msubsup" id="MathJax-Span-558"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-559" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 1.143em;"><span class="mi" id="MathJax-Span-560" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="texatom" id="MathJax-Span-561"><span class="mrow" id="MathJax-Span-562"><span class="mtext" id="MathJax-Span-563" style="font-family: MathJax_Main-bold;">x</span></span></span><span class="mspace" id="MathJax-Span-564" style="height: 0em; vertical-align: 0em; width: 17.612em; display: inline-block; overflow: hidden;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.979em, 1022.17em, 4.368em, -999.998em); top: -3.966em; left: 50%; margin-left: -11.109em;"><span class="mtd" id="MathJax-Span-573"><span class="mrow" id="MathJax-Span-574"><span class="msubsup" id="MathJax-Span-575"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-576" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 1.143em;"><span class="mrow" id="MathJax-Span-577"><span class="mo" id="MathJax-Span-578" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span class="mi" id="MathJax-Span-579" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="texatom" id="MathJax-Span-580"><span class="mrow" id="MathJax-Span-581"><span class="mtext" id="MathJax-Span-582" style="font-family: MathJax_Main-bold;">h</span></span></span><span class="mo" id="MathJax-Span-583" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-584" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-585" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 1.143em;"><span class="mrow" id="MathJax-Span-586"><span class="mo" id="MathJax-Span-587" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span class="mi" id="MathJax-Span-588" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-589"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-590" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 1.143em;"><span class="mi" id="MathJax-Span-591" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="texatom" id="MathJax-Span-592"><span class="mrow" id="MathJax-Span-593"><span class="mtext" id="MathJax-Span-594" style="font-family: MathJax_Main-bold;">x</span></span></span><span class="mspace" id="MathJax-Span-595" style="height: 0em; vertical-align: 0em; width: 7.493em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-596" style="font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-597" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-598" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-599" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-600" style="font-family: MathJax_Main; padding-left: 0.151em;">…</span><span class="mo" id="MathJax-Span-601" style="font-family: MathJax_Main; padding-left: 0.151em;">,</span><span class="mi" id="MathJax-Span-602" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mspace" id="MathJax-Span-603" style="height: 0em; vertical-align: 0em; width: 1.292em; display: inline-block; overflow: hidden;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.979em, 1024.51em, 4.417em, -999.998em); top: -2.577em; left: 50%; margin-left: -12.25em;"><span class="mtd" id="MathJax-Span-612"><span class="mrow" id="MathJax-Span-613"><span class="mtext" id="MathJax-Span-614" style="font-family: MathJax_Main;">&nbsp;</span><span class="mtext" id="MathJax-Span-615" style="font-family: MathJax_Main;">&nbsp;</span><span class="texatom" id="MathJax-Span-616"><span class="mrow" id="MathJax-Span-617"><span class="mi" id="MathJax-Span-618" style="font-family: MathJax_AMS;">S</span></span></span><span class="texatom" id="MathJax-Span-619"><span class="mrow" id="MathJax-Span-620"><span class="mtext" id="MathJax-Span-621" style="font-family: MathJax_Main;">oftmax</span></span></span><span class="mo" id="MathJax-Span-622" style="font-family: MathJax_Main;">(</span><span class="texatom" id="MathJax-Span-623"><span class="mrow" id="MathJax-Span-624"><span class="mtext" id="MathJax-Span-625" style="font-family: MathJax_Main-bold;">u</span></span></span><span class="mo" id="MathJax-Span-626" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-627" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="texatom" id="MathJax-Span-628" style="padding-left: 0.3em;"><span class="mrow" id="MathJax-Span-629"><span class="mi" id="MathJax-Span-630" style="font-family: MathJax_AMS;">S</span></span></span><span class="texatom" id="MathJax-Span-631"><span class="mrow" id="MathJax-Span-632"><span class="mtext" id="MathJax-Span-633" style="font-family: MathJax_Main;">oftmax</span></span></span><span class="mo" id="MathJax-Span-634" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-635"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-636" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 1.143em;"><span class="mrow" id="MathJax-Span-637"><span class="mo" id="MathJax-Span-638" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span class="mi" id="MathJax-Span-639" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-640"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-641" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 1.143em;"><span class="mi" id="MathJax-Span-642" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="texatom" id="MathJax-Span-643"><span class="mrow" id="MathJax-Span-644"><span class="mtext" id="MathJax-Span-645" style="font-family: MathJax_Main-bold;">x</span></span></span><span class="mo" id="MathJax-Span-646" style="font-family: MathJax_Main;">)</span><span class="mspace" id="MathJax-Span-647" style="height: 0em; vertical-align: 0em; width: 3.772em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-648" style="font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-649" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-650" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-651" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-652" style="font-family: MathJax_Main; padding-left: 0.151em;">…</span><span class="mo" id="MathJax-Span-653" style="font-family: MathJax_Main; padding-left: 0.151em;">,</span><span class="mi" id="MathJax-Span-654" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.913em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.247em; border-left: 0px solid; width: 0px; height: 5.066em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-47">\begin{eqnarray*} \textbf{h} = & W^T\textbf{x} \hspace{9.4cm} \\ \textbf{u}_c= & W'^T\textbf{h}=W'^TW^T\textbf{x} \hspace{4cm} c=1, \dots, C \hspace{0.7cm}\\ \textbf{y}_c = & \ \ \mathbb{S}\textrm{oftmax}(\textbf{u})= \mathbb{S}\textrm{oftmax}(W'^TW^T\textbf{x}) \hspace{2cm} c=1, \dots, C \end{eqnarray*}</script></p><p>因为输出层共享权重 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-48-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-655" style="width: 1.788em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.391em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1001.39em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-656"><span class="msup" id="MathJax-Span-657"><span style="display: inline-block; position: relative; width: 1.391em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-658" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 1.143em;"><span class="mo" id="MathJax-Span-659" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.128em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-48">W'</script>，所以 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-49-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-660" style="width: 8.931em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.096em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1007em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-661"><span class="msubsup" id="MathJax-Span-662"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.65em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="texatom" id="MathJax-Span-663"><span class="mrow" id="MathJax-Span-664"><span class="mtext" id="MathJax-Span-665" style="font-family: MathJax_Main-bold;">u</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.647em;"><span class="mi" id="MathJax-Span-666" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-667" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-668" style="font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-669" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-670" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-671" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-672" style="font-family: MathJax_Main; padding-left: 0.151em;">⋯</span><span class="mo" id="MathJax-Span-673" style="font-family: MathJax_Main; padding-left: 0.151em;">,</span><span class="mi" id="MathJax-Span-674" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-675" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-49">\textbf{u}_c(c=1, \cdots, C)</script> 都是一样的，输出向量 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-50-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-676" style="width: 8.881em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.046em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1006.95em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-677"><span class="msubsup" id="MathJax-Span-678"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.6em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="texatom" id="MathJax-Span-679"><span class="mrow" id="MathJax-Span-680"><span class="mi" id="MathJax-Span-681" style="font-family: MathJax_Main-bold;">y</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.767em; left: 0.598em;"><span class="mi" id="MathJax-Span-682" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-683" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-684" style="font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-685" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-686" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-687" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-688" style="font-family: MathJax_Main; padding-left: 0.151em;">⋯</span><span class="mo" id="MathJax-Span-689" style="font-family: MathJax_Main; padding-left: 0.151em;">,</span><span class="mi" id="MathJax-Span-690" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-691" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-50">\mathbf{y}_c(c=1, \cdots, C)</script> 也是都一样的，即 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-51-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-692" style="width: 9.328em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.393em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1007.39em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-693"><span class="msubsup" id="MathJax-Span-694"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.6em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="texatom" id="MathJax-Span-695"><span class="mrow" id="MathJax-Span-696"><span class="mi" id="MathJax-Span-697" style="font-family: MathJax_Main-bold;">y</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.767em; left: 0.598em;"><span class="mn" id="MathJax-Span-698" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-699" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-700" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.6em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="texatom" id="MathJax-Span-701"><span class="mrow" id="MathJax-Span-702"><span class="mi" id="MathJax-Span-703" style="font-family: MathJax_Main-bold;">y</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.767em; left: 0.598em;"><span class="mn" id="MathJax-Span-704" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-705" style="font-family: MathJax_Main; padding-left: 0.151em;">⋯</span><span class="mo" id="MathJax-Span-706" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-707" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.6em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="texatom" id="MathJax-Span-708"><span class="mrow" id="MathJax-Span-709"><span class="mi" id="MathJax-Span-710" style="font-family: MathJax_Main-bold;">y</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.767em; left: 0.598em;"><span class="mi" id="MathJax-Span-711" style="font-size: 70.7%; font-family: MathJax_Math-italic;">C<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-51">\mathbf{y}_1=\mathbf{y}_2\dots= \mathbf{y}_C</script>。</p><p>如果想更详细地了解 CBOW 和 Skip-gram 的原理、后向传播、示例讲解等，推荐查看🔗<a href="https://lumingdong.cn/go/wlp8c9" rel="nofollow,noindex noopener noreferrer" target="_blank">《The backpropagation algorithm for Word2Vec》</a> 这篇文章。</p><p><strong>CBOW 和 Skip-gram 的性能对比</strong></p><p>两种模型都有各自的优缺点，不过根据 Mikolov 的原论文，<u>Skip-gram 在处理少量数据时效果很好，可以很好地表示低频单词。而 CBOW 的学习速度更快，对高频单词有更好的表示。</u>实际应用中，Skip-gram 方式会更常见。</p><h3 id="从权重矩阵到词向量"><em>2.3.</em><span class="ez-toc-section" id="从权重矩阵到词向量">从权重矩阵到词向量</span></h3><p><u>那么，到底什么才是我们想得到的 Embedding 向量化表示呢？</u></p><p>其实就是上面的<strong>权重矩阵</strong><span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-52-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-712" style="width: 3.475em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1002.73em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-713"><span class="msubsup" id="MathJax-Span-714"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-715" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.945em;"><span class="texatom" id="MathJax-Span-716"><span class="mrow" id="MathJax-Span-717"><span class="mi" id="MathJax-Span-718" style="font-size: 70.7%; font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.151em;"></span></span><span class="mo" id="MathJax-Span-719" style="font-size: 70.7%; font-family: MathJax_Main;">×</span><span class="mi" id="MathJax-Span-720" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-52">W_{V \times N}</script> 和 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-53-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-721" style="width: 3.475em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1002.73em, 2.929em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-722"><span class="msubsup" id="MathJax-Span-723"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-724" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.475em, 1000.25em, 4.12em, -999.998em); top: -4.313em; left: 1.143em;"><span class="mi" id="MathJax-Span-725" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1001.79em, 4.169em, -999.998em); top: -3.718em; left: 0.945em;"><span class="texatom" id="MathJax-Span-726"><span class="mrow" id="MathJax-Span-727"><span class="mi" id="MathJax-Span-728" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-729" style="font-size: 70.7%; font-family: MathJax_Main;">×</span><span class="mi" id="MathJax-Span-730" style="font-size: 70.7%; font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.151em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-53">W^\prime_{N \times V}</script>(对 Skip-gram 来说，分别对应损失函数公式中的中心词词向量 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-54-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-731" style="width: 0.747em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.6em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-732"><span class="mi" id="MathJax-Span-733" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-54">u</script> 和上下文词向量 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-55-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-734" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.5em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-735"><span class="mi" id="MathJax-Span-736" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-55">v</script>)，这<strong>两个都可以作为最终的向量化表示矩阵</strong>，只是一个靠近输入空间，一个靠近输出空间，具体选择哪个，理论上没有什么区别。不过<u>我个人更倾向于选择靠近中心词一端的权重矩阵</u>，比如 CBOW 选择 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-56-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-737" style="width: 3.475em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1002.73em, 2.929em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-738"><span class="msubsup" id="MathJax-Span-739"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-740" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.475em, 1000.25em, 4.12em, -999.998em); top: -4.313em; left: 1.143em;"><span class="mi" id="MathJax-Span-741" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1001.79em, 4.169em, -999.998em); top: -3.718em; left: 0.945em;"><span class="texatom" id="MathJax-Span-742"><span class="mrow" id="MathJax-Span-743"><span class="mi" id="MathJax-Span-744" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-745" style="font-size: 70.7%; font-family: MathJax_Main;">×</span><span class="mi" id="MathJax-Span-746" style="font-size: 70.7%; font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.151em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-56">W^\prime_{N \times V}</script>，而 Skip-gram 选择 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-57-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-747" style="width: 3.475em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1002.73em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-748"><span class="msubsup" id="MathJax-Span-749"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-750" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.945em;"><span class="texatom" id="MathJax-Span-751"><span class="mrow" id="MathJax-Span-752"><span class="mi" id="MathJax-Span-753" style="font-size: 70.7%; font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.151em;"></span></span><span class="mo" id="MathJax-Span-754" style="font-size: 70.7%; font-family: MathJax_Main;">×</span><span class="mi" id="MathJax-Span-755" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-57">W_{V \times N}</script>，<u>在 Word2Vec 使用的 Skip-gram 就是选的 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-58-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-756" style="width: 3.475em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1002.73em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-757"><span class="msubsup" id="MathJax-Span-758"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-759" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.945em;"><span class="texatom" id="MathJax-Span-760"><span class="mrow" id="MathJax-Span-761"><span class="mi" id="MathJax-Span-762" style="font-size: 70.7%; font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.151em;"></span></span><span class="mo" id="MathJax-Span-763" style="font-size: 70.7%; font-family: MathJax_Main;">×</span><span class="mi" id="MathJax-Span-764" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-58">W_{V \times N}</script></u>，<strong>另外有些时候还可以尝试用两个矩阵的平均或者两个矩阵对应词向量的拼接作为最终 Embedding</strong>。</p><p>参考下图，训练完成的权重矩阵，一个维度是单词对应的维度，一个维度是隐含单元的维度，换个角度来看，它刚好就是每个词对应一个隐含特征向量，这不就是我们需要的词向量吗？因此由权重矩阵便可自然转化成 Word2Vec 的词向量查找表（Lookup Table）。</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174308.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729174308.png" alt=""></p><h3 id="Word2Vec的优化方法"><em>2.4.</em><span class="ez-toc-section" id="Word2Vec的优化方法">Word2Vec的优化方法</span></h3><p>Word2Vec 的最原本的算法在工程实现上会带来很多问题，以 Skip-gram 为例：</p><ul><li>Softmax 函数中存在归一化项，因此需要对词汇表中的所有单词进行遍历，这会使得每次迭代过程非常缓慢；</li><li>一般情况下词汇表维度 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-59-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-765" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.8em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-766"><span class="mi" id="MathJax-Span-767" style="font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-59">V</script> 远大于词向量维度 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-60-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-768" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.89em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-769"><span class="mi" id="MathJax-Span-770" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-60">N</script>，也就是无论是输入层与隐藏层之间的权重 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-61-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-771" style="width: 3.475em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1002.73em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-772"><span class="msubsup" id="MathJax-Span-773"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-774" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.945em;"><span class="texatom" id="MathJax-Span-775"><span class="mrow" id="MathJax-Span-776"><span class="mi" id="MathJax-Span-777" style="font-size: 70.7%; font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.151em;"></span></span><span class="mo" id="MathJax-Span-778" style="font-size: 70.7%; font-family: MathJax_Main;">×</span><span class="mi" id="MathJax-Span-779" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-61">W_{V \times N}</script> 还是隐藏层与输出层的权重 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-62-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-780" style="width: 3.475em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1002.73em, 2.929em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-781"><span class="msubsup" id="MathJax-Span-782"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-783" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.475em, 1000.25em, 4.12em, -999.998em); top: -4.313em; left: 1.143em;"><span class="mo" id="MathJax-Span-784" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1001.79em, 4.169em, -999.998em); top: -3.718em; left: 0.945em;"><span class="texatom" id="MathJax-Span-785"><span class="mrow" id="MathJax-Span-786"><span class="mi" id="MathJax-Span-787" style="font-size: 70.7%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-788" style="font-size: 70.7%; font-family: MathJax_Main;">×</span><span class="mi" id="MathJax-Span-789" style="font-size: 70.7%; font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.151em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-62">W'_{N \times V}</script>，他们权重的数量都是由 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-63-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-790" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.8em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-791"><span class="mi" id="MathJax-Span-792" style="font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-63">V</script> 来决定的，而通常词表维度又是一个很大的值，也就是说，这个看似很简单的网络结构中却有大量的权重需要更新。举个例子，假设有 10000 个单词的词汇表，词向量维度是 300，那么这两个权重矩阵的权重数量都是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-64-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-793" style="width: 13.792em; display: inline-block;"><span style="display: inline-block; position: relative; width: 10.915em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1010.87em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-794"><span class="mn" id="MathJax-Span-795" style="font-family: MathJax_Main;">10</span><span class="mo" id="MathJax-Span-796" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-797" style="font-family: MathJax_Main; padding-left: 0.151em;">000</span><span class="mo" id="MathJax-Span-798" style="font-family: MathJax_Main; padding-left: 0.201em;">×</span><span class="mn" id="MathJax-Span-799" style="font-family: MathJax_Main; padding-left: 0.201em;">300</span><span class="mo" id="MathJax-Span-800" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-801" style="font-family: MathJax_Main; padding-left: 0.3em;">3000</span><span class="mo" id="MathJax-Span-802" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-803" style="font-family: MathJax_Main; padding-left: 0.151em;">000</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-64">10,000 \times 300 = 3000,000</script> 个，这么多的权重用梯度下降更新是非常慢的。</li><li>即便退一步讲，不考虑时间问题，因为权重数量越多就越容易过拟合，这时就需要大量的训练数据去调整权重以避免过拟合的发生，然而数据资源往往并没有那么容易获得。</li></ul><p>因此，Word2Vec 为了提高效率，提出了很多工程技巧对原始算法进行了优化，其中比较重要的有两个：</p><p><strong>层次 Softmax（Hierarchical Softmax， H-Softmax）</strong></p><p>为了避免 Softmax 公式中对词汇表中所有单词遍历，Hierarchical Softmax 的思想是将原来 Softmax 进行拆解分层，将原 Softmax 的 N 分类问题转化成 logN 个二分类问题。</p><p>这个分层转化的过程借助了<strong>霍夫曼树（Huffman Tree）</strong>，在网络结构中的作用是代替从隐藏层到输出 Softmax 层的映射，优化后，隐藏层到输出层的 Softmax 映射不是一下子完成的，而是沿着霍夫曼树一步步完成的，因此这种 Softmax 取名为"Hierarchical Softmax"。</p><p>我们先来回顾一下霍夫曼树的知识点。</p><p>霍夫曼树是带权路径长度最短的树，权值较大的结点离根较近，通常会作为一种高效的编码方式。</p><p>霍夫曼树的建立：</p><p style="padding-left: 40px;">输入：权值为 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-65-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-804" style="width: 8.088em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.401em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1006.3em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-805"><span class="mo" id="MathJax-Span-806" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-807"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-808" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mn" id="MathJax-Span-809" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-810" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-811" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-812" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mn" id="MathJax-Span-813" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-814" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-815" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="mo" id="MathJax-Span-816" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="mo" id="MathJax-Span-817" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="msubsup" id="MathJax-Span-818" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-819" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-820" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-821" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-65">(w_1,w_2,...w_n)</script> 的 n 个节点</p><p style="padding-left: 40px;">输出：对应的霍夫曼树</p><p style="padding-left: 40px;">1）将 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-66-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-822" style="width: 8.088em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.401em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1006.3em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-823"><span class="mo" id="MathJax-Span-824" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-825"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-826" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mn" id="MathJax-Span-827" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-828" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-829" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-830" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mn" id="MathJax-Span-831" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-832" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-833" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="mo" id="MathJax-Span-834" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="mo" id="MathJax-Span-835" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="msubsup" id="MathJax-Span-836" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-837" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-838" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-839" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-66">(w_1,w_2,...w_n)</script> 看做是有 n 棵树的森林，每个树仅有一个节点。</p><p style="padding-left: 40px;">2）在森林中选择根节点权值最小的两棵树进行合并，得到一个新的树，这两颗树分布作为新树的左右子树。新树的根节点权重为左右子树的根节点权重之和。</p><p style="padding-left: 40px;">3）将之前的根节点权值最小的两棵树从森林删除，并把新树加入森林。</p><p style="padding-left: 40px;">4）重复步骤 2）和 3）直到森林里只有一棵树为止。</p><p>下面我们用一个具体的例子来说明霍夫曼树建立的过程：</p><p>我们有（a、b、c、d、e、f）共 6 个节点，节点的权值分布是（20、4、8、6、16、3）。首先是最小的 b 和 f 合并，得到的新树根节点权重是 7，此时森林里 5 棵树，根节点权重分别是 20、8、6、16、7。此时根节点权重最小的 6、7 合并，得到新子树，依次类推，最终得到下面的霍夫曼树。</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724175958.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724175958.png" alt=""></p><p>那么霍夫曼树有什么好处呢？一般得到霍夫曼树后我们会对叶子节点进行霍夫曼编码，<strong>霍夫曼树的构建方式决定了权重高的叶子节点越靠近根节点，而权重低的叶子节点会远离根节点，这样我们的高权重节点编码值较短，而低权重值编码值较长。这保证的树的带权路径最短，也符合我们的信息论，即我们希望越常用的词拥有更短的编码。</strong>如何编码呢？一般对于一个霍夫曼树的节点（根节点除外），<u>可以约定左子树编码为 0，右子树编码为 1</u>。如上图，则可以得到 c 的编码是 00。</p><p><u>而在 word2vec 中，约定编码方式和上面的例子相反，即约定左子树编码为 1，右子树编码为 0，同时约定左子树的权重不小于右子树的权重。</u></p><p>那霍夫曼树如何完成从隐藏层到输出 Softmax 层映射呢？</p><p><u>由于我们把之前所有都要计算的从输出 Softmax 层的概率计算变成了一颗二叉霍夫曼树，那么我们的 Softmax 概率计算只需要沿着树形结构进行就可以了</u>。如下图所示，我们可以沿着霍夫曼树从根节点一直走到我们的叶子节点的词 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-67-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-840" style="width: 1.441em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.14em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-841"><span class="msubsup" id="MathJax-Span-842"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-843" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mn" id="MathJax-Span-844" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-67">w_2</script>。</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724171553.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724171553.png" alt=""></p><p><strong>这里使用霍夫曼树来代替隐藏层和输出层的神经元，霍夫曼树的叶子节点起到输出层神经元的作用，叶子节点的个数即为词汇表的小大， 而内部节点则起到隐藏层神经元的作用。</strong></p><ul><li><p>叶子节点：树的每一个叶子节点都代表一个单词，所以通常词频越高离根节点越近；</p></li><li><p>内部节点：每一个内部节点都代表一次逻辑回归的过程，可以规定沿着左子树走是负类（霍夫曼编码 1），沿着右子树走是正类（霍夫曼编码 0）。假设 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-68-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-845" style="width: 1.441em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.14em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-846"><span class="msubsup" id="MathJax-Span-847"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-848" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-849" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-68">x_w</script> 是当前内部节点的词向量，而 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-69-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-850" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.45em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-851"><span class="mi" id="MathJax-Span-852" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-69">\theta</script> 则是需要学习的模型参数。对于 CBOW 模型，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-70-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-853" style="width: 1.441em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.14em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-854"><span class="msubsup" id="MathJax-Span-855"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-856" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-857" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-70">x_w</script> 初始化（根节点）为输入的词向量加和求平均后的向量，对于 Skip-gram 来说，就是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-71-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-858" style="width: 1.441em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.14em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-859"><span class="msubsup" id="MathJax-Span-860"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-861" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-862" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-71">x_w</script> 的词向量。判别正类和负类的方法是使用 Sigmoid 函数：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-72-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-863" style="width: 15.479em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.254em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.945em, 1012.25em, 3.475em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-864"><span class="mi" id="MathJax-Span-865" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-866" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-867" style="font-family: MathJax_Main;">+</span><span class="mo" id="MathJax-Span-868" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-869" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mi" id="MathJax-Span-870" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">σ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-871" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-872"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-873" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.598em;"><span class="mi" id="MathJax-Span-874" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-875" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-876" style="font-family: MathJax_Math-italic;">θ</span><span class="mo" id="MathJax-Span-877" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-878" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-879" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 4.02em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.227em, 1000.45em, 4.169em, -999.998em); top: -4.71em; left: 50%; margin-left: -0.246em;"><span class="mn" id="MathJax-Span-880" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.979em, 1003.92em, 4.268em, -999.998em); top: -3.172em; left: 50%; margin-left: -1.932em;"><span class="mrow" id="MathJax-Span-881"><span class="mn" id="MathJax-Span-882" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-883" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="msubsup" id="MathJax-Span-884" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 2.235em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-885" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.449em;"><span class="texatom" id="MathJax-Span-886"><span class="mrow" id="MathJax-Span-887"><span class="mo" id="MathJax-Span-888" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="msubsup" id="MathJax-Span-889"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-890" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.4em, 4.169em, -999.998em); top: -4.263em; left: 0.399em;"><span class="mi" id="MathJax-Span-891" style="font-size: 50%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.673em, 1000.4em, 4.169em, -999.998em); top: -3.916em; left: 0.399em;"><span class="mi" id="MathJax-Span-892" style="font-size: 50%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-893" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1004.02em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.02em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.184em; border-left: 0px solid; width: 0px; height: 3.003em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-72">P(+)=\sigma(x_w^T \theta)=\frac{1}{1+e^{-x_w^T\theta}}</script></p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-73-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-894" style="width: 9.625em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.641em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1007.54em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-895"><span class="mi" id="MathJax-Span-896" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-897" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-898" style="font-family: MathJax_Main;">−</span><span class="mo" id="MathJax-Span-899" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-900" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-901" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-902" style="font-family: MathJax_Main; padding-left: 0.201em;">−</span><span class="mi" id="MathJax-Span-903" style="font-family: MathJax_Math-italic; padding-left: 0.201em;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-904" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-905" style="font-family: MathJax_Main;">+</span><span class="mo" id="MathJax-Span-906" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-73">P(-)=1-P(+)</script></p></li></ul><p>最终输出哪个单词是由 logN 次逻辑回归过程决定的，回到基于 Hierarchical Softmax 的 word2vec 本身，我们的目标就是找到合适的所有节点的词向量和所有内部节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-74-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-907" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.45em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-908"><span class="mi" id="MathJax-Span-909" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-74">\theta</script>, 使训练样本达到最大似然。如此经过一系列推导便可得到目标函数：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-75-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-910" style="width: 43.703em; display: inline-block;"><span style="display: inline-block; position: relative; width: 34.675em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.499em, 1034.58em, 3.772em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-911"><span class="mi" id="MathJax-Span-912" style="font-family: MathJax_Math-italic;">L</span><span class="mo" id="MathJax-Span-913" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mi" id="MathJax-Span-914" style="font-family: MathJax_Main; padding-left: 0.3em;">log</span><span class="mo" id="MathJax-Span-915"></span><span class="munderover" id="MathJax-Span-916" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.292em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.24em, 4.616em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-917" style="font-family: MathJax_Size2; vertical-align: 0em;">∏</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.09em, 4.268em, -999.998em); top: -2.924em; left: 0.052em;"><span class="texatom" id="MathJax-Span-918"><span class="mrow" id="MathJax-Span-919"><span class="mi" id="MathJax-Span-920" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-921" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-922" style="font-size: 70.7%; font-family: MathJax_Main;">2</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.276em, 1000.65em, 4.268em, -999.998em); top: -5.206em; left: 0.35em;"><span class="texatom" id="MathJax-Span-923"><span class="mrow" id="MathJax-Span-924"><span class="msubsup" id="MathJax-Span-925"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.2em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-926" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.201em;"><span class="mi" id="MathJax-Span-927" style="font-size: 50%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-928" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-929" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-930"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-931" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.598em;"><span class="mi" id="MathJax-Span-932" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.3em, 4.169em, -999.998em); top: -3.718em; left: 0.499em;"><span class="mi" id="MathJax-Span-933" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="texatom" id="MathJax-Span-934"><span class="mrow" id="MathJax-Span-935"><span class="mo" id="MathJax-Span-936" style="font-family: MathJax_Main;">|</span></span></span><span class="msubsup" id="MathJax-Span-937"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-938" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-939" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-940" style="font-family: MathJax_Main;">,</span><span class="msubsup" id="MathJax-Span-941" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-942" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.449em;"><span class="mi" id="MathJax-Span-943" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.24em, 4.219em, -999.998em); top: -3.718em; left: 0.449em;"><span class="texatom" id="MathJax-Span-944"><span class="mrow" id="MathJax-Span-945"><span class="mi" id="MathJax-Span-946" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-947" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-948" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-949" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-950" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="munderover" id="MathJax-Span-951" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-952" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.09em, 4.268em, -999.998em); top: -2.924em; left: 0.151em;"><span class="texatom" id="MathJax-Span-953"><span class="mrow" id="MathJax-Span-954"><span class="mi" id="MathJax-Span-955" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-956" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-957" style="font-size: 70.7%; font-family: MathJax_Main;">2</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.276em, 1000.65em, 4.268em, -999.998em); top: -5.206em; left: 0.399em;"><span class="texatom" id="MathJax-Span-958"><span class="mrow" id="MathJax-Span-959"><span class="msubsup" id="MathJax-Span-960"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.2em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-961" style="font-size: 70.7%; font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.201em;"><span class="mi" id="MathJax-Span-962" style="font-size: 50%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-963" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-964" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-965" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-966" style="font-family: MathJax_Main; padding-left: 0.201em;">−</span><span class="msubsup" id="MathJax-Span-967" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-968" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.598em;"><span class="mi" id="MathJax-Span-969" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.3em, 4.169em, -999.998em); top: -3.718em; left: 0.499em;"><span class="mi" id="MathJax-Span-970" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-971" style="font-family: MathJax_Main;">)</span><span class="mi" id="MathJax-Span-972" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-973"></span><span class="mo" id="MathJax-Span-974" style="font-family: MathJax_Main;">[</span><span class="mi" id="MathJax-Span-975" style="font-family: MathJax_Math-italic;">σ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-976" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-977"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-978" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.598em;"><span class="mi" id="MathJax-Span-979" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-980" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-981"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-982" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.449em;"><span class="mi" id="MathJax-Span-983" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.24em, 4.219em, -999.998em); top: -3.718em; left: 0.449em;"><span class="texatom" id="MathJax-Span-984"><span class="mrow" id="MathJax-Span-985"><span class="mi" id="MathJax-Span-986" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-987" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-988" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-989" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-990" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-991" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="msubsup" id="MathJax-Span-992" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-993" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.598em;"><span class="mi" id="MathJax-Span-994" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.3em, 4.169em, -999.998em); top: -3.718em; left: 0.499em;"><span class="mi" id="MathJax-Span-995" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-996" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-997"></span><span class="mo" id="MathJax-Span-998" style="font-family: MathJax_Main;">[</span><span class="mn" id="MathJax-Span-999" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1000" style="font-family: MathJax_Main; padding-left: 0.201em;">−</span><span class="mi" id="MathJax-Span-1001" style="font-family: MathJax_Math-italic; padding-left: 0.201em;">σ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1002" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1003"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1004" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.598em;"><span class="mi" id="MathJax-Span-1005" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-1006" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1007"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1008" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.449em;"><span class="mi" id="MathJax-Span-1009" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.24em, 4.219em, -999.998em); top: -3.718em; left: 0.449em;"><span class="texatom" id="MathJax-Span-1010"><span class="mrow" id="MathJax-Span-1011"><span class="mi" id="MathJax-Span-1012" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1013" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="mn" id="MathJax-Span-1014" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1015" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1016" style="font-family: MathJax_Main;">]</span><span class="mo" id="MathJax-Span-1017" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.559em; border-left: 0px solid; width: 0px; height: 3.878em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-75">L= \log \prod_{i=2}^{l_w}P(d_i^w|x_w, \theta_{i-1}^w) = \sum\limits_{i=2}^{l_w} ((1-d_i^w) \log [\sigma(x_w^T\theta_{i-1}^w)] + d_i^w \log[1-\sigma(x_w^T\theta_{i-1}^w)])</script></p><p>其中，从根节点到 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-76-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1018" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.65em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1019"><span class="mi" id="MathJax-Span-1020" style="font-family: MathJax_Math-italic;">w</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-76">w</script> 所在的叶子节点，包含的节点总数为 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-77-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1021" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.89em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1022"><span class="msubsup" id="MathJax-Span-1023"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.25em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1024" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.3em;"><span class="mi" id="MathJax-Span-1025" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-77">l_w</script>, <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-78-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1026" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.65em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1027"><span class="mi" id="MathJax-Span-1028" style="font-family: MathJax_Math-italic;">w</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-78">w</script> 在霍夫曼树中从根节点开始，经过的第 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-79-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1029" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.3em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1030"><span class="mi" id="MathJax-Span-1031" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-79">i</script> 个节点表示为 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-80-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1032" style="width: 1.391em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1001.09em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1033"><span class="msubsup" id="MathJax-Span-1034"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1035" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.499em;"><span class="mi" id="MathJax-Span-1036" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.3em, 4.169em, -999.998em); top: -3.718em; left: 0.499em;"><span class="mi" id="MathJax-Span-1037" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-80">p_i^w</script>，对应的霍夫曼编码为 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-81-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1038" style="width: 6.153em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.864em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1004.81em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1039"><span class="msubsup" id="MathJax-Span-1040"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1041" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.598em;"><span class="mi" id="MathJax-Span-1042" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.3em, 4.169em, -999.998em); top: -3.718em; left: 0.499em;"><span class="mi" id="MathJax-Span-1043" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1044" style="font-family: MathJax_Main; padding-left: 0.3em;">∈</span><span class="mo" id="MathJax-Span-1045" style="font-family: MathJax_Main; padding-left: 0.3em;">{</span><span class="mn" id="MathJax-Span-1046" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-1047" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1048" style="font-family: MathJax_Main; padding-left: 0.151em;">1</span><span class="mo" id="MathJax-Span-1049" style="font-family: MathJax_Main;">}</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-81">d_i^w \in \{0,1\}</script>，其中 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-82-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1050" style="width: 7.84em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.203em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1006.2em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1051"><span class="mi" id="MathJax-Span-1052" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1053" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1054" style="font-family: MathJax_Main; padding-left: 0.3em;">2</span><span class="mo" id="MathJax-Span-1055" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1056" style="font-family: MathJax_Main; padding-left: 0.151em;">3</span><span class="mo" id="MathJax-Span-1057" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-1058" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="mo" id="MathJax-Span-1059" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="mo" id="MathJax-Span-1060" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="mo" id="MathJax-Span-1061" style="font-family: MathJax_Main; padding-left: 0.151em;">,</span><span class="msubsup" id="MathJax-Span-1062" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.25em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1063" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.3em;"><span class="mi" id="MathJax-Span-1064" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-82">i =2,3,...,l_w</script>。而该节点对应的模型参数表示为 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-83-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1065" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1001.04em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1066"><span class="msubsup" id="MathJax-Span-1067"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1068" style="font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.449em;"><span class="mi" id="MathJax-Span-1069" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.3em, 4.169em, -999.998em); top: -3.718em; left: 0.449em;"><span class="mi" id="MathJax-Span-1070" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-83">\theta_i^w</script>, 其中 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-84-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1071" style="width: 9.973em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.889em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1007.84em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1072"><span class="mi" id="MathJax-Span-1073" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1074" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1075" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-1076" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-1077" style="font-family: MathJax_Main; padding-left: 0.151em;">2</span><span class="mo" id="MathJax-Span-1078" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-1079" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="mo" id="MathJax-Span-1080" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="mo" id="MathJax-Span-1081" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="mo" id="MathJax-Span-1082" style="font-family: MathJax_Main; padding-left: 0.151em;">,</span><span class="msubsup" id="MathJax-Span-1083" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.25em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1084" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.3em;"><span class="mi" id="MathJax-Span-1085" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1086" style="font-family: MathJax_Main; padding-left: 0.201em;">−</span><span class="mn" id="MathJax-Span-1087" style="font-family: MathJax_Main; padding-left: 0.201em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-84">i =1,2,...,l_w-1</script>，没有 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-85-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1088" style="width: 3.326em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1002.63em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1089"><span class="mi" id="MathJax-Span-1090" style="font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1091" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-1092" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.25em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1093" style="font-family: MathJax_Math-italic;">l</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.3em;"><span class="mi" id="MathJax-Span-1094" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-85">i =l_w</script> 是因为模型参数仅仅针对于霍夫曼树的内部节点。</p><p>之后利用梯度下降来更新参数：每个单词 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-86-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1095" style="width: 1.441em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.14em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1096"><span class="msubsup" id="MathJax-Span-1097"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1098" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-1099" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-86">x_w</script> 的词向量和霍夫曼树每个内部结点的 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-87-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1100" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.45em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1101"><span class="mi" id="MathJax-Span-1102" style="font-family: MathJax_Math-italic;">θ</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-87">\theta</script>。</p><p><u>使用霍夫曼树有什么好处呢？首先，由于是二叉树，之前计算量为 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-88-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1103" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.8em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1104"><span class="mi" id="MathJax-Span-1105" style="font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-88">V</script>，现在变成了 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-89-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1106" style="width: 3.326em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1002.63em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1107"><span class="msubsup" id="MathJax-Span-1108"><span style="display: inline-block; position: relative; width: 1.689em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.24em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1109" style="font-family: MathJax_Main;">log</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.767em; left: 1.292em;"><span class="mn" id="MathJax-Span-1110" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1111"></span><span class="mi" id="MathJax-Span-1112" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.201em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-89">\log_2V</script>。第二，由于使用霍夫曼树是高频的词靠近树根，这样高频词需要更少的时间会被找到，这符合我们的贪心优化思想。</u>可能存在的缺点是，如果训练样本里的中心词 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-90-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1113" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.65em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1114"><span class="mi" id="MathJax-Span-1115" style="font-family: MathJax_Math-italic;">w</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-90">w</script> 是一个很生僻的词，那么就得在霍夫曼树中辛苦的向下走很久了。<sup class="md-footnote"><a href="#dfref-footnote-2" name="ref-footnote-2">2</a></sup></p><p><strong>负例采样（Negative Sampling，简称 NEG，也称负采样）</strong></p><p>负例采样不再使用复杂的霍夫曼树，而是利用相对简单的随机负采样来大幅提高性能，并且在经过论证后发现，负例采样不但可以<u>提高训练速度</u>，还可以<u>改善所得词向量的质量</u>，因此，负例采样比层次 Softmax 使用率更高。</p><p><strong>负例采样的思想其实和层次 Softmax 很类似，也是将 Softmax 多分类问题转化成多次二分类问题，使用二元逻辑回归可以让一个训练样本每次仅仅更新一小部分的权重，不同于原本每个训练样本更新所有的权重，这样大大减少了梯度下降过程中的计算量。</strong></p><p>举例来讲，当我们用训练样本 <code>(input word: "fox"，output word: "quick")</code> 来训练我们的神经网络时，<code>fox</code> 和 <code>quick</code> 都是经过 One-Hot 编码的。如果我们的单词表（vocabulary）大小为 10000，在输出层，我们期望对应 <code>quick</code> 单词的那个神经元结点输出 1，其余 9999 个都应该输出 0。在这里，这 9999 个我们期望输出为 0 的神经元结点所对应的单词我们称为 “negative” word。当使用负例采样时，我们将随机选择一小部分的 negative words（比如选 5 个 negative words）来更新对应的权重。我们也会对我们的 “positive” word 进行权重更新（在我们上面的例子中，这个单词指的是 <code>quick</code>）。</p><p>对于 Skip-gram 的输入层与隐藏层之间 10000 x 300 的权重矩阵，使用负例采样仅需要更新 positive word 即 <code>quick</code> 的和其他 5 个 negative words 的结点对应的权重，共计 6 个神经元，相当于每次只更新 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-91-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1116" style="width: 8.286em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.55em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1006.5em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1117"><span class="mn" id="MathJax-Span-1118" style="font-family: MathJax_Main;">6</span><span class="mo" id="MathJax-Span-1119" style="font-family: MathJax_Main; padding-left: 0.201em;">×</span><span class="mn" id="MathJax-Span-1120" style="font-family: MathJax_Main; padding-left: 0.201em;">300</span><span class="mo" id="MathJax-Span-1121" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1122" style="font-family: MathJax_Main; padding-left: 0.3em;">1800</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-91">6 \times 300 =1800</script> 个权重，对于 3 百万的权重来说，相当于只计算了 0.06% 的权重，这样计算效率就大幅度提高。</p><p>当然，负例采样的具体过程和层次 Softmax 有很大区别。 它的技术点会涉及两个关键的地方，一个是如何进行负例采样，另外一个是如何进行二元逻辑回归。</p><p>先来看<u>采样方法</u>，其实<strong>采样方法并不是固定的</strong>，后来很多论文中虽然使用负例采样的优化方法类进行 Embedding，但是采样方法都是根据自己的业务来进行调整的，下面以原始论文中的采样方法作为参考。</p><p>Word2Vec 论文中给出的采样方式其实并不复杂，<strong>首先采样的数量根据数据集的大小而定，一个经验是对于小数据集，选择 5~20 个负例，而对于较大的数据集，则只需要 2~5 个负例就可以。另外，采样会遵循一定的分布，这里用的是一元模型分布 (unigram distribution)，它的特点是词频更高的词更有可能被选为负例，是一个加权采样。</strong>假设我们要将整个语料库的单词作为单词表，并且从单词表中进行随机负例采样，则选取某个词的概率等于该词出现在语料库次数（词频）除以语料库出现的单词总数，用公式表示为：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-92-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-1123" style="width: 12.602em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.973em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.796em, 1009.97em, 3.772em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1124"><span class="mi" id="MathJax-Span-1125" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-1126" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1127"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1128" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-1129" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1130" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1131" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-1132" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 5.806em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.127em, 1002.28em, 4.417em, -999.998em); top: -4.71em; left: 50%; margin-left: -1.188em;"><span class="mrow" id="MathJax-Span-1133"><span class="mi" id="MathJax-Span-1134" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1135" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1136"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1137" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-1138" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1139" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.078em, 1005.56em, 4.616em, -999.998em); top: -3.271em; left: 50%; margin-left: -2.825em;"><span class="mrow" id="MathJax-Span-1140"><span class="munderover" id="MathJax-Span-1141"><span style="display: inline-block; position: relative; width: 2.334em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1001em, 4.417em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1142" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.5em, 4.169em, -999.998em); top: -4.511em; left: 1.044em;"><span class="texatom" id="MathJax-Span-1143"><span class="mrow" id="MathJax-Span-1144"><span class="mi" id="MathJax-Span-1145" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.29em, 4.318em, -999.998em); top: -3.718em; left: 1.044em;"><span class="texatom" id="MathJax-Span-1146"><span class="mrow" id="MathJax-Span-1147"><span class="mi" id="MathJax-Span-1148" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-1149" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-1150" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mrow" id="MathJax-Span-1151" style="padding-left: 0.151em;"><span class="mo" id="MathJax-Span-1152" style=""><span style="font-family: MathJax_Main;">(</span></span><span class="mi" id="MathJax-Span-1153" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1154" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1155"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1156" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-1157" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1158" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1159" style=""><span style="font-family: MathJax_Main;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1005.81em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.806em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.559em; border-left: 0px solid; width: 0px; height: 3.441em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-92">P(w_i) = \frac{ f(w_i) }{\sum_{j=0}^{n}\left( f(w_j) \right) }</script></p><p>其中，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-93-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1160" style="width: 2.036em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.59em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1001.49em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1161"><span class="mi" id="MathJax-Span-1162" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1163" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-1164" style="font-family: MathJax_Main;">⋅</span><span class="mo" id="MathJax-Span-1165" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-93">f(\cdot)</script> 可以理解为计数，即得到词频。</p><p>论文中指出，作者在这个公式上尝试了很多变化，最后<strong>表现比较好的是将单词词频提高到 3/4 次幂</strong>。如下：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-94-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-1166" style="width: 14.536em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.51em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.548em, 1011.51em, 4.368em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1167"><span class="mi" id="MathJax-Span-1168" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-1169" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1170"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1171" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-1172" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1173" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1174" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-1175" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 7.344em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(2.879em, 1003.52em, 4.417em, -999.998em); top: -4.71em; left: 50%; margin-left: -1.734em;"><span class="msubsup" id="MathJax-Span-1176"><span style="display: inline-block; position: relative; width: 3.524em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1002.28em, 4.417em, -999.998em); top: -4.015em; left: 0em;"><span class="texatom" id="MathJax-Span-1177"><span class="mrow" id="MathJax-Span-1178"><span class="mi" id="MathJax-Span-1179" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1180" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1181"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1182" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-1183" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1184" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.511em; left: 2.383em;"><span class="texatom" id="MathJax-Span-1185"><span class="mrow" id="MathJax-Span-1186"><span class="mn" id="MathJax-Span-1187" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span class="texatom" id="MathJax-Span-1188"><span class="mrow" id="MathJax-Span-1189"><span class="mo" id="MathJax-Span-1190" style="font-size: 70.7%; font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-1191" style="font-size: 70.7%; font-family: MathJax_Main;">4</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.731em, 1007.05em, 4.814em, -999.998em); top: -2.924em; left: 50%; margin-left: -3.619em;"><span class="mrow" id="MathJax-Span-1192"><span class="munderover" id="MathJax-Span-1193"><span style="display: inline-block; position: relative; width: 2.334em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1001em, 4.417em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1194" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.5em, 4.169em, -999.998em); top: -4.511em; left: 1.044em;"><span class="texatom" id="MathJax-Span-1195"><span class="mrow" id="MathJax-Span-1196"><span class="mi" id="MathJax-Span-1197" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.29em, 4.318em, -999.998em); top: -3.718em; left: 1.044em;"><span class="texatom" id="MathJax-Span-1198"><span class="mrow" id="MathJax-Span-1199"><span class="mi" id="MathJax-Span-1200" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-1201" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-1202" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mrow" id="MathJax-Span-1203" style="padding-left: 0.151em;"><span class="mo" id="MathJax-Span-1204" style="vertical-align: 0em;"><span style="font-family: MathJax_Size2;">(</span></span><span class="msubsup" id="MathJax-Span-1205"><span style="display: inline-block; position: relative; width: 3.524em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1002.33em, 4.467em, -999.998em); top: -4.015em; left: 0em;"><span class="texatom" id="MathJax-Span-1206"><span class="mrow" id="MathJax-Span-1207"><span class="mi" id="MathJax-Span-1208" style="font-family: MathJax_Math-italic;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-1209" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1210"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1211" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-1212" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1213" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.511em; left: 2.433em;"><span class="texatom" id="MathJax-Span-1214"><span class="mrow" id="MathJax-Span-1215"><span class="mn" id="MathJax-Span-1216" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span class="texatom" id="MathJax-Span-1217"><span class="mrow" id="MathJax-Span-1218"><span class="mo" id="MathJax-Span-1219" style="font-size: 70.7%; font-family: MathJax_Main;">/</span></span></span><span class="mn" id="MathJax-Span-1220" style="font-size: 70.7%; font-family: MathJax_Main;">4</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1221" style="vertical-align: 0em;"><span style="font-family: MathJax_Size2;">)</span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1007.34em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 7.344em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.309em; border-left: 0px solid; width: 0px; height: 4.503em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-94">P(w_i) = \frac{ {f(w_i)}^{3/4} }{\sum_{j=0}^{n}\left( {f(w_j)}^{3/4} \right) }</script></p><p>这个<strong>改变后的公式会产生一个效果，就是稍微增加低频词的采样概率，降低高频词的采样概率</strong>。可根据下图（google 的搜索栏中输入 “plot y = x^(3/4) and y = x” 可以快速画图）的对比看出来：</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729161105.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729161105.png" alt=""></p><p><strong>对高频词汇进行降采样避免对于这些低信息词汇的无谓计算，同时避免高频词汇对模型造成过大的影响</strong>，注意这是一个很重要的思想，<u>很多时候对于推荐算法中样本，都是过滤掉高频用户，保证每个用户出现的样本数近似，防止高频用户的样本对模型的过大影响，这和 CF 里面的高频用户惩罚系数一样。</u></p><p>然后再来看<span style="text-decoration: underline;">二元逻辑回归的目标函数</span>，论文中给出了 Skip-gram 模型负采样的优化目标函数为：</p><p><a href="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184714-1280x378.png"><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184714-1280x378.png" alt="" width="1280" height="378" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%201280%20378%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184714-1280x378.png" alt="" width="1280" height="378"></a></p><p>其中 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-95-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1222" style="width: 3.326em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1002.53em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1223"><span class="msubsup" id="MathJax-Span-1224"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1225" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.647em;"><span class="mi" id="MathJax-Span-1226" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1227" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1228" style="font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1229" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-95">P_n(w)</script> 就是采样用的概率分布。</p><p>原论文中并没有给出负例采样的推导过程，2014 年，Yoav Goldberg 在论文《word2vec Explained: Deriving Mikolov et al.'s Negative-Sampling Word-Embedding Method》里对上述目标函数给出了推导。</p><p>从本文前面的内容我们已知 Skip-gram 的最初的目标函数：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-96-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-1230" style="width: 31.649em; display: inline-block;"><span style="display: inline-block; position: relative; width: 25.102em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.548em, 1025em, 4.02em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1231"><span class="mi" id="MathJax-Span-1232" style="font-family: MathJax_Main;">arg</span><span class="mo" id="MathJax-Span-1233"></span><span class="munder" id="MathJax-Span-1234" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.84em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1235" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.35em, 4.268em, -999.998em); top: -3.321em; left: 0.747em;"><span class="mi" id="MathJax-Span-1236" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1237" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.598em;"><span class="mo" id="MathJax-Span-1238" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-1239"><span class="mrow" id="MathJax-Span-1240"><span class="mo" id="MathJax-Span-1241" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1242" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1243" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1244" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1245" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1246" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-1247" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1248" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-1249"></span><span class="mi" id="MathJax-Span-1250" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">p</span><span class="mo" id="MathJax-Span-1251" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1252" style="font-family: MathJax_Math-italic;">c</span><span class="texatom" id="MathJax-Span-1253"><span class="mrow" id="MathJax-Span-1254"><span class="mo" id="MathJax-Span-1255" style="font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-1256" style="font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1257" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1258" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="munderover" id="MathJax-Span-1259" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.598em;"><span class="mo" id="MathJax-Span-1260" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-1261"><span class="mrow" id="MathJax-Span-1262"><span class="mo" id="MathJax-Span-1263" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1264" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1265" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1266" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1267" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1268" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-1269" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1270" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1271" style="font-family: MathJax_Main;">log</span><span class="mo" id="MathJax-Span-1272"></span><span class="msubsup" id="MathJax-Span-1273" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.086em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1274" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.449em;"><span class="texatom" id="MathJax-Span-1275"><span class="mrow" id="MathJax-Span-1276"><span class="msubsup" id="MathJax-Span-1277"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1278" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1279" style="font-size: 50%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1280" style="font-size: 70.7%; font-family: MathJax_Main;">⋅</span><span class="msubsup" id="MathJax-Span-1281"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1282" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1283" style="font-size: 50%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1284" style="font-family: MathJax_Main; padding-left: 0.201em;">−</span><span class="mi" id="MathJax-Span-1285" style="font-family: MathJax_Main; padding-left: 0.201em;">log</span><span class="mo" id="MathJax-Span-1286"></span><span class="munderover" id="MathJax-Span-1287" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1288" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.09em, 4.268em, -999.998em); top: -2.924em; left: 0.151em;"><span class="texatom" id="MathJax-Span-1289"><span class="mrow" id="MathJax-Span-1290"><span class="mi" id="MathJax-Span-1291" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1292" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-1293" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.276em, 1000.55em, 4.169em, -999.998em); top: -5.156em; left: 0.449em;"><span class="mi" id="MathJax-Span-1294" style="font-size: 70.7%; font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.151em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-1295" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.086em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1296" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.412em; left: 0.449em;"><span class="texatom" id="MathJax-Span-1297"><span class="mrow" id="MathJax-Span-1298"><span class="msubsup" id="MathJax-Span-1299"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1300" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1301" style="font-size: 50%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1302" style="font-size: 70.7%; font-family: MathJax_Main;">⋅</span><span class="msubsup" id="MathJax-Span-1303"><span style="display: inline-block; position: relative; width: 0.548em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1304" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1305" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1306" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.872em; border-left: 0px solid; width: 0px; height: 4.128em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-96">\arg \underset{\theta}{\max} \sum_{(w, c) \in D} \log p(c|w)=\sum_{(w, c) \in D}(\log e^{v_w \cdot v_c}-\log \sum_{i=1}^V e^{v_w \cdot v_i})</script></p><p>如果对上述目标函数进行优化，第二项需要对词典里的所有词进行优化，所以计算量比较大。如果换个角度考虑，<span style="text-decoration: underline;">如果我们将合理的上下文样本对看成是 1，不合理的上下文样本对看成是 0，那么问题转换为二分类问题</span>，那么我们目标就是最大化下面的目标函数：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-97-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-1307" style="width: 20.786em; display: inline-block;"><span style="display: inline-block; position: relative; width: 16.471em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(-1.833em, 1016.37em, 6.203em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1308"><span class="mtable" id="MathJax-Span-1309"><span style="display: inline-block; position: relative; width: 16.173em; height: 0px; margin-right: 0.151em; margin-left: 0.151em;"><span style="position: absolute; clip: rect(2.879em, 1000.75em, 8.385em, -999.998em); top: -6.198em; left: 0em;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.872em, 1000em, 4.169em, -999.998em); top: -7.19em; right: 0em;"><span class="mtd" id="MathJax-Span-1310"><span class="mrow" id="MathJax-Span-1311"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.75em, 4.02em, -999.998em); top: -4.511em; right: 0em;"><span class="mtd" id="MathJax-Span-1342"><span class="mrow" id="MathJax-Span-1343"><span class="mo" id="MathJax-Span-1344" style="font-family: MathJax_Main;">=</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.75em, 4.02em, -999.998em); top: -1.833em; right: 0em;"><span class="mtd" id="MathJax-Span-1378"><span class="mrow" id="MathJax-Span-1379"><span class="mo" id="MathJax-Span-1380" style="font-family: MathJax_Main;">=</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 6.203em;"></span></span><span style="position: absolute; clip: rect(4.467em, 1015.28em, 12.502em, -999.998em); top: -8.728em; left: 0.796em;"><span style="display: inline-block; position: relative; width: 15.379em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1013.59em, 5.608em, -999.998em); top: -7.19em; left: 0em;"><span class="mtd" id="MathJax-Span-1312"><span class="mrow" id="MathJax-Span-1313"><span class="mi" id="MathJax-Span-1314" style="font-family: MathJax_Main;">arg</span><span class="mo" id="MathJax-Span-1315"></span><span class="munder" id="MathJax-Span-1316" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.84em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1317" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.35em, 4.268em, -999.998em); top: -3.321em; left: 0.747em;"><span class="mi" id="MathJax-Span-1318" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1319" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.24em, 4.616em, -999.998em); top: -4.015em; left: 0.647em;"><span class="mo" id="MathJax-Span-1320" style="font-family: MathJax_Size2; vertical-align: 0em;">∏</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-1321"><span class="mrow" id="MathJax-Span-1322"><span class="mo" id="MathJax-Span-1323" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1324" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1325" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1326" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1327" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1328" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-1329" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1330" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">p</span><span class="mo" id="MathJax-Span-1331" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1332" style="font-family: MathJax_Math-italic;">D</span><span class="mo" id="MathJax-Span-1333" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1334" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-1335" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="mi" id="MathJax-Span-1336" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">w</span><span class="mo" id="MathJax-Span-1337" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1338" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">c</span><span class="mo" id="MathJax-Span-1339" style="font-family: MathJax_Main;">;</span><span class="mi" id="MathJax-Span-1340" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">θ</span><span class="mo" id="MathJax-Span-1341" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.929em, 1015.28em, 5.608em, -999.998em); top: -4.511em; left: 0em;"><span class="mtd" id="MathJax-Span-1345"><span class="mrow" id="MathJax-Span-1346"><span class="mi" id="MathJax-Span-1347" style="font-family: MathJax_Main;">arg</span><span class="mo" id="MathJax-Span-1348"></span><span class="munder" id="MathJax-Span-1349" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.84em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1350" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.35em, 4.268em, -999.998em); top: -3.321em; left: 0.747em;"><span class="mi" id="MathJax-Span-1351" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mspace" id="MathJax-Span-1352" style="height: 0em; vertical-align: 0em; width: 0.3em; display: inline-block; overflow: hidden;"></span><span class="mi" id="MathJax-Span-1353" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-1354"></span><span class="munderover" id="MathJax-Span-1355" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.24em, 4.616em, -999.998em); top: -4.015em; left: 0.647em;"><span class="mo" id="MathJax-Span-1356" style="font-family: MathJax_Size2; vertical-align: 0em;">∏</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-1357"><span class="mrow" id="MathJax-Span-1358"><span class="mo" id="MathJax-Span-1359" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1360" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1361" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1362" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1363" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1364" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-1365" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1366" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">p</span><span class="mo" id="MathJax-Span-1367" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1368" style="font-family: MathJax_Math-italic;">D</span><span class="mo" id="MathJax-Span-1369" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1370" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-1371" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="mi" id="MathJax-Span-1372" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">w</span><span class="mo" id="MathJax-Span-1373" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1374" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">c</span><span class="mo" id="MathJax-Span-1375" style="font-family: MathJax_Main;">;</span><span class="mi" id="MathJax-Span-1376" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">θ</span><span class="mo" id="MathJax-Span-1377" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.929em, 1014.98em, 5.608em, -999.998em); top: -1.833em; left: 0em;"><span class="mtd" id="MathJax-Span-1381"><span class="mrow" id="MathJax-Span-1382"><span class="mi" id="MathJax-Span-1383" style="font-family: MathJax_Main;">arg</span><span class="mo" id="MathJax-Span-1384"></span><span class="munder" id="MathJax-Span-1385" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.84em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1386" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.35em, 4.268em, -999.998em); top: -3.321em; left: 0.747em;"><span class="mi" id="MathJax-Span-1387" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1388" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.598em;"><span class="mo" id="MathJax-Span-1389" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-1390"><span class="mrow" id="MathJax-Span-1391"><span class="mo" id="MathJax-Span-1392" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1393" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1394" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1395" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1396" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1397" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-1398" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1399" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-1400"></span><span class="mi" id="MathJax-Span-1401" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">p</span><span class="mo" id="MathJax-Span-1402" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1403" style="font-family: MathJax_Math-italic;">D</span><span class="mo" id="MathJax-Span-1404" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1405" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-1406" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="mi" id="MathJax-Span-1407" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">w</span><span class="mo" id="MathJax-Span-1408" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1409" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">c</span><span class="mo" id="MathJax-Span-1410" style="font-family: MathJax_Main;">;</span><span class="mi" id="MathJax-Span-1411" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">θ</span><span class="mo" id="MathJax-Span-1412" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 8.733em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -4.622em; border-left: 0px solid; width: 0px; height: 9.878em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-97">\begin{align} &\arg \underset{\theta}{\max} \prod_{(w, c) \in D} p(D=1 \mid w,c;\theta) \\ =&\arg \underset{\theta}{\max} \;\log \prod_{(w, c) \in D} p(D=1 \mid w,c;\theta) \\ =&\arg \underset{\theta}{\max} \sum_{(w, c) \in D} \log p(D=1 \mid w,c;\theta) \end {align}</script></p><p>使用 Softmax 来定义 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-98-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1413" style="width: 9.278em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.344em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1007.25em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1414"><span class="mi" id="MathJax-Span-1415" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-1416" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1417" style="font-family: MathJax_Math-italic;">D</span><span class="mo" id="MathJax-Span-1418" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1419" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-1420" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="mi" id="MathJax-Span-1421" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">w</span><span class="mo" id="MathJax-Span-1422" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1423" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">c</span><span class="mo" id="MathJax-Span-1424" style="font-family: MathJax_Main;">;</span><span class="mi" id="MathJax-Span-1425" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">θ</span><span class="mo" id="MathJax-Span-1426" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-98">p(D=1 \mid w,c;\theta)</script>：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-99-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-1427" style="width: 16.917em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.395em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.945em, 1013.39em, 3.326em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1428"><span class="mi" id="MathJax-Span-1429" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-1430" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1431" style="font-family: MathJax_Math-italic;">D</span><span class="mo" id="MathJax-Span-1432" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1433" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-1434" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="mi" id="MathJax-Span-1435" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">w</span><span class="mo" id="MathJax-Span-1436" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1437" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">c</span><span class="mo" id="MathJax-Span-1438" style="font-family: MathJax_Main;">;</span><span class="mi" id="MathJax-Span-1439" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">θ</span><span class="mo" id="MathJax-Span-1440" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1441" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-1442" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 4.467em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.227em, 1000.45em, 4.169em, -999.998em); top: -4.71em; left: 50%; margin-left: -0.246em;"><span class="mn" id="MathJax-Span-1443" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1004.32em, 4.268em, -999.998em); top: -3.321em; left: 50%; margin-left: -2.18em;"><span class="mrow" id="MathJax-Span-1444"><span class="mn" id="MathJax-Span-1445" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1446" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="msubsup" id="MathJax-Span-1447" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 2.681em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1448" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.449em;"><span class="texatom" id="MathJax-Span-1449"><span class="mrow" id="MathJax-Span-1450"><span class="mo" id="MathJax-Span-1451" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="msubsup" id="MathJax-Span-1452"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1453" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1454" style="font-size: 50%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1455" style="font-size: 70.7%; font-family: MathJax_Main;">⋅</span><span class="msubsup" id="MathJax-Span-1456"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1457" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1458" style="font-size: 50%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1004.47em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.467em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.997em; border-left: 0px solid; width: 0px; height: 2.816em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-99"> p(D=1 \mid w,c;\theta)=\frac{1}{1+e^{-v_w \cdot v_c}}</script></p><p>带入目标函数：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-100-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-1459" style="width: 15.727em; display: inline-block;"><span style="display: inline-block; position: relative; width: 12.453em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.945em, 1012.45em, 4.02em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1460"><span class="mi" id="MathJax-Span-1461" style="font-family: MathJax_Main;">arg</span><span class="mo" id="MathJax-Span-1462"></span><span class="munder" id="MathJax-Span-1463" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.84em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1464" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.35em, 4.268em, -999.998em); top: -3.321em; left: 0.747em;"><span class="mi" id="MathJax-Span-1465" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1466" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.598em;"><span class="mo" id="MathJax-Span-1467" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-1468"><span class="mrow" id="MathJax-Span-1469"><span class="mo" id="MathJax-Span-1470" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1471" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1472" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1473" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1474" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1475" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-1476" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1477" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-1478"></span><span class="mfrac" id="MathJax-Span-1479" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 4.467em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.227em, 1000.45em, 4.169em, -999.998em); top: -4.71em; left: 50%; margin-left: -0.246em;"><span class="mn" id="MathJax-Span-1480" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1004.32em, 4.268em, -999.998em); top: -3.321em; left: 50%; margin-left: -2.18em;"><span class="mrow" id="MathJax-Span-1481"><span class="mn" id="MathJax-Span-1482" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1483" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="msubsup" id="MathJax-Span-1484" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 2.681em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1485" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.449em;"><span class="texatom" id="MathJax-Span-1486"><span class="mrow" id="MathJax-Span-1487"><span class="mo" id="MathJax-Span-1488" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="msubsup" id="MathJax-Span-1489"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1490" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1491" style="font-size: 50%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1492" style="font-size: 70.7%; font-family: MathJax_Main;">⋅</span><span class="msubsup" id="MathJax-Span-1493"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1494" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1495" style="font-size: 50%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1004.47em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.467em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.872em; border-left: 0px solid; width: 0px; height: 3.628em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-100">\arg \underset{\theta}{\max} \sum_{(w, c) \in D} \log \frac{1}{1+e^{-v_w \cdot v_c}} </script></p><p><span style="text-decoration: underline;">不过这个目标函数存在问题，如果 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-101-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1496" style="width: 4.12em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.276em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1003.28em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1497"><span class="msubsup" id="MathJax-Span-1498"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1499" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-1500" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1501" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-1502" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1503" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-1504" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-101">v_w = v_c</script> 且 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-102-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1505" style="width: 3.276em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.582em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1002.58em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1506"><span class="msubsup" id="MathJax-Span-1507"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1508" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-1509" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1510" style="font-family: MathJax_Main; padding-left: 0.201em;">⋅</span><span class="msubsup" id="MathJax-Span-1511" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1512" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-1513" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-102">v_w \cdot v_c</script> 足够大的话（论文中提到 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-103-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1514" style="width: 6.252em; display: inline-block;"><span style="display: inline-block; position: relative; width: 4.963em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em, 1004.91em, 2.879em, -999.998em); top: -2.577em; left: 0em;"><span class="mrow" id="MathJax-Span-1515"><span class="msubsup" id="MathJax-Span-1516"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1517" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-1518" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1519" style="font-family: MathJax_Main; padding-left: 0.201em;">⋅</span><span class="msubsup" id="MathJax-Span-1520" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1521" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-1522" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1523" style="font-family: MathJax_AMS; padding-left: 0.3em;">≈</span><span class="mn" id="MathJax-Span-1524" style="font-family: MathJax_Main; padding-left: 0.3em;">40</span></span><span style="display: inline-block; width: 0px; height: 2.582em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-103">v_w \cdot v_c \thickapprox 40</script> 就能让概率接近 1），就能取到最大值，这时所有的词向量都是一样的，因此最终得到的 Embedding 向量也就没了意义。我们需要一种机制，通过不允许某些 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-104-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1525" style="width: 3.475em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.731em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.491em, 1002.63em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1526"><span class="mo" id="MathJax-Span-1527" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1528" style="font-family: MathJax_Math-italic;">w</span><span class="texatom" id="MathJax-Span-1529"><span class="mrow" id="MathJax-Span-1530"><span class="mo" id="MathJax-Span-1531"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 79%; font-style: normal; font-weight: normal;">，</span></span></span></span><span class="mi" id="MathJax-Span-1532" style="font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1533" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-104">(w，c)</script> 样本对的出现来防止所有向量具有相同的值。所以才考虑负例采样，加入负样本</span>：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-105-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-1534" style="width: 38.247em; display: inline-block;"><span style="display: inline-block; position: relative; width: 30.36em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(-5.007em, 1030.26em, 9.377em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1535"><span class="mtable" id="MathJax-Span-1536"><span style="display: inline-block; position: relative; width: 30.062em; height: 0px; margin-right: 0.151em; margin-left: 0.151em;"><span style="position: absolute; clip: rect(6.004em, 1000.75em, 17.81em, -999.998em); top: -12.498em; left: 0em;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.872em, 1000em, 4.169em, -999.998em); top: -10.365em; right: 0em;"><span class="mtd" id="MathJax-Span-1537"><span class="mrow" id="MathJax-Span-1538"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.75em, 4.02em, -999.998em); top: -7.636em; right: 0em;"><span class="mtd" id="MathJax-Span-1594"><span class="mrow" id="MathJax-Span-1595"><span class="mo" id="MathJax-Span-1596" style="font-family: MathJax_Main;">=</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.75em, 4.02em, -999.998em); top: -4.908em; right: 0em;"><span class="mtd" id="MathJax-Span-1656"><span class="mrow" id="MathJax-Span-1657"><span class="mo" id="MathJax-Span-1658" style="font-family: MathJax_Main;">=</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.75em, 4.02em, -999.998em); top: -1.833em; right: 0em;"><span class="mtd" id="MathJax-Span-1722"><span class="mrow" id="MathJax-Span-1723"><span class="mo" id="MathJax-Span-1724" style="font-family: MathJax_Main;">=</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.75em, 4.02em, -999.998em); top: 1.292em; right: 0em;"><span class="mtd" id="MathJax-Span-1798"><span class="mrow" id="MathJax-Span-1799"><span class="mo" id="MathJax-Span-1800" style="font-family: MathJax_Main;">=</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 12.502em;"></span></span><span style="position: absolute; clip: rect(7.592em, 1029.17em, 21.977em, -999.998em); top: -15.027em; left: 0.796em;"><span style="display: inline-block; position: relative; width: 29.268em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1024.01em, 5.657em, -999.998em); top: -10.365em; left: 0em;"><span class="mtd" id="MathJax-Span-1539"><span class="mrow" id="MathJax-Span-1540"><span class="mi" id="MathJax-Span-1541" style="font-family: MathJax_Main;">arg</span><span class="mo" id="MathJax-Span-1542"></span><span class="munder" id="MathJax-Span-1543" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.84em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1544" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.35em, 4.268em, -999.998em); top: -3.321em; left: 0.747em;"><span class="mi" id="MathJax-Span-1545" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1546" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.24em, 4.616em, -999.998em); top: -4.015em; left: 0.647em;"><span class="mo" id="MathJax-Span-1547" style="font-family: MathJax_Size2; vertical-align: 0em;">∏</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-1548"><span class="mrow" id="MathJax-Span-1549"><span class="mo" id="MathJax-Span-1550" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1551" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1552" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1553" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1554" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1555" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-1556" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1557" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">p</span><span class="mo" id="MathJax-Span-1558" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1559" style="font-family: MathJax_Math-italic;">D</span><span class="mo" id="MathJax-Span-1560" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1561" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-1562" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="mi" id="MathJax-Span-1563" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">w</span><span class="mo" id="MathJax-Span-1564" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1565" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">c</span><span class="mo" id="MathJax-Span-1566" style="font-family: MathJax_Main;">;</span><span class="mi" id="MathJax-Span-1567" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">θ</span><span class="mo" id="MathJax-Span-1568" style="font-family: MathJax_Main;">)</span><span class="munderover" id="MathJax-Span-1569" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.83em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.24em, 4.616em, -999.998em); top: -4.015em; left: 0.747em;"><span class="mo" id="MathJax-Span-1570" style="font-family: MathJax_Size2; vertical-align: 0em;">∏</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.83em, 4.467em, -999.998em); top: -2.825em; left: 0em;"><span class="texatom" id="MathJax-Span-1571"><span class="mrow" id="MathJax-Span-1572"><span class="mo" id="MathJax-Span-1573" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1574" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1575" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1576" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1577" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1578" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="msup" id="MathJax-Span-1579"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1580" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.598em;"><span class="mo" id="MathJax-Span-1581" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1582" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">p</span><span class="mo" id="MathJax-Span-1583" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1584" style="font-family: MathJax_Math-italic;">D</span><span class="mo" id="MathJax-Span-1585" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1586" style="font-family: MathJax_Main; padding-left: 0.3em;">0</span><span class="mo" id="MathJax-Span-1587" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="mi" id="MathJax-Span-1588" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">w</span><span class="mo" id="MathJax-Span-1589" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1590" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">c</span><span class="mo" id="MathJax-Span-1591" style="font-family: MathJax_Main;">;</span><span class="mi" id="MathJax-Span-1592" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">θ</span><span class="mo" id="MathJax-Span-1593" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.929em, 1026.34em, 5.657em, -999.998em); top: -7.636em; left: 0em;"><span class="mtd" id="MathJax-Span-1597"><span class="mrow" id="MathJax-Span-1598"><span class="mi" id="MathJax-Span-1599" style="font-family: MathJax_Main;">arg</span><span class="mo" id="MathJax-Span-1600"></span><span class="munder" id="MathJax-Span-1601" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.84em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1602" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.35em, 4.268em, -999.998em); top: -3.321em; left: 0.747em;"><span class="mi" id="MathJax-Span-1603" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1604" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.24em, 4.616em, -999.998em); top: -4.015em; left: 0.647em;"><span class="mo" id="MathJax-Span-1605" style="font-family: MathJax_Size2; vertical-align: 0em;">∏</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-1606"><span class="mrow" id="MathJax-Span-1607"><span class="mo" id="MathJax-Span-1608" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1609" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1610" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1611" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1612" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1613" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-1614" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1615" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">p</span><span class="mo" id="MathJax-Span-1616" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1617" style="font-family: MathJax_Math-italic;">D</span><span class="mo" id="MathJax-Span-1618" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1619" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-1620" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="mi" id="MathJax-Span-1621" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">w</span><span class="mo" id="MathJax-Span-1622" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1623" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">c</span><span class="mo" id="MathJax-Span-1624" style="font-family: MathJax_Main;">;</span><span class="mi" id="MathJax-Span-1625" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">θ</span><span class="mo" id="MathJax-Span-1626" style="font-family: MathJax_Main;">)</span><span class="munderover" id="MathJax-Span-1627" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.83em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.24em, 4.616em, -999.998em); top: -4.015em; left: 0.747em;"><span class="mo" id="MathJax-Span-1628" style="font-family: MathJax_Size2; vertical-align: 0em;">∏</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.83em, 4.467em, -999.998em); top: -2.825em; left: 0em;"><span class="texatom" id="MathJax-Span-1629"><span class="mrow" id="MathJax-Span-1630"><span class="mo" id="MathJax-Span-1631" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1632" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1633" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1634" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1635" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1636" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="msup" id="MathJax-Span-1637"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1638" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.598em;"><span class="mo" id="MathJax-Span-1639" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1640" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-1641" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1642" style="font-family: MathJax_Main; padding-left: 0.201em;">−</span><span class="mi" id="MathJax-Span-1643" style="font-family: MathJax_Math-italic; padding-left: 0.201em;">p</span><span class="mo" id="MathJax-Span-1644" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1645" style="font-family: MathJax_Math-italic;">D</span><span class="mo" id="MathJax-Span-1646" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1647" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-1648" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="mi" id="MathJax-Span-1649" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">w</span><span class="mo" id="MathJax-Span-1650" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1651" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">c</span><span class="mo" id="MathJax-Span-1652" style="font-family: MathJax_Main;">;</span><span class="mi" id="MathJax-Span-1653" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">θ</span><span class="mo" id="MathJax-Span-1654" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1655" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.929em, 1029.17em, 5.657em, -999.998em); top: -4.908em; left: 0em;"><span class="mtd" id="MathJax-Span-1659"><span class="mrow" id="MathJax-Span-1660"><span class="mi" id="MathJax-Span-1661" style="font-family: MathJax_Main;">arg</span><span class="mo" id="MathJax-Span-1662"></span><span class="munder" id="MathJax-Span-1663" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.84em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1664" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.35em, 4.268em, -999.998em); top: -3.321em; left: 0.747em;"><span class="mi" id="MathJax-Span-1665" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1666" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.598em;"><span class="mo" id="MathJax-Span-1667" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-1668"><span class="mrow" id="MathJax-Span-1669"><span class="mo" id="MathJax-Span-1670" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1671" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1672" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1673" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1674" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1675" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-1676" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1677" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-1678"></span><span class="mi" id="MathJax-Span-1679" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">p</span><span class="mo" id="MathJax-Span-1680" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1681" style="font-family: MathJax_Math-italic;">D</span><span class="mo" id="MathJax-Span-1682" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1683" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-1684" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="mi" id="MathJax-Span-1685" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">w</span><span class="mo" id="MathJax-Span-1686" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1687" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">c</span><span class="mo" id="MathJax-Span-1688" style="font-family: MathJax_Main;">;</span><span class="mi" id="MathJax-Span-1689" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">θ</span><span class="mo" id="MathJax-Span-1690" style="font-family: MathJax_Main;">)</span><span class="munderover" id="MathJax-Span-1691" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.83em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.697em;"><span class="mo" id="MathJax-Span-1692" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.83em, 4.467em, -999.998em); top: -2.825em; left: 0em;"><span class="texatom" id="MathJax-Span-1693"><span class="mrow" id="MathJax-Span-1694"><span class="mo" id="MathJax-Span-1695" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1696" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1697" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1698" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1699" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1700" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="msup" id="MathJax-Span-1701"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1702" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.598em;"><span class="mo" id="MathJax-Span-1703" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1704" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-1705"></span><span class="mo" id="MathJax-Span-1706" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-1707" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1708" style="font-family: MathJax_Main; padding-left: 0.201em;">−</span><span class="mi" id="MathJax-Span-1709" style="font-family: MathJax_Math-italic; padding-left: 0.201em;">p</span><span class="mo" id="MathJax-Span-1710" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1711" style="font-family: MathJax_Math-italic;">D</span><span class="mo" id="MathJax-Span-1712" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-1713" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span><span class="mo" id="MathJax-Span-1714" style="font-family: MathJax_Main; padding-left: 0.3em;">∣</span><span class="mi" id="MathJax-Span-1715" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">w</span><span class="mo" id="MathJax-Span-1716" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1717" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">c</span><span class="mo" id="MathJax-Span-1718" style="font-family: MathJax_Main;">;</span><span class="mi" id="MathJax-Span-1719" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">θ</span><span class="mo" id="MathJax-Span-1720" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1721" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.532em, 1023.91em, 5.657em, -999.998em); top: -1.833em; left: 0em;"><span class="mtd" id="MathJax-Span-1725"><span class="mrow" id="MathJax-Span-1726"><span class="mi" id="MathJax-Span-1727" style="font-family: MathJax_Main;">arg</span><span class="mo" id="MathJax-Span-1728"></span><span class="munder" id="MathJax-Span-1729" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.84em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1730" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.35em, 4.268em, -999.998em); top: -3.321em; left: 0.747em;"><span class="mi" id="MathJax-Span-1731" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1732" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.598em;"><span class="mo" id="MathJax-Span-1733" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-1734"><span class="mrow" id="MathJax-Span-1735"><span class="mo" id="MathJax-Span-1736" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1737" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1738" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1739" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1740" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1741" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-1742" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1743" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-1744"></span><span class="mfrac" id="MathJax-Span-1745" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 4.467em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.227em, 1000.45em, 4.169em, -999.998em); top: -4.71em; left: 50%; margin-left: -0.246em;"><span class="mn" id="MathJax-Span-1746" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1004.32em, 4.268em, -999.998em); top: -3.321em; left: 50%; margin-left: -2.18em;"><span class="mrow" id="MathJax-Span-1747"><span class="mn" id="MathJax-Span-1748" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1749" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="msubsup" id="MathJax-Span-1750" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 2.681em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1751" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.449em;"><span class="texatom" id="MathJax-Span-1752"><span class="mrow" id="MathJax-Span-1753"><span class="mo" id="MathJax-Span-1754" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="msubsup" id="MathJax-Span-1755"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1756" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1757" style="font-size: 50%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1758" style="font-size: 70.7%; font-family: MathJax_Main;">⋅</span><span class="msubsup" id="MathJax-Span-1759"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1760" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1761" style="font-size: 50%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1004.47em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.467em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1762" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.83em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.697em;"><span class="mo" id="MathJax-Span-1763" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.83em, 4.467em, -999.998em); top: -2.825em; left: 0em;"><span class="texatom" id="MathJax-Span-1764"><span class="mrow" id="MathJax-Span-1765"><span class="mo" id="MathJax-Span-1766" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1767" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1768" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1769" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1770" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1771" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="msup" id="MathJax-Span-1772"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1773" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.598em;"><span class="mo" id="MathJax-Span-1774" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1775" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-1776"></span><span class="mo" id="MathJax-Span-1777" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-1778" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1779" style="font-family: MathJax_Main; padding-left: 0.201em;">−</span><span class="mfrac" id="MathJax-Span-1780" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 4.467em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.227em, 1000.45em, 4.169em, -999.998em); top: -4.71em; left: 50%; margin-left: -0.246em;"><span class="mn" id="MathJax-Span-1781" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1004.32em, 4.268em, -999.998em); top: -3.321em; left: 50%; margin-left: -2.18em;"><span class="mrow" id="MathJax-Span-1782"><span class="mn" id="MathJax-Span-1783" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1784" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="msubsup" id="MathJax-Span-1785" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 2.681em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1786" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.449em;"><span class="texatom" id="MathJax-Span-1787"><span class="mrow" id="MathJax-Span-1788"><span class="mo" id="MathJax-Span-1789" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="msubsup" id="MathJax-Span-1790"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1791" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1792" style="font-size: 50%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1793" style="font-size: 70.7%; font-family: MathJax_Main;">⋅</span><span class="msubsup" id="MathJax-Span-1794"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1795" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1796" style="font-size: 50%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1004.47em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.467em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mo" id="MathJax-Span-1797" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.532em, 1021.13em, 5.657em, -999.998em); top: 1.292em; left: 0em;"><span class="mtd" id="MathJax-Span-1801"><span class="mrow" id="MathJax-Span-1802"><span class="mi" id="MathJax-Span-1803" style="font-family: MathJax_Main;">arg</span><span class="mo" id="MathJax-Span-1804"></span><span class="munder" id="MathJax-Span-1805" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.84em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1806" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.35em, 4.268em, -999.998em); top: -3.321em; left: 0.747em;"><span class="mi" id="MathJax-Span-1807" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1808" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.598em;"><span class="mo" id="MathJax-Span-1809" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-1810"><span class="mrow" id="MathJax-Span-1811"><span class="mo" id="MathJax-Span-1812" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1813" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1814" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1815" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1816" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1817" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-1818" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1819" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-1820"></span><span class="mfrac" id="MathJax-Span-1821" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 4.467em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.227em, 1000.45em, 4.169em, -999.998em); top: -4.71em; left: 50%; margin-left: -0.246em;"><span class="mn" id="MathJax-Span-1822" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1004.32em, 4.268em, -999.998em); top: -3.321em; left: 50%; margin-left: -2.18em;"><span class="mrow" id="MathJax-Span-1823"><span class="mn" id="MathJax-Span-1824" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1825" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="msubsup" id="MathJax-Span-1826" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 2.681em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1827" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.449em;"><span class="texatom" id="MathJax-Span-1828"><span class="mrow" id="MathJax-Span-1829"><span class="mo" id="MathJax-Span-1830" style="font-size: 70.7%; font-family: MathJax_Main;">−</span><span class="msubsup" id="MathJax-Span-1831"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1832" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1833" style="font-size: 50%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1834" style="font-size: 70.7%; font-family: MathJax_Main;">⋅</span><span class="msubsup" id="MathJax-Span-1835"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1836" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1837" style="font-size: 50%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1004.47em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.467em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1838" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.83em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.697em;"><span class="mo" id="MathJax-Span-1839" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.83em, 4.467em, -999.998em); top: -2.825em; left: 0em;"><span class="texatom" id="MathJax-Span-1840"><span class="mrow" id="MathJax-Span-1841"><span class="mo" id="MathJax-Span-1842" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1843" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1844" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1845" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1846" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1847" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="msup" id="MathJax-Span-1848"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1849" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.598em;"><span class="mo" id="MathJax-Span-1850" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1851" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-1852"></span><span class="mfrac" id="MathJax-Span-1853" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 3.921em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.227em, 1000.45em, 4.169em, -999.998em); top: -4.71em; left: 50%; margin-left: -0.246em;"><span class="mn" id="MathJax-Span-1854" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.227em, 1003.77em, 4.268em, -999.998em); top: -3.321em; left: 50%; margin-left: -1.882em;"><span class="mrow" id="MathJax-Span-1855"><span class="mn" id="MathJax-Span-1856" style="font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1857" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="msubsup" id="MathJax-Span-1858" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 2.086em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1859" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.449em;"><span class="texatom" id="MathJax-Span-1860"><span class="mrow" id="MathJax-Span-1861"><span class="msubsup" id="MathJax-Span-1862"><span style="display: inline-block; position: relative; width: 0.747em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1863" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1864" style="font-size: 50%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1865" style="font-size: 70.7%; font-family: MathJax_Main;">⋅</span><span class="msubsup" id="MathJax-Span-1866"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1867" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.35em;"><span class="mi" id="MathJax-Span-1868" style="font-size: 50%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1003.92em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 3.921em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 15.032em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -8.622em; border-left: 0px solid; width: 0px; height: 17.816em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-105">\begin{align} &\arg \underset{\theta}{\max} \prod_{(w, c) \in D} p(D=1 \mid w,c;\theta) \prod_{(w, c) \in D'} p(D=0 \mid w,c;\theta) \\ =&\arg \underset{\theta}{\max} \prod_{(w, c) \in D} p(D=1 \mid w,c;\theta) \prod_{(w, c) \in D'} (1-p(D=1 \mid w,c;\theta)) \\ =&\arg \underset{\theta}{\max} \sum_{(w, c) \in D} \log p(D=1 \mid w,c;\theta) \sum_{(w, c) \in D'} \log (1-p(D=1 \mid w,c;\theta)) \\ =&\arg \underset{\theta}{\max} \sum_{(w, c) \in D} \log \frac{1}{1+e^{-v_w \cdot v_c}} \sum_{(w, c) \in D'} \log (1-\frac{1}{1+e^{-v_w \cdot v_c}}) \\ =&\arg \underset{\theta}{\max} \sum_{(w, c) \in D} \log \frac{1}{1+e^{-v_w \cdot v_c}} \sum_{(w, c) \in D'} \log \frac{1}{1+e^{v_w \cdot v_c}} \end {align}</script></p><p>其中，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-106-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1869" style="width: 1.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1000.8em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1870"><span class="mi" id="MathJax-Span-1871" style="font-family: MathJax_Math-italic;">D</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-106">D</script> 是正例样本集合，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-107-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1872" style="width: 1.391em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1001.09em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1873"><span class="msup" id="MathJax-Span-1874"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.8em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1875" style="font-family: MathJax_Math-italic;">D</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.846em;"><span class="mo" id="MathJax-Span-1876" style="font-size: 70.7%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-107">D'</script> 是随机采样的负例样本集合，我们令 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-108-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1877" style="width: 7.096em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.608em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1005.61em, 3.028em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1878"><span class="mi" id="MathJax-Span-1879" style="font-family: MathJax_Math-italic;">σ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1880" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1881" style="font-family: MathJax_Math-italic;">x</span><span class="mo" id="MathJax-Span-1882" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1883" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-1884" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 2.086em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.425em, 1000.3em, 4.169em, -999.998em); top: -4.412em; left: 50%; margin-left: -0.196em;"><span class="mn" id="MathJax-Span-1885" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1001.99em, 4.219em, -999.998em); top: -3.619em; left: 50%; margin-left: -0.99em;"><span class="mrow" id="MathJax-Span-1886"><span class="mn" id="MathJax-Span-1887" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-1888" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="msubsup" id="MathJax-Span-1889"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.3em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1890" style="font-size: 70.7%; font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.214em; left: 0.35em;"><span class="texatom" id="MathJax-Span-1891"><span class="mrow" id="MathJax-Span-1892"><span class="mo" id="MathJax-Span-1893" style="font-size: 50%; font-family: MathJax_Main;">−</span><span class="mi" id="MathJax-Span-1894" style="font-size: 50%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1002.09em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.086em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.622em; border-left: 0px solid; width: 0px; height: 1.816em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-108">\sigma(x)=\frac{1}{1+e^{-x}}</script>，上式则可继续简化为：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-109-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-1895" style="width: 26.441em; display: inline-block;"><span style="display: inline-block; position: relative; width: 20.985em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.342em, 1020.88em, 4.07em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1896"><span class="mi" id="MathJax-Span-1897" style="font-family: MathJax_Main;">arg</span><span class="mo" id="MathJax-Span-1898"></span><span class="munder" id="MathJax-Span-1899" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.887em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1001.84em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1900" style="font-family: MathJax_Main;">max</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.35em, 4.268em, -999.998em); top: -3.321em; left: 0.747em;"><span class="mi" id="MathJax-Span-1901" style="font-size: 70.7%; font-family: MathJax_Math-italic;">θ</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1902" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.631em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.598em;"><span class="mo" id="MathJax-Span-1903" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.58em, 4.467em, -999.998em); top: -2.875em; left: 0em;"><span class="texatom" id="MathJax-Span-1904"><span class="mrow" id="MathJax-Span-1905"><span class="mo" id="MathJax-Span-1906" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1907" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1908" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1909" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1910" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1911" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="mi" id="MathJax-Span-1912" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1913" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-1914"></span><span class="mi" id="MathJax-Span-1915" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">σ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1916" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1917"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1918" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-1919" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1920" style="font-family: MathJax_Main; padding-left: 0.201em;">⋅</span><span class="msubsup" id="MathJax-Span-1921" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1922" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-1923" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1924" style="font-family: MathJax_Main;">)</span><span class="munderover" id="MathJax-Span-1925" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.83em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0.697em;"><span class="mo" id="MathJax-Span-1926" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1002.83em, 4.467em, -999.998em); top: -2.825em; left: 0em;"><span class="texatom" id="MathJax-Span-1927"><span class="mrow" id="MathJax-Span-1928"><span class="mo" id="MathJax-Span-1929" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-1930" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span class="mo" id="MathJax-Span-1931" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-1932" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span class="mo" id="MathJax-Span-1933" style="font-size: 70.7%; font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-1934" style="font-size: 70.7%; font-family: MathJax_Main;">∈</span><span class="msup" id="MathJax-Span-1935"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1936" style="font-size: 70.7%; font-family: MathJax_Math-italic;">D</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.598em;"><span class="mo" id="MathJax-Span-1937" style="font-size: 50%; font-family: MathJax_Main;">′</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1938" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-1939"></span><span class="mi" id="MathJax-Span-1940" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">σ<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-1941" style="font-family: MathJax_Main;">(</span><span class="mo" id="MathJax-Span-1942" style="font-family: MathJax_Main;">−</span><span class="msubsup" id="MathJax-Span-1943"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1944" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-1945" style="font-size: 70.7%; font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1946" style="font-family: MathJax_Main; padding-left: 0.201em;">⋅</span><span class="msubsup" id="MathJax-Span-1947" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1948" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-1949" style="font-size: 70.7%; font-family: MathJax_Math-italic;">c</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1950" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.934em; border-left: 0px solid; width: 0px; height: 3.191em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-109"> \arg \underset{\theta}{\max} \sum_{(w, c) \in D} \log \sigma (v_w \cdot v_c) \sum_{(w, c) \in D'} \log \sigma (-v_w \cdot v_c)</script></p><p>这个式子基本与 Mikolov 提出的一样。和 Hierarchical Softmax 类似，接下来采用随机梯度上升法，逐步完成参数更新。</p><h3 id="Word2Vec在推荐中的应用"><em>2.5.</em><span class="ez-toc-section" id="Word2Vec在推荐中的应用">Word2Vec在推荐中的应用</span></h3><p>Word2Vec 本身就是处理文本内容的一把 “利器”，因此它可以直接应用在基于内容的推荐算法中。内容推荐的一个常用方法是通过理解内容（挖掘内容属性）去挖掘用户的兴趣点来构建推荐模型，此时 Embedding 可以作为一个非常有效的方法来辅助理解内容，当然，这时的 Embedding 是依然是属于自然语言领域，也是它最本源的应用。</p><p>基于内容的推荐算法，从大多数业务的效果来看，这样的模型是有效的，也就是说用户行为与内容是相关的。不过有一点常被忽略的是：相关性是对称的！这意味着如果可以从内容属性去理解用户行为，预测用户行为，那么也可以通过理解用户行为去理解内容，预测内容属性。</p><h2 id="Item2Vec"><em>3.</em><span class="ez-toc-section" id="Item2Vec">Item2Vec</span></h2><p>📚 <a href="https://lumingdong.cn/go/xsivkm" rel="nofollow,noindex noopener noreferrer" target="_blank">Item2Vec: Neural Item Embedding for Collaborative Filtering</a></p><p>Embedding 是一种很好的思想或方法，不仅仅局限于自然语言处理领域，因为嵌入式表示有众多优势，因此很快有人就尝试把这种嵌入式表示的思想应用到推荐系统中。最常见的就是构建实体的嵌入式表示，使得多种实体的嵌入式表示存在于同一个隐含空间内， 进而可以计算两个实体之间的相似性。</p><p>与 Word2Vec 对应，这种方法被称为 Item2Vec，代表论文是微软研究人员在 2016 年发表《Item2Vec: Neural Item Embedding for Collaborative Filtering》。论文把 Word2vec 的 <strong>Skip-gram with Negative Sampling (SGNS)</strong>的算法思路迁移到基于物品的协同过滤 (Item-Based CF) 上，以物品的共现性作为自然语言中的上下文关系，构建神经网络学习出物品在隐空间的向量表示。</p><h3 id="从Word2Vec到Item2Vec"><em>3.1.</em><span class="ez-toc-section" id="从Word2Vec到Item2Vec">从Word2Vec到Item2Vec</span></h3><p>首先，我们知道 Word2Vec 在构建样本时，需要一个个句子构成的序列。那么在推荐场景的数据集中，如何构建这个序列，或者说如何生成训练样本？</p><p>在 Item2Vec 中，样本数据可以有两种看待方式：</p><ol start=""><li><p>基于时序</p><p>认为 item 之间存在强时序关系，即前面 item 对后面 item 的产生有很大的影响，那么可以把一段时间内连续发生的 item 序列看作是句子，序列中的 item 看作是句子中的词，这样与 Word2Vec 的训练数据的构造就没什么区别了，因此可以直接按照 Word2Vec 的方法进行 Embedding 训练。</p><p>基于时序的示例比如视频网站的用户观看的视频序列，音乐网站用户听的歌曲序列。</p></li><li><p>基于集合</p><p>认为 item 之间存在非常弱的时序关系，或者因为某种原因，我们无法获得 item 的序列。那么这种情况只能放弃考虑 item 间的时空信息，转而使用 item 集合来取代序列。通常我们把用户的行为序列视为一个集合（当然还有其他集合构造方式），我们假定一个静态的环境，在这个环境中，共现在同一个集合的 item 就可以认为它们是相似的，然后视为正样本，不管它们是以什么样的顺序产生的，如果某两个 item 频繁共现，二者的 Embedding 则可能也很相似。很明显，这种利用集合共现性构建样本的方式与 Word2Vec 的输入样本还是不一样的，因此无法直接应用 Word2Vec 的算法，这就需要对 Word2Vec 的过程进行调整。另外还需要注意的是，上面的这种的假设是有局限性的，不一定适用于其它场景。</p><p>基于集合的示例比如电商网站订单中的商品集合。</p></li></ol><p><u>到这里，再回想一下 Embedding 的本质是什么？是不是觉得有了更深的理解，个人理解，Embedding 就是通过给定大量的关联信息，就比如上面的两种样本构建方式分别是给定上下文信息以及共现集合的关联信息， 然后通过最大似然估计的方式来计算这些关系发生概率最大时的参数，再借助于参数来赋予个体一种抽象的隐含属性并且对这些属性编码赋值的过程，到最后，这些编码过的隐含属性就能表征甚至替代这些个体，而且还保留了原始个体间的关联信息，其实这些关联信息就是通过给隐含属性编码的方式来体现的。</u></p><p>论文中讨论的样本构建方法是第二种，作者还提出了<strong>两种相应的调整方式</strong>：</p><ol start=""><li>把 Word2Vec 的上下文窗口 (window size) 由定长的修改为变长的，窗口长度就是集合长度。其实也就是对整个 item 结合中的 item 进行两两组合构成正样本，此方法需要修改网络结构。</li><li>不修改网络结构，而在训练神经网络时对物品集合做 shuffle 操作，变相地起到忽略序列带来对影响。</li></ol><p>论文指出两种方法的实验效果基本一致。</p><p>Item2Vec 的论文使用的是第一种调整方法，即给定一个 iterm 集合，SGNS 的目标函数可以改为：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-110-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-1951" style="width: 12.205em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.675em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.548em, 1009.58em, 3.971em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1952"><span class="mfrac" id="MathJax-Span-1953"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.227em, 1000.45em, 4.169em, -999.998em); top: -4.71em; left: 50%; margin-left: -0.246em;"><span class="mn" id="MathJax-Span-1954" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1000.89em, 4.169em, -999.998em); top: -3.321em; left: 50%; margin-left: -0.444em;"><span class="mi" id="MathJax-Span-1955" style="font-family: MathJax_Math-italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1001em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.995em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1956" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1957" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.09em, 4.268em, -999.998em); top: -2.924em; left: 0.151em;"><span class="texatom" id="MathJax-Span-1958"><span class="mrow" id="MathJax-Span-1959"><span class="mi" id="MathJax-Span-1960" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mo" id="MathJax-Span-1961" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-1962" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.276em, 1000.65em, 4.169em, -999.998em); top: -5.156em; left: 0.399em;"><span class="texatom" id="MathJax-Span-1963"><span class="mrow" id="MathJax-Span-1964"><span class="mi" id="MathJax-Span-1965" style="font-size: 70.7%; font-family: MathJax_Math-italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="munderover" id="MathJax-Span-1966" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-1967" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1001.04em, 4.417em, -999.998em); top: -2.875em; left: 0.201em;"><span class="texatom" id="MathJax-Span-1968"><span class="mrow" id="MathJax-Span-1969"><span class="mi" id="MathJax-Span-1970" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-1971" style="font-size: 70.7%; font-family: MathJax_Main;">≠</span><span class="mi" id="MathJax-Span-1972" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.276em, 1000.65em, 4.169em, -999.998em); top: -5.156em; left: 0.399em;"><span class="texatom" id="MathJax-Span-1973"><span class="mrow" id="MathJax-Span-1974"><span class="mi" id="MathJax-Span-1975" style="font-size: 70.7%; font-family: MathJax_Math-italic;">K<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mi" id="MathJax-Span-1976" style="font-family: MathJax_Main; padding-left: 0.151em;">log</span><span class="mo" id="MathJax-Span-1977"></span><span class="mi" id="MathJax-Span-1978" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">p</span><span class="mo" id="MathJax-Span-1979" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-1980"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1981" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-1982" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="texatom" id="MathJax-Span-1983"><span class="mrow" id="MathJax-Span-1984"><span class="mo" id="MathJax-Span-1985" style="font-family: MathJax_Main;">|</span></span></span><span class="msubsup" id="MathJax-Span-1986"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1987" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-1988" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-1989" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.809em; border-left: 0px solid; width: 0px; height: 4.066em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-110">\frac{1}{K}\sum_{i=1}^{K}\sum_{j\neq i}^{K}\log p(w_j|w_i)</script></p><p>其中，K 是集合长度，因为摒弃了序列中 item 的时空关系，在原来的目标函数基础上，其实已经不存在时间窗口的概念了，或者说窗口长度就是集合长度，取而代之的是 item 集合中两两之间的条件概率。</p><p>在论文中，作者把<strong>中心词词向量</strong><span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-111-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1990" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.89em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1991"><span class="msubsup" id="MathJax-Span-1992"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-1993" style="font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-1994" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-111">u_i</script> 作为第 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-112-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1995" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.3em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1996"><span class="mi" id="MathJax-Span-1997" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-112">i</script> 个 item 的最终的向量表示，同时两个 item 的相似度是通过<strong>余弦相似度</strong>进行计算的。作者还指出，<strong>最终的词向量也可以选用上下文词向量 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-113-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-1998" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.8em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-1999"><span class="msubsup" id="MathJax-Span-2000"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2001" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2002" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-113">v_i</script>，甚至可以是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-114-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2003" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.89em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2004"><span class="msubsup" id="MathJax-Span-2005"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2006" style="font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-2007" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-114">u_i</script> 和 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-115-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2008" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.8em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2009"><span class="msubsup" id="MathJax-Span-2010"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2011" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2012" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-115">v_i</script> 的向量和 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-116-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2013" style="width: 3.624em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.879em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em, 1002.88em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2014"><span class="msubsup" id="MathJax-Span-2015"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2016" style="font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-2017" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2018" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="msubsup" id="MathJax-Span-2019" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2020" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2021" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-116">u_i+v_i</script> 或 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-117-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2022" style="width: 1.143em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.89em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2023"><span class="msubsup" id="MathJax-Span-2024"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2025" style="font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mi" id="MathJax-Span-2026" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-117">u_i</script> 和 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-118-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2027" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.8em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2028"><span class="msubsup" id="MathJax-Span-2029"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2030" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2031" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-118">v_i</script> 的连接 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-119-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2032" style="width: 4.219em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.326em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.441em, 1003.33em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2033"><span class="mo" id="MathJax-Span-2034" style="font-family: MathJax_Main;">[</span><span class="msubsup" id="MathJax-Span-2035"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2036" style="font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.598em;"><span class="mi" id="MathJax-Span-2037" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.3em, 4.169em, -999.998em); top: -3.718em; left: 0.598em;"><span class="mi" id="MathJax-Span-2038" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-2039"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2040" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.6em, 4.169em, -999.998em); top: -4.363em; left: 0.499em;"><span class="mi" id="MathJax-Span-2041" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.3em, 4.169em, -999.998em); top: -3.718em; left: 0.499em;"><span class="mi" id="MathJax-Span-2042" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-2043"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1000.15em, 4.417em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-2044" style="font-family: MathJax_Main;">]</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.3em;"><span class="mi" id="MathJax-Span-2045" style="font-size: 70.7%; font-family: MathJax_Math-italic;">T<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.566em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-119">[u_i^Tv_i^T]^T</script> 来表示，后两种表示方式有时候能够产生更好的向量化表示。</strong></p><p>论文中将 Word2Vecs 模型从自然语言序列迁移到物品集合，丢失了时间和空间的序列信息，导致<u>无法对用户行为程度建模（喜欢和购买是不同程度的行为，可以建模体现用户对不同 item 的喜欢程度高低）</u>。好处是可以忽略用户－物品关系，即便获得的订单不包含用户信息，也可以生成物品集合。而论文的结论证明，在一些场景下序列信息的丢失是可忍受的。</p><p>最终论文的实验表明，使用 Item2Vec 对协同过滤中的 item 计算相应的向量化表示，在 item 的相似度计算上比起 SVD 方法要更加优越，也就是说 <strong>Item2Vec 方法得到的 item 的向量化表示能够很好地提取 item 间的相似度特征</strong>。从应用上说，Embedding 也非常便于用于相似 item 主动检索，Item2vec 甚至能够应用到错误标签的检测和纠正上，所以 Item2vec 具有很好的使用价值，这也使得 Embedding 在很多深度学习推荐系统模型中几乎成了 “标配”。<sup class="md-footnote"><a href="#dfref-footnote-4" name="ref-footnote-4">4</a></sup></p><p><strong><u>Item2Vec 与 MF 有什么区别？</u></strong></p><p>首先，二者都应用了隐向量来表征实体特征，不同的是，传统的 MF 通常是 user-item 矩阵，而 Item2Vec 通过滑动窗口样本生成的方式构造出的则更像是 item-item 矩阵；另外，二者得到隐向量的方式也不同，MF 利用均方差损失，使预测得分与已有得分之间的误差尽可能地小，而 Item2Vec 则是利用空间信息并借助了最大似然估计的思想，使用对数损失，使上下文关系或者共现关系构造出的正样本的 item pair 出现的概率可能地大；此外训练 Item2Vec 的时候还要引入负样本，这也是与 MF 不同的地方。</p><p>对于二者在推荐效果上的差异，<u>一个经验是传统 MF 推荐会让热门内容经常性排在前面，而 Item2vec 能更好的学到中频内容的相似性。Iterm2Vec 加上较短的时间窗口，相似推荐会比 MF 好很多。</u><sup class="md-footnote"><a href="#dfref-footnote-5" name="ref-footnote-5">5</a></sup></p><p><strong>Embedding 的在推荐下局限性</strong></p><p>在推荐算法中使用 Embedding 有个前提，item 必须很庞大，如果 item 很小，估计效果就很不理想。也就是说，如果推荐的候选集很小（比如是供应商，供应商一般不会很大），此方法可能会失效。<sup class="md-footnote"><a href="#dfref-footnote-6" name="ref-footnote-6">6</a></sup></p><h3 id="端到端和非端到端的Embedding"><em>3.2.</em><span class="ez-toc-section" id="端到端和非端到端的Embedding">端到端和非端到端的Embedding</span></h3><p>Embedding 的训练可以分为两种方法：<strong>端到端（End-to-End）</strong>和<strong>非端到端</strong>的训练。</p><p><strong>端到端（嵌入层）</strong></p><p>端到端的方法是将 Embedding 层作为神经网络的一部分，在进行 BP 更新每一层参数的时候同时更新 Embedding，这种方法的<u>好处是让 Embedding 的训练成为一个有监督的方式，可以很好的与最终的目标产生联系，使得 Embedding 与最终目标处于同一意义空间</u>。（端到端的方法可参考 TensorFlow 中的 tf.nn.embedding_lookup 方法。）</p><p>将 Embedding 层与整个深度学习网络整合后一同进行训练是理论上最优的选择，因为上层梯度可以直接反向传播到输入层，模型整体是自洽和统一的。但这样做的<u>缺点同样显而易见的，由于 Embedding 层输入向量的维度甚大，Embedding 层的加入会拖慢整个神经网络的收敛速度。</u></p><blockquote><p>这里可以做一个简单的计算。假设输入层维度是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-120-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2046" style="width: 4.318em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.425em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1003.38em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2047"><span class="mn" id="MathJax-Span-2048" style="font-family: MathJax_Main;">100</span><span class="mo" id="MathJax-Span-2049" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-2050" style="font-family: MathJax_Main; padding-left: 0.151em;">000</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-120">100,000</script>，Embedding 输出维度是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-121-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2051" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.95em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2052"><span class="mn" id="MathJax-Span-2053" style="font-family: MathJax_Main;">32</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-121">32</script>，上层再加 5 层 32 维的全连接层，最后输出层维度是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-122-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2054" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.95em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2055"><span class="mn" id="MathJax-Span-2056" style="font-family: MathJax_Main;">10</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-122">10</script>，那么输入层到 Embedding 层的参数数量是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-123-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2057" style="width: 14.338em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.362em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1011.31em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2058"><span class="mn" id="MathJax-Span-2059" style="font-family: MathJax_Main;">100</span><span class="mo" id="MathJax-Span-2060" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-2061" style="font-family: MathJax_Main; padding-left: 0.151em;">000</span><span class="mo" id="MathJax-Span-2062" style="font-family: MathJax_Main; padding-left: 0.201em;">×</span><span class="mn" id="MathJax-Span-2063" style="font-family: MathJax_Main; padding-left: 0.201em;">32</span><span class="mo" id="MathJax-Span-2064" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-2065" style="font-family: MathJax_Main; padding-left: 0.3em;">3</span><span class="mo" id="MathJax-Span-2066" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-2067" style="font-family: MathJax_Main; padding-left: 0.151em;">200</span><span class="mo" id="MathJax-Span-2068" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-2069" style="font-family: MathJax_Main; padding-left: 0.151em;">000</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-123">100,000 \times 32 = 3,200,000</script>，其余所有层的参数总数是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-124-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2070" style="width: 16.917em; display: inline-block;"><span style="display: inline-block; position: relative; width: 13.395em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1013.35em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2071"><span class="mo" id="MathJax-Span-2072" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-2073" style="font-family: MathJax_Main;">32</span><span class="mo" id="MathJax-Span-2074" style="font-family: MathJax_Main; padding-left: 0.201em;">×</span><span class="mn" id="MathJax-Span-2075" style="font-family: MathJax_Main; padding-left: 0.201em;">32</span><span class="mo" id="MathJax-Span-2076" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2077" style="font-family: MathJax_Main; padding-left: 0.201em;">×</span><span class="mn" id="MathJax-Span-2078" style="font-family: MathJax_Main; padding-left: 0.201em;">4</span><span class="mo" id="MathJax-Span-2079" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="mn" id="MathJax-Span-2080" style="font-family: MathJax_Main; padding-left: 0.201em;">32</span><span class="mo" id="MathJax-Span-2081" style="font-family: MathJax_Main; padding-left: 0.201em;">×</span><span class="mn" id="MathJax-Span-2082" style="font-family: MathJax_Main; padding-left: 0.201em;">10</span><span class="mo" id="MathJax-Span-2083" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-2084" style="font-family: MathJax_Main; padding-left: 0.3em;">4416</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-124">(32 \times 32)\times 4+ 32 \times 10=4416</script>。那么 Embedding 层的权重总数占比是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-125-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2085" style="width: 22.274em; display: inline-block;"><span style="display: inline-block; position: relative; width: 17.661em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1017.61em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2086"><span class="mn" id="MathJax-Span-2087" style="font-family: MathJax_Main;">3</span><span class="mo" id="MathJax-Span-2088" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-2089" style="font-family: MathJax_Main; padding-left: 0.151em;">200</span><span class="mo" id="MathJax-Span-2090" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-2091" style="font-family: MathJax_Main; padding-left: 0.151em;">000</span><span class="texatom" id="MathJax-Span-2092"><span class="mrow" id="MathJax-Span-2093"><span class="mo" id="MathJax-Span-2094" style="font-family: MathJax_Main;">/</span></span></span><span class="mo" id="MathJax-Span-2095" style="font-family: MathJax_Main;">(</span><span class="mn" id="MathJax-Span-2096" style="font-family: MathJax_Main;">3</span><span class="mo" id="MathJax-Span-2097" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-2098" style="font-family: MathJax_Main; padding-left: 0.151em;">200</span><span class="mo" id="MathJax-Span-2099" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-2100" style="font-family: MathJax_Main; padding-left: 0.151em;">000</span><span class="mo" id="MathJax-Span-2101" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="mn" id="MathJax-Span-2102" style="font-family: MathJax_Main; padding-left: 0.201em;">4416</span><span class="mo" id="MathJax-Span-2103" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2104" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-2105" style="font-family: MathJax_Main; padding-left: 0.3em;">99.86</span><span class="mi" id="MathJax-Span-2106" style="font-family: MathJax_Main;">%</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-125">3,200,000 / (3,200,000 + 4416) = 99.86\%</script>。</p></blockquote><p>也就是说 Embedding 层的权重占据了整个网络权重的绝大部分。那么训练过程可想而知，<strong>大部分的训练时间和计算开销都被 Embedding 层所占据。</strong>正因为这个原因，<strong>对于那些时间要求较为苛刻的场景，Embedding 最好采用非端到端，也就是预训练的方式完成。</strong></p><p>当然，端到端的 Embedding 层在深度模型中还是非常常见的，由于高维稀疏特征向量天然不适合多层复杂神经网络的训练，因此如果使用深度学习模型处理高维稀疏特征向量，几乎都会在输入层到全连接层之间加入 Embedding 层完成高维稀疏特征向量到低维稠密特征向量的转换。</p><p>广义来说，Embedding 层的结构可以比较复杂，只要达到高维向量的降维目的就可以了，但<u>一般为了节省训练时间，深度神经网络中的 Embedding 层往往是一个简单的高维向量向低维向量的直接映射</u>，如下图：</p><p><noscript><img class="aligncenter wp-image-1990 size-full" title="推荐系统的中Embedding的应用实践" src="https://lumingdong.cn/wp-content/uploads/2019/08/v2-9f9f7fab71b32e982fcedf79a1ca1e04_hd.jpg" alt="推荐系统的中Embedding的应用实践" width="284" height="228" srcset="https://lumingdong.cn/wp-content/uploads/2019/08/v2-9f9f7fab71b32e982fcedf79a1ca1e04_hd.jpg 284w, https://lumingdong.cn/wp-content/uploads/2019/08/v2-9f9f7fab71b32e982fcedf79a1ca1e04_hd-150x120.jpg 150w" sizes="(max-width: 284px) 100vw, 284px" /></noscript><img class="lazyload aligncenter wp-image-1990 size-full" title="推荐系统的中Embedding的应用实践" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20284%20228%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/08/v2-9f9f7fab71b32e982fcedf79a1ca1e04_hd.jpg" alt="推荐系统的中Embedding的应用实践" width="284" height="228" data-srcset="https://lumingdong.cn/wp-content/uploads/2019/08/v2-9f9f7fab71b32e982fcedf79a1ca1e04_hd.jpg 284w, https://lumingdong.cn/wp-content/uploads/2019/08/v2-9f9f7fab71b32e982fcedf79a1ca1e04_hd-150x120.jpg 150w" data-sizes="(max-width: 284px) 100vw, 284px"></p><p>用矩阵的形式表达 Embedding 层，本质上是求解一个 m（输入高维稀疏向量的维度）乘以 n（输出稠密向量的维度）维的权重矩阵的过程。如果<strong>输入向量是 One-Hot 特征向量的话，权重矩阵中的列向量即为相应维度 One-Hot 特征的 Embedding 向量</strong>。</p><p>推荐系统应用实践中，使用端到端训练 Embedding 典型的例子，一个是微软的 Deep Crossing 模型：</p><p><noscript><img class="aligncenter wp-image-1991 size-full" title="推荐系统的中Embedding的应用实践" src="https://lumingdong.cn/wp-content/uploads/2019/08/20190801190322.png" alt="推荐系统的中Embedding的应用实践" width="568" height="379" srcset="https://lumingdong.cn/wp-content/uploads/2019/08/20190801190322.png 568w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801190322-150x100.png 150w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801190322-300x200.png 300w" sizes="(max-width: 568px) 100vw, 568px" /></noscript><img class="lazyload aligncenter wp-image-1991 size-full" title="推荐系统的中Embedding的应用实践" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20568%20379%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/08/20190801190322.png" alt="推荐系统的中Embedding的应用实践" width="568" height="379" data-srcset="https://lumingdong.cn/wp-content/uploads/2019/08/20190801190322.png 568w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801190322-150x100.png 150w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801190322-300x200.png 300w" data-sizes="(max-width: 568px) 100vw, 568px"></p><p>另外一个就是谷歌提出的著名的 Wide&amp;Deep 模型（深度部分）：</p><p><noscript><img class="aligncenter wp-image-1992 size-full" title="推荐系统的中Embedding的应用实践" src="https://lumingdong.cn/wp-content/uploads/2019/08/v2-b1f1a0c229ffcd75d12bb880f8dcae7c_hd.jpg" alt="推荐系统的中Embedding的应用实践" width="594" height="288" srcset="https://lumingdong.cn/wp-content/uploads/2019/08/v2-b1f1a0c229ffcd75d12bb880f8dcae7c_hd.jpg 594w, https://lumingdong.cn/wp-content/uploads/2019/08/v2-b1f1a0c229ffcd75d12bb880f8dcae7c_hd-150x73.jpg 150w, https://lumingdong.cn/wp-content/uploads/2019/08/v2-b1f1a0c229ffcd75d12bb880f8dcae7c_hd-300x145.jpg 300w" sizes="(max-width: 594px) 100vw, 594px" /></noscript><img class="lazyload aligncenter wp-image-1992 size-full" title="推荐系统的中Embedding的应用实践" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20594%20288%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/08/v2-b1f1a0c229ffcd75d12bb880f8dcae7c_hd.jpg" alt="推荐系统的中Embedding的应用实践" width="594" height="288" data-srcset="https://lumingdong.cn/wp-content/uploads/2019/08/v2-b1f1a0c229ffcd75d12bb880f8dcae7c_hd.jpg 594w, https://lumingdong.cn/wp-content/uploads/2019/08/v2-b1f1a0c229ffcd75d12bb880f8dcae7c_hd-150x73.jpg 150w, https://lumingdong.cn/wp-content/uploads/2019/08/v2-b1f1a0c229ffcd75d12bb880f8dcae7c_hd-300x145.jpg 300w" data-sizes="(max-width: 594px) 100vw, 594px"></p><p><strong>非端到端（预训练）</strong></p><p>也就是通过预训练获得 Embedding，上一小节讲到的 Word2Vec 方法，通过语料库切分后的一堆词构建样本进行训练，其目的很纯粹，就是为了得到词向量。在真正的任务中，训练词向量并不是最终目的，而是一个预处理过程，只是为了提高最终任务模型的性能且缩短训练时间。在做其他任务时，将训练集中的词替换成事先训练好的向量表示放到网络中，就是一个非端到端的过程。在推荐场景也是一样，由于 Embedding 层的训练开销巨大，因此在一些时间要求比较高的场景下，Embedding 的训练往往独立于深度学习网络进行，在得到稀疏特征的稠密表达之后，再与其他特征一起输入神经网络进行训练。</p><p>在自然语言中，非端到端很常见，因为学到一个好的的词向量表示，就能很好地挖掘出词之间的潜在关系，那么在其他语料训练集和自然语言任务中，也能很好地表征这些词的内在联系，预训练的方式得到的 Embedding 并不会对最终的任务和模型造成太大影响，但却能够<strong>提高效率节省时间</strong>，这也是预训练的一大好处。</p><p>但是在推荐场景下，根据不同目标构造出的序列不同，那么训练得到的 Embedding 挖掘出的关联信息也不同。所以，<strong>在推荐中要想用预训练的方式，必须保证 Embedding 的预训练和最终任务目标处于同一意义空间</strong>，否则就会造成预训练得到 Embedding 的意义和最终目标完全不一致。比如做召回阶段的深度模型的目标是衡量两个商品之间的相似性，但是 CTR 做的是预测用户点击商品的概率，<u>初始化一个不相关的 Embedding 会给模型带来更大的负担，更慢地收敛。</u><sup class="md-footnote"><a href="#dfref-footnote-3" name="ref-footnote-3">3</a></sup></p><p><strong>因此在推荐场景下，如果对于训练时间要求并不高的场景下，用端到端的训练方式可以得到更理想的效果。</strong></p><p>Word2Vec，Doc2Vec，<strong>Item2Vec</strong> 都是典型的非端到端的方法，另外需要注意一点，<strong>Embedding 的本质是建立高维向量到低维向量的映射，而 “映射” 的方法并不局限于神经网络，实质上可以是任何异构模型，这也是 Embedding 预训练的另一大优势，就是可以采用任何传统降维方法，机器学习模型，深度学习网络完成 Embedding 的生成。</strong></p><p>比如主题模型 <strong>LDA</strong> 可以给出每一篇<span style="text-decoration: underline;">文章下主题的分布向量，也可以看作是学习出了文章的 Embedding</span>：</p><p><a href="https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380.png"><noscript><img class="wp-image-2336 aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380.png" alt="" width="757" height="600" srcset="https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380.png 1000w, https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380-150x119.png 150w, https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380-300x238.png 300w, https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380-768x608.png 768w" sizes="(max-width: 757px) 100vw, 757px" /></noscript><img class="wp-image-2336 aligncenter lazyloaded" src="https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380.png" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380.png" alt="" width="757" height="600" data-srcset="https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380.png 1000w, https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380-150x119.png 150w, https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380-300x238.png 300w, https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380-768x608.png 768w" data-sizes="(max-width: 757px) 100vw, 757px" sizes="(max-width: 757px) 100vw, 757px" srcset="https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380.png 1000w, https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380-150x119.png 150w, https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380-300x238.png 300w, https://lumingdong.cn/wp-content/uploads/2019/07/201908011940380-768x608.png 768w"></a></p><p>在推荐系统应用实践中，<strong>FNN</strong> 也可以看做是一种采用 Embedding 预训练方法的模型：</p><p><a href="https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038.png"><noscript><img class="aligncenter size-full wp-image-1993" title="推荐系统的中Embedding的应用实践" src="https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038.png" alt="推荐系统的中Embedding的应用实践" width="877" height="608" srcset="https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038.png 877w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038-150x104.png 150w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038-300x208.png 300w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038-768x532.png 768w" sizes="(max-width: 877px) 100vw, 877px" /></noscript><img class="aligncenter size-full wp-image-1993 lazyloaded" title="推荐系统的中Embedding的应用实践" src="https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038.png" data-src="https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038.png" alt="推荐系统的中Embedding的应用实践" width="877" height="608" data-srcset="https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038.png 877w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038-150x104.png 150w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038-300x208.png 300w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038-768x532.png 768w" data-sizes="(max-width: 877px) 100vw, 877px" sizes="(max-width: 877px) 100vw, 877px" srcset="https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038.png 877w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038-150x104.png 150w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038-300x208.png 300w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194038-768x532.png 768w"></a></p><p><u>FNN 利用了 FM 训练得到的物品向量，作为 Embedding 层的初始化权重，从而加快了整个网络的收敛速度。</u>在实际工程中，直接采用 FM 的物品向量作为 Embedding 特征向量输入到后续深度学习网络也是可行的办法。</p><p>另外一种更加特别的例子，就是是 2013 年 Facebook 提出的著名的 <strong>GBDT+LR</strong> 的模型，<u>其中 GBDT 的部分本质上也是完成了一次特征转换，可以看作是利用 GBDT 模型完成 Embedding 预训练之后，将 Embedding 输入单层神经网络进行 CTR 预估的过程。</u></p><p><noscript><img class="aligncenter wp-image-1994 size-full" title="推荐系统的中Embedding的应用实践" src="https://lumingdong.cn/wp-content/uploads/2019/08/20190801194201.png" alt="推荐系统的中Embedding的应用实践" width="712" height="579" srcset="https://lumingdong.cn/wp-content/uploads/2019/08/20190801194201.png 712w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194201-150x122.png 150w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194201-300x244.png 300w" sizes="(max-width: 712px) 100vw, 712px" /></noscript><img class="aligncenter wp-image-1994 size-full lazyloaded" title="推荐系统的中Embedding的应用实践" src="https://lumingdong.cn/wp-content/uploads/2019/08/20190801194201.png" data-src="https://lumingdong.cn/wp-content/uploads/2019/08/20190801194201.png" alt="推荐系统的中Embedding的应用实践" width="712" height="579" data-srcset="https://lumingdong.cn/wp-content/uploads/2019/08/20190801194201.png 712w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194201-150x122.png 150w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194201-300x244.png 300w" data-sizes="(max-width: 712px) 100vw, 712px" sizes="(max-width: 712px) 100vw, 712px" srcset="https://lumingdong.cn/wp-content/uploads/2019/08/20190801194201.png 712w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194201-150x122.png 150w, https://lumingdong.cn/wp-content/uploads/2019/08/20190801194201-300x244.png 300w"></p><p>2015 年以来，<u>随着大量 Graph Embedding 技术的发展，Embedding 本身的表达能力进一步增强，而且能够将各类特征全部融合进 Embedding 之中，这使 Embedding 本身成为非常有价值的特征。这些特点都使 Embedding 预训练成为更被青睐的技术途径。</u></p><p>诚然，<u>将 Embedding 过程与深度网络的训练过程割裂，必然会损失一定的信息，但训练过程的独立也带来了训练灵活性的提升。举例来说，由于物品或用户的 Embedding 天然是比较稳定的（因为用户的兴趣、物品的属性不可能在几天内发生巨大的变化），Embedding 的训练频率其实不需要很高，甚至可以降低到周的级别，但上层神经网络为了尽快抓住最新的正样本信息，往往需要高频训练甚至实时训练。使用不同的训练频率更新 Embedding 模型和神经网络模型，是训练开销和模型效果二者之间权衡后的最优方案。</u><sup class="md-footnote"><a href="#dfref-footnote-12" name="ref-footnote-12">12</a></sup></p><h3 id="Embedding质量的评估"><em>3.3.</em><span class="ez-toc-section" id="Embedding质量的评估">Embedding质量的评估</span></h3><p>虽然目前 Embedding 的应用已经十分火热，但对其评价问题，即衡量该 Embedding 训练得是好是坏，并没有非常完美的方案。实际上，评价其质量最好的方式就是以 Embedding 对于具体任务的实际收益（上线效果）为评价标准。但是若能找到一个合适的方案，可以在上线前对得到的 Embedding 进行评估，那将具有很大的意义。</p><p>我们这里分 Word Embedding 和 Item Embedding 来分别讨论二者的度量方案。</p><p>Word Embedding 有较多的比较成熟的度量方案，常用的有以下几种<sup class="md-footnote"><a href="#dfref-footnote-7" name="ref-footnote-7">7</a></sup>：</p><ol start=""><li><p><strong>Relatedness</strong></p><p>Relatedness:task(相似度评价指标，看看空间距离近的词，跟人的直觉是否一致) 目前大部分工作都是依赖 <a href="https://lumingdong.cn/go/sc3gqv" rel="nofollow,noindex noopener noreferrer" target="_blank">wordsim353</a> 等词汇相似性数据集进行相关性度量，并以之作为评价 Word Embedding 质量的标准。这种评价方式对数据集的大小、领域等属性很敏感。Google 在 Word2Vec 中给出的评估方案就是这个。 示例如图：</p><p><a href="https://lumingdong.cn/wp-content/uploads/2019/07/20190724160214.png"><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724160214.png" alt="" width="892" height="369" /></noscript><img class="aligncenter ls-is-cached lazyloaded" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724160214.png" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724160214.png" alt="" width="892" height="369"></a></p></li><li><p><strong>Analogy</strong></p><p>Analogy:task 也就是著名 A - B = C - D 词汇类比任务（所谓的 analogy task，就是 Embedding 线性规则的体现，如 king – queen = man – woman）。</p><p>示例如图：</p> <a href="https://lumingdong.cn/wp-content/uploads/2019/08/2118460399.jpg"><noscript><img class="aligncenter wp-image-2012 size-full" title="推荐系统的中Embedding的应用实践" src="https://lumingdong.cn/wp-content/uploads/2019/08/2118460399.jpg" alt="推荐系统的中Embedding的应用实践" width="646" height="353" srcset="https://lumingdong.cn/wp-content/uploads/2019/08/2118460399.jpg 646w, https://lumingdong.cn/wp-content/uploads/2019/08/2118460399-150x82.jpg 150w, https://lumingdong.cn/wp-content/uploads/2019/08/2118460399-300x164.jpg 300w" sizes="(max-width: 646px) 100vw, 646px" /></noscript><img class="aligncenter wp-image-2012 size-full lazyloaded" title="推荐系统的中Embedding的应用实践" src="https://lumingdong.cn/wp-content/uploads/2019/08/2118460399.jpg" data-src="https://lumingdong.cn/wp-content/uploads/2019/08/2118460399.jpg" alt="推荐系统的中Embedding的应用实践" width="646" height="353" data-srcset="https://lumingdong.cn/wp-content/uploads/2019/08/2118460399.jpg 646w, https://lumingdong.cn/wp-content/uploads/2019/08/2118460399-150x82.jpg 150w, https://lumingdong.cn/wp-content/uploads/2019/08/2118460399-300x164.jpg 300w" data-sizes="(max-width: 646px) 100vw, 646px" sizes="(max-width: 646px) 100vw, 646px" srcset="https://lumingdong.cn/wp-content/uploads/2019/08/2118460399.jpg 646w, https://lumingdong.cn/wp-content/uploads/2019/08/2118460399-150x82.jpg 150w, https://lumingdong.cn/wp-content/uploads/2019/08/2118460399-300x164.jpg 300w"></a></li><li><p><strong>Categorization</strong> Categorization 分类，看词在每个分类中的概率。</p><p>示例如图：</p><p><noscript><img class="aligncenter size-full wp-image-2013" title="推荐系统的中Embedding的应用实践" src="https://lumingdong.cn/wp-content/uploads/2019/08/3611446030.png" alt="推荐系统的中Embedding的应用实践" width="427" height="144" srcset="https://lumingdong.cn/wp-content/uploads/2019/08/3611446030.png 427w, https://lumingdong.cn/wp-content/uploads/2019/08/3611446030-150x51.png 150w, https://lumingdong.cn/wp-content/uploads/2019/08/3611446030-300x101.png 300w" sizes="(max-width: 427px) 100vw, 427px" /></noscript><img class="aligncenter size-full wp-image-2013 lazyloaded" title="推荐系统的中Embedding的应用实践" src="https://lumingdong.cn/wp-content/uploads/2019/08/3611446030.png" data-src="https://lumingdong.cn/wp-content/uploads/2019/08/3611446030.png" alt="推荐系统的中Embedding的应用实践" width="427" height="144" data-srcset="https://lumingdong.cn/wp-content/uploads/2019/08/3611446030.png 427w, https://lumingdong.cn/wp-content/uploads/2019/08/3611446030-150x51.png 150w, https://lumingdong.cn/wp-content/uploads/2019/08/3611446030-300x101.png 300w" data-sizes="(max-width: 427px) 100vw, 427px" sizes="(max-width: 427px) 100vw, 427px" srcset="https://lumingdong.cn/wp-content/uploads/2019/08/3611446030.png 427w, https://lumingdong.cn/wp-content/uploads/2019/08/3611446030-150x51.png 150w, https://lumingdong.cn/wp-content/uploads/2019/08/3611446030-300x101.png 300w"></p></li><li><p><strong>聚类算法</strong> 例如 kmeans 聚类，查看聚类分布效果 。若向量维度偏高，则对向量进行降维，并可视化。如使用 pca，t-sne 等降维可视化方法，包括 google 的 tensorboard 以及 <a href="https://lumingdong.cn/go/umc05f" rel="nofollow,noindex noopener noreferrer" target="_blank">Embedding Projector</a>，python 的 matplotlib 等工具，从而得到词向量分布。</p><p>示例如图：</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724161310.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724161310.png" alt=""></p></li></ol><p>Item Embedding 则基本上没有统一认可的方案，下面提供一些方案提供参考：</p><ol start=""><li>一个常用的评估的办法就是采样看 Top N 的相似度，看是不是确实学习到了有意义的信息，下一节提到的阿里 EGES 论文中，用的就是这样的方法。</li><li>从 item2vec 得到的词向量中随机抽出一部分进行人工判别可靠性。即人工判断各维度 item 与标签 item 的相关程度，判断是否合理，序列是否相关。</li><li>也可以借鉴 Word Embedding 中聚类可视化的方法，抽样进行对比，查看效果如何。</li><li>还有一种方案，就是用大量数据训练出一个相对新的类似于 wordsim353 标准的 item 类型的标准，之后进行相似度度量。但是实现难度主要在训练数据的质量和时效性方面，对于商品类还好，但对于新闻类这种更新率极快的 item 类型，时效性是很大问题。</li><li>当然，也可通过观察实际效果来定，也可采用替换 Embedding 对应值为初始值来看预测效果是否有显著下降。</li></ol><h2 id="Graph Embedding"><em>4.</em><span class="ez-toc-section" id="Graph_Embedding">Graph Embedding</span></h2><p>Word2Vec 通过序列（sequence）式的样本：句子，学习单词的真实含义。仿照 Word2Vec 思想而生的 Item2Vec 也通过商品的组合去生成商品的 Embedding，这里商品的组合也是序列式的，我们可以称他们为 “Sequence Embedding”。然而，在更多场景下，数据对象之间更多以图（网络）的结构呈现，这种结构生成 Embedding 的方法，我们称之为图嵌入（Graph Embedding）。例如下图，由淘宝用户行为数据生成的物品关系图（Item Graph）：</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184743.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184743.png" alt=""></p><p>从上图的例子中，我们已经能触碰到一些 Graph Embedding 的本质。Graph Embedding 之所以能好于 “Sequence Embedding”，是因为 Graph Embedding 能够生成一些 “不存在” 的序列。例如，上图数据中没有这样的用户行为数据：<code>B-E-F</code>、<code>D-E-C</code> 等等。但是在物品关系图中，我们有机会生成这样的序列。</p><p>图结构比 Item2Vec 更能反映一些实际场景下的复杂关系网络，更能捕获 Items 间的高维相似性。如今 Graph Embedding 已经是推荐系统、计算广告领域非常流行的做法，并且在工业实践中也取得了非常不错的线上效果。</p><p>Graph Embedding 有很多类似的称呼，图（Graph）有时会称为网络（Network），因此，有些地方还会称把 Graph Embedding 称为网络表示学习（Network Representation Learning）。类似的，我们还会经常看到 Network Embedding、Node Embedding、Graph Representation 等等 ，这些名词可能在定义上会有差异，大部分时间，我们可以在特定场合将他们视为同义词。</p><p>Graph Embedding 的相关算法有很多，我们这里介绍几个关键的算法。</p><h3 id="DeepWalk"><em>4.1.</em><span class="ez-toc-section" id="DeepWalk">DeepWalk</span></h3><p>📚 <a href="https://lumingdong.cn/go/pi801g" rel="nofollow,noindex noopener noreferrer" target="_blank">DeepWalk: Online Learning of Social Representations</a></p><p>训练 Embedding 的一个重要过程是构建含有关系的样本（我这里姑且称这种样本为关系样本），然后作为 Skip-gram 模型的输入，虽然从 “一维” 序列（sequence）变成了 “二维” 的图（graph），但训练 Embedding 的核心算法基本是没有变的，<strong>关于 Graph Embedding 的相关研究，很大一部分其实是研究如何更好地构建这种关系样本，其中包括如何更合理地构造图，如何更合理地从图中采样得到关系样本，从而能够在 Embedding 中更好地保留这些关系</strong>。DeepWalk 其实就是这样，它并没有在训练 Embedding 的模型上动手，因此只有输入更合理的关系样本数据，才能得到更好的 Embedding 向量化结果，这也是图结构存在的意义之一。既然模型没有变，那么模型要求的输入也和原来一样，我们自然也需要提供和序列采样出的类似的关系样本数据，只不过现在高了一个维度，于是整个样本构建的流程就变成了先按照业务关系构造图，然后从图采样到序列，再从序列采样到样本，才能作为 Embedding 训练模型的输入，如下图：</p><p><a href="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184757.png"><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184757.png" alt="" width="969" height="257" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20969%20257%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184757.png" alt="" width="969" height="257"></a></p><p>其中各个环节的采样和转化都关系到最终效果的好坏，这也是大家研究和优化的重点内容。</p><p>DeepWalk 是 2014 年提出的影响力较大的 Graph Embedding 方法，也是最基础的 Graph Embedding 方法，它重点解决的就是如何从图采样到序列，其<u>主要思想是在由物品组成的图结构上进行<strong>随机游走（Random Walk）</strong>，产生大量物品序列，然后将这些物品序列作为训练样本输入 word2vec 进行训练，得到物品的 Embedding。</u></p><p>上图中展示的是阿里在淘宝上的 DeepWalk 的过程，在传统 DeepWalk 的基础上，阿里的还应用了会话切分和加权边，具体过程如下：</p><ol start=""><li>图 a 展示了原始的用户行为序列，<strong>这里设置了一个时间窗口，只选择用户在该窗口内的行为</strong>，这样处理不但可以节省计算和存储开销，也符合一个用户的兴趣趋向于随时间迁移的实情。这种处理方法被称为是基于 session 的用户行为（session-based）。经验上，该时间窗口的区间是一个小时；</li><li>图 b 基于这些用户行为序列构建了物品相关图，可以看出，物品 A，B 之间的边产生的原因就是因为用户 U1 先后购买了物品 A 和物品 B，所以产生了一条由 A 到 B 的有向边。<strong>如果后续产生了多条相同的有向边，则有向边的权重被加强。</strong><sup class="md-footnote"><a href="#dfref-footnote-8" name="ref-footnote-8">8</a></sup>在将所有用户行为序列都转换成物品相关图中的边之后，全局的物品相关图就建立起来了；</li><li><strong>图 c 采用随机游走的方式随机选择起始点，重新产生物品序列</strong>；</li><li>图 d 最终将这些物品序列输入 word2vec 模型，生成最终的物品 Embedding 向量。</li></ol><p>随机游走是一种路径搜索算法，用来从图上获得一条随机的路径。从一个节点开始，随机沿着一条边正向或者反向寻找到它的邻居，以此类推，直到达到设置的路径长度。不难发现随机游走有两个关键步骤，第一，起始节点的选择，第二，下一跳节点的选择。</p><p>其中，起始节点的选择有两种常见做法：</p><ol start=""><li>按照一定的规则（比如均匀抽样）随机从图中抽取一定数量的节点；</li><li>以图中所有节点作为起始节点。</li></ol><p><u>一般来说我们选择第 2 种方法，以使所有节点都被选取到。</u><sup class="md-footnote"><a href="#dfref-footnote-9" name="ref-footnote-9">9</a></sup></p><p>下一跳节点的选择，有很多方案，包括后面介绍的几种 Graph Embedding 算法，很多也是在下一跳的选择上进行优化研究，我们这里先列举几个简单的基础方法：</p><ol start=""><li><p>对于无权图，无差别的从当前节点的邻居中随机采样节点作为下一个访问节点，重复此过程，直到访问序列长度满足预设条件。DeepWalk 论文中的就是用的这种纯粹的随机游走方法；</p></li><li><p>对于有权图，下一跳节点的选择最简单的方法是按照边的权重随机选择，阿里的论文在讲述 DeepWalk 的时候，给出了一个非常简单的<strong>随机游走转移概率</strong>的公式，也就是到达节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-126-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2107" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.8em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2108"><span class="msubsup" id="MathJax-Span-2109"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2110" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2111" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-126">v_i</script> 后，下一步遍历 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-127-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2112" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.8em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2113"><span class="msubsup" id="MathJax-Span-2114"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2115" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2116" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-127">v_i</script> 的临接点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-128-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2117" style="width: 1.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.85em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2118"><span class="msubsup" id="MathJax-Span-2119"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2120" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2121" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-128">v_j</script> 的概率。</p><p>如果物品的相关图是有向有权图，那么从节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-129-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2122" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.8em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2123"><span class="msubsup" id="MathJax-Span-2124"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2125" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2126" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-129">v_i</script> 跳转到节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-130-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2127" style="width: 1.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.85em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2128"><span class="msubsup" id="MathJax-Span-2129"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2130" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2131" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-130">v_j</script> 的概率定义如下：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-131-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-2132" style="width: 22.125em; display: inline-block;"><span style="display: inline-block; position: relative; width: 17.562em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.987em, 1017.56em, 5.459em, -999.998em); top: -3.966em; left: 0em;"><span class="mrow" id="MathJax-Span-2133"><span class="mi" id="MathJax-Span-2134" style="font-family: MathJax_Math-italic;">P<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span class="mo" id="MathJax-Span-2135" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-2136"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2137" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2138" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="texatom" id="MathJax-Span-2139"><span class="mrow" id="MathJax-Span-2140"><span class="mo" id="MathJax-Span-2141" style="font-family: MathJax_Main;">|</span></span></span><span class="msubsup" id="MathJax-Span-2142"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2143" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2144" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2145" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2146" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mrow" id="MathJax-Span-2147" style="padding-left: 0.3em;"><span class="mo" id="MathJax-Span-2148" style="vertical-align: 0em;"><span style="font-family: MathJax_Size4;">{</span></span><span class="mtable" id="MathJax-Span-2149"><span style="display: inline-block; position: relative; width: 11.61em; height: 0px; margin-right: 0.151em; margin-left: 0.151em;"><span style="position: absolute; clip: rect(2.086em, 1005.41em, 5.459em, -999.998em); top: -4.065em; left: 0em;"><span style="display: inline-block; position: relative; width: 5.508em; height: 0px;"><span style="position: absolute; clip: rect(2.78em, 1005.41em, 4.963em, -999.998em); top: -4.759em; left: 0em;"><span class="mtd" id="MathJax-Span-2150"><span class="mrow" id="MathJax-Span-2151"><span class="mfrac" id="MathJax-Span-2152"><span style="display: inline-block; position: relative; width: 4.963em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.375em, 1001.14em, 4.368em, -999.998em); top: -4.611em; left: 50%; margin-left: -0.543em;"><span class="msubsup" id="MathJax-Span-2153"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2154" style="font-size: 70.7%; font-family: MathJax_Math-italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.697em;"><span class="texatom" id="MathJax-Span-2155"><span class="mrow" id="MathJax-Span-2156"><span class="mi" id="MathJax-Span-2157" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-2158" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.326em, 1004.86em, 4.516em, -999.998em); top: -3.569em; left: 50%; margin-left: -2.428em;"><span class="mrow" id="MathJax-Span-2159"><span class="munderover" id="MathJax-Span-2160"><span style="display: inline-block; position: relative; width: 3.276em; height: 0px;"><span style="position: absolute; clip: rect(3.326em, 1000.7em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-2161" style="font-size: 70.7%; font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.817em; left: 0.747em;"><span class="texatom" id="MathJax-Span-2162"><span class="mrow" id="MathJax-Span-2163"><span class="msubsup" id="MathJax-Span-2164"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px;"><span style="position: absolute; clip: rect(3.524em, 1000.2em, 4.268em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2165" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.164em; left: 0.201em;"><span class="mo" id="MathJax-Span-2166" style="font-size: 50%; font-family: MathJax_Main;">∗</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2167" style="font-size: 50%; font-family: MathJax_Main;">∈</span><span class="msubsup" id="MathJax-Span-2168"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.524em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2169" style="font-size: 50%; font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.916em; left: 0.399em;"><span class="texatom" id="MathJax-Span-2170"><span class="mrow" id="MathJax-Span-2171"><span class="mo" id="MathJax-Span-2172" style="font-size: 50%; font-family: MathJax_Main;">+</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2173" style="font-size: 50%; font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-2174"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px;"><span style="position: absolute; clip: rect(3.673em, 1000.25em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2175" style="font-size: 50%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.25em;"><span class="mi" id="MathJax-Span-2176" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2177" style="font-size: 50%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-2178" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.391em; height: 0px;"><span style="position: absolute; clip: rect(3.375em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2179" style="font-size: 70.7%; font-family: MathJax_Math-italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="texatom" id="MathJax-Span-2180"><span class="mrow" id="MathJax-Span-2181"><span class="mi" id="MathJax-Span-2182" style="font-size: 50%; font-family: MathJax_Math-italic;">i</span><span class="msubsup" id="MathJax-Span-2183"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px;"><span style="position: absolute; clip: rect(3.524em, 1000.2em, 4.268em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2184" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.164em; left: 0.201em;"><span class="mo" id="MathJax-Span-2185" style="font-size: 50%; font-family: MathJax_Main;">∗</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1004.96em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 4.963em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mo" id="MathJax-Span-2186" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.227em, 1000.7em, 4.368em, -999.998em); top: -2.974em; left: 0em;"><span class="mtd" id="MathJax-Span-2201"><span class="mrow" id="MathJax-Span-2202"><span class="mn" id="MathJax-Span-2203" style="font-family: MathJax_Main;">0</span><span class="mo" id="MathJax-Span-2204" style="font-family: MathJax_Main;">,</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.07em;"></span></span><span style="position: absolute; clip: rect(2.383em, 1005.01em, 5.508em, -999.998em); top: -4.015em; left: 6.5em;"><span style="display: inline-block; position: relative; width: 5.112em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1005.01em, 4.467em, -999.998em); top: -4.759em; left: 0em;"><span class="mtd" id="MathJax-Span-2187"><span class="mrow" id="MathJax-Span-2188"><span class="msubsup" id="MathJax-Span-2189"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2190" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2191" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2192" style="font-family: MathJax_Main; padding-left: 0.3em;">∈</span><span class="msubsup" id="MathJax-Span-2193" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.89em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2194" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.796em;"><span class="mo" id="MathJax-Span-2195" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2196" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-2197"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2198" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2199" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2200" style="font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1002.78em, 4.467em, -999.998em); top: -2.974em; left: 0em;"><span class="mtd" id="MathJax-Span-2205"><span class="mrow" id="MathJax-Span-2206"><span class="msubsup" id="MathJax-Span-2207"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2208" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.449em;"><span class="texatom" id="MathJax-Span-2209"><span class="mrow" id="MathJax-Span-2210"><span class="mi" id="MathJax-Span-2211" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-2212" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2213" style="font-family: MathJax_Main; padding-left: 0.3em;">∉</span><span class="mi" id="MathJax-Span-2214" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">ε</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2215"></span></span></span><span style="display: inline-block; width: 0px; height: 3.971em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.747em; border-left: 0px solid; width: 0px; height: 4.128em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-131">P(v_j|v_i)=\begin{cases} \frac{M_{ij}}{\sum_{j^* \in N_{+}(v_i)}M_{ij^*}}, & v_j \in N_+(v_i)\\ 0, &e_{ij} \notin \varepsilon \end{cases}</script></p><p>其中 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-132-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2216" style="width: 3.822em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.028em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1002.93em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2217"><span class="msubsup" id="MathJax-Span-2218"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.89em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2219" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.796em;"><span class="mo" id="MathJax-Span-2220" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2221" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-2222"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2223" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2224" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2225" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-132">N_+(v_i)</script> 是节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-133-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2226" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.8em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2227"><span class="msubsup" id="MathJax-Span-2228"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2229" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2230" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-133">v_i</script> 所有的出边集合，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-134-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2231" style="width: 2.036em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.59em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1001.59em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2232"><span class="msubsup" id="MathJax-Span-2233"><span style="display: inline-block; position: relative; width: 1.59em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2234" style="font-family: MathJax_Math-italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.995em;"><span class="texatom" id="MathJax-Span-2235"><span class="mrow" id="MathJax-Span-2236"><span class="mi" id="MathJax-Span-2237" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-2238" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-134">M_{ij}</script> 是节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-135-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2239" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.8em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2240"><span class="msubsup" id="MathJax-Span-2241"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2242" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2243" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-135">v_i</script> 到节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-136-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2244" style="width: 1.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.85em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2245"><span class="msubsup" id="MathJax-Span-2246"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2247" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2248" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-136">v_j</script> 边的权重，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-137-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2249" style="width: 3.574em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.83em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1002.78em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2250"><span class="msubsup" id="MathJax-Span-2251"><span style="display: inline-block; position: relative; width: 1.094em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2252" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.449em;"><span class="texatom" id="MathJax-Span-2253"><span class="mrow" id="MathJax-Span-2254"><span class="mi" id="MathJax-Span-2255" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-2256" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2257" style="font-family: MathJax_Main; padding-left: 0.3em;">∉</span><span class="mi" id="MathJax-Span-2258" style="font-family: MathJax_Math-italic; padding-left: 0.3em;">ε</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-137">e_{ij} \notin \varepsilon</script> 表示节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-138-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2259" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.8em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2260"><span class="msubsup" id="MathJax-Span-2261"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2262" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2263" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-138">v_i</script> 到 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-139-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2264" style="width: 1.094em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.85em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2265"><span class="msubsup" id="MathJax-Span-2266"><span style="display: inline-block; position: relative; width: 0.846em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2267" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2268" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.066em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-139">v_j</script> 没有边的情况。</p><p>如果物品相关图是无向无权重图，那么跳转概率将是上面公式的一个特例，即权重 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-140-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2269" style="width: 2.036em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.59em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1001.59em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2270"><span class="msubsup" id="MathJax-Span-2271"><span style="display: inline-block; position: relative; width: 1.59em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2272" style="font-family: MathJax_Math-italic;">M<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.995em;"><span class="texatom" id="MathJax-Span-2273"><span class="mrow" id="MathJax-Span-2274"><span class="mi" id="MathJax-Span-2275" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-2276" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-140">M_{ij}</script> 将为常数 1，且 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-141-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2277" style="width: 3.822em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.028em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1002.93em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2278"><span class="msubsup" id="MathJax-Span-2279"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.89em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2280" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.796em;"><span class="mo" id="MathJax-Span-2281" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2282" style="font-family: MathJax_Main;">(</span><span class="msubsup" id="MathJax-Span-2283"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2284" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2285" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2286" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-141">N_+(v_i)</script> 应是节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-142-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2287" style="width: 0.995em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.8em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2288"><span class="msubsup" id="MathJax-Span-2289"><span style="display: inline-block; position: relative; width: 0.796em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2290" style="font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2291" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-142">v_i</script> 所有 “边” 的集合，而不是所有 “出边” 的集合。</p></li></ol><p>使用随机游走带来的好处：</p><ul><li><p><strong>并行化</strong>，随机游走是局部的，图的规模比较大的时候，可以同时在不同的顶点开始进行一定长度的随机游走，多个随机游走同时进行，可以减少采样的时间。</p></li><li><p><strong>适应性</strong>，可以适应图的局部的变化。图的的演化通常是局部的点和边的变化，这样的变化只会对部分随机游走路径产生影响，因此在图演化的过程中不需要每一次都重新计算整个图的随机游走。</p></li><li><p><strong>解释性</strong>，论文中提到，在图中通过随机游走得到序列的节点分布规律与 NLP 中句子序列在语料库中出现的词频规律有着类似的幂律分布特征，见下图。在自然语言里面，幂律分布特征可以理解为只有少量的单词出现频率非常高，而绝大部分的单词出现的频率较低，还可以理解为，在日常交流中，常用的词汇很少，而绝大部分的词汇并不常用，可以看出随机游走路径显然符合自然语言的特点，从某个角度说明随机游走采样生成序列的合理性。</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184825.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184825.png" alt=""></p></li></ul><p>DeepWalk 的算法流程：</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184849.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184849.png" alt=""></p><p>参数更新过程：</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184858.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184858.png" alt=""></p><h3 id="LINE"><em>4.2.</em><span class="ez-toc-section" id="LINE">LINE</span></h3><p>📚 <a href="https://lumingdong.cn/go/5l0x1r" rel="nofollow,noindex noopener noreferrer" target="_blank">LINE: Large-scale Information Network Embedding</a></p><p>DeepWalk 之后，比较重要的工作是微软亚洲研究院在 2015 年发布的 LINE（Large-scale Information Network Embedding）。LINE 中定义了两种相似度来进一步深化 “节点关系”，使训练出的 Embedding 既保留局部网络结构信息又保留了一定的全局网络结构信息。</p><p>First-order proximity（一阶相似度）：用于描述图中成对顶点之间的局部相似度，形式化描述为若节点之间存在直连边，则边的权重即为两个顶点的相似度（权重可以是 0-1 这样的二进制表示，也可以是任意的非负数），若不存在直连边，则一阶相似度为 0。 如下图，节点 6 和 7 之间存在直连边，且边权较大，则认为两者相似且一阶相似度较高，而 5 和 6 之间不存在直连边，则两者间一阶相似度为 0。</p><p>Second-order proximity（二阶相似度）：网络中的很多相互关系其实不一定能够直接观察到，仅有一阶相似度并不能保留全局网络结构，因此作为补充，加入了二阶相似度。二阶相似度并不是通过直接观察到的连接来确定的，而是<u>通过顶点的共享邻域结构来确定的</u>。如下图，虽然节点 5 和 6 之间不存在直连边，但是他们有很多相同的相邻节点（1,2,3,4），这其实也可以表明 5 和 6 是相似的，二阶相似度就是用来描述这种关系的，拥有相似邻居的顶点往往彼此相似。其实二阶相似度也是符合自然的直觉的，例如，在社交网络中，拥有相同朋友的人往往有相似的兴趣，从而成为朋友；在单词共现网络中，总是与同一组词同时出现的词往往具有相似的含义。二阶相似度形式化定义为，令 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-143-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2292" style="width: 11.907em; display: inline-block;"><span style="display: inline-block; position: relative; width: 9.427em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1009.33em, 2.929em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2293"><span class="msubsup" id="MathJax-Span-2294"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2295" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2296" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2297" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mo" id="MathJax-Span-2298" style="font-family: MathJax_Main; padding-left: 0.3em;">(</span><span class="msubsup" id="MathJax-Span-2299"><span style="display: inline-block; position: relative; width: 1.739em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2300" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="texatom" id="MathJax-Span-2301"><span class="mrow" id="MathJax-Span-2302"><span class="mi" id="MathJax-Span-2303" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-2304" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-2305" style="font-size: 70.7%; font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2306" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-2307" style="font-family: MathJax_Main; padding-left: 0.151em;">⋯</span><span class="mo" id="MathJax-Span-2308" style="font-family: MathJax_Main; padding-left: 0.151em;">,</span><span class="msubsup" id="MathJax-Span-2309" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 2.334em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2310" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.817em; left: 0.697em;"><span class="texatom" id="MathJax-Span-2311"><span class="mrow" id="MathJax-Span-2312"><span class="mi" id="MathJax-Span-2313" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span class="mo" id="MathJax-Span-2314" style="font-size: 70.7%; font-family: MathJax_Main;">,</span><span class="texatom" id="MathJax-Span-2315"><span class="mrow" id="MathJax-Span-2316"><span class="mo" id="MathJax-Span-2317" style="font-size: 70.7%; font-family: MathJax_Main;">|</span></span></span><span class="mi" id="MathJax-Span-2318" style="font-size: 70.7%; font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.151em;"></span></span><span class="texatom" id="MathJax-Span-2319"><span class="mrow" id="MathJax-Span-2320"><span class="mo" id="MathJax-Span-2321" style="font-size: 70.7%; font-family: MathJax_Main;">|</span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2322" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.497em; border-left: 0px solid; width: 0px; height: 1.503em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-143">p_u =(w_{u,1},\cdots, w_{u,|V|})</script> 表示顶点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-144-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2323" style="width: 0.747em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.6em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2324"><span class="mi" id="MathJax-Span-2325" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-144">u</script> 与所有其他顶点间的一阶相似度，则 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-145-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2326" style="width: 0.747em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.6em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2327"><span class="mi" id="MathJax-Span-2328" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-145">u</script> 与 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-146-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2329" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.5em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2330"><span class="mi" id="MathJax-Span-2331" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-146">v</script> 的二阶相似度可以通过 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-147-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2332" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2333"><span class="msubsup" id="MathJax-Span-2334"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2335" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2336" style="font-size: 70.7%; font-family: MathJax_Math-italic;">u</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-147">p_u</script> 和 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-148-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2337" style="width: 1.193em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.95em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2338"><span class="msubsup" id="MathJax-Span-2339"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.368em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2340" style="font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="mi" id="MathJax-Span-2341" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-148">p_v</script> 的相似度表示。若 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-149-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2342" style="width: 0.747em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.6em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2343"><span class="mi" id="MathJax-Span-2344" style="font-family: MathJax_Math-italic;">u</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-149">u</script> 与 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-150-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2345" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.5em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2346"><span class="mi" id="MathJax-Span-2347" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-150">v</script> 之间不存在相同的邻居顶点，则 2 阶相似度为 0。</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190718151442.png" alt="LINE" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190718151442.png" alt="LINE"></p><p>相比 DeepWalk 纯粹随机游走的序列生成方式，LINE 可以应用于有向图、无向图以及边有权重的网络，并通过将一阶、二阶的邻近关系引入目标函数，能够使最终学出的 node embedding 的分布更为均衡平滑，避免 DeepWalk 容易使 node embedding 聚集的情况发生。下图是论文中的结果对比：</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190718172101.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190718172101.png" alt=""></p><p>从图中可以看出，LINE 的效果最好，DeepWalk 对不同颜色的点分得也不错，但是图形中部很多点都挤在一块，而这些点都是出度很大的点，文章提了一句说对于这种点的处理 DeepWalk 会产生很大噪音，但没有详细对此分析。论文还指出，<strong>DeepWalk 利用随机游走去捕获邻近关系，更像是深度优先搜索 DFS；而 LINE 的方式更像是广度优先搜索 BFS，相对而言更合理。</strong>上图中的 GF 代表 graph factorization，这里不作介绍。<sup class="md-footnote"><a href="#dfref-footnote-10" name="ref-footnote-10">10</a></sup></p><h3 id="Node2Vec"><em>4.3.</em><span class="ez-toc-section" id="Node2Vec">Node2Vec</span></h3><p>📚 <a href="https://lumingdong.cn/go/b6gmab" rel="nofollow,noindex noopener noreferrer" target="_blank">node2vec: Scalable Feature Learning for Networks</a></p><p>在 DeepWalk 和 LINE 的基础之上，斯坦福大学在 2016 年发布了 Node2Vec。Node2Vec 是一种综合考虑 DFS 邻域和 BFS 邻域的 Graph Embedding 方法。简单来说，Node2Vec 可以看作是 DeepWalk 的一种扩展，是可以控制随机游走呈现 DFS 还是 BFS 的 DeepWalk，进而实现不同关系序列的均衡。</p><p>Node2Vec 把领域的采样看作是局部搜索的一种形式，通常分为两种极端采样策略：广度优先采样（Breadth-first Sampling，BFS）和深度优先采样（Depth-first Sampling，DFS），下图能够明显看出这两种采样方式的不同。</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190719102453.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190719102453.png" alt=""></p><p>广度优先抽样 (BFS)：邻域被限制在起始节点的近邻节点上，与初始节点在同一社区内的节点更容易出现在一个路径里。在上图中，对于大小为 k=3 的领域采样，BFS 采样节点 s1、s2、s3。</p><p>深度优先抽样 (DFS)：邻域由在距离起始点越来越远的连续采样的节点组成，发现能力更强。在上图中，对于大小为 k=3 的邻域采样，DFS 采样节点 s4、s5、s6。</p><p>论文指出，通常在网络中存在着两种相似性，即<strong>同质性（homophily）</strong>和<strong>结构性（structural equivalence）</strong>。</p><p><u>同质性</u>通常是那些高度互联且属于类似网络集群或社区的节点，同质性表示内容相似，它们 Embedding 应该也尽量近似。如上图中，节点 u 与其相连的节点 s1、s2、s3、s4 的 embedding 表达应该是接近的，这就是 “<strong>同质性</strong>“的体现。</p><p><u>结构性</u>指的是在网络中具有类似结构作用的节点，结构性表示结构相似，它们的 Embedding 也应该尽量接近，需注意的是，结构相似并不强调连接性，即使节点在网络中可能相距很远，仍然可以具有相似的结构。如上图中节点 u 和节点 s6 都是各自局域网络的中心节点，结构上相似，其 Embedding 的表达也应该近似，这是 “<strong>结构性</strong>” 的体现。</p><p><strong>论文发现，BFS 和 DFS 采样策略在产生反映上述两种对应关系的向量表示方面发挥着关键作用。DFS 擅长学习网络的同质性，BFS 擅长学习网络的结构性。</strong></p><p><u>这个结论特别容易理解反了，具体该怎样理解呢？</u><sup class="md-footnote"><a href="#dfref-footnote-11" name="ref-footnote-11">11</a></sup></p><blockquote><p>知乎网友：（个人理解）如果把上面的 Graph 的某一个节点作为 Root，然后画一个树状结构去搜索，BFS 和 DFS 就好理解了。</p></blockquote><p>对于广度优先搜索（BFS）来说，其搜索往往是在当前节点（这里以节点 u 为例）的邻域进行的，特别是在 node2vec 中，由于存在所谓的 “返回概率”，所以即使从 u 搜索到了 s1，也有很大概率从 s1 再返回 u，所以 BFS 产生的序列往往是在 u 附近的节点间进行来回的震荡，这就相当于对 u 周围的网络结构进行了一次<strong>微观扫描（microscope view）</strong>。</p><p>那么这个微观扫描当然更容易得到<strong>微观结构</strong>的观察，所以 BFS 就更容易使 Embedding 结果更多反应网络的 “结构性”。这里我需要纠正一下大家对 “结构性” 的理解，正如上面所说的一样，这里的 “结构” 更多的指的是微观结构，而不是大范围内，甚至整个网络范围内的宏观结构，而是一阶、二阶范围内的微观结构。</p><p>再举个例子理解一下，比如对于节点 u 和节点 s9 这两个节点来说，节点 u 是局部网络的中心节点，节点 s9 是一个十分边缘的节点。那么在对这个网络进行多次 BFS 随机游走的过程中，节点 u 肯定会被多次遍历到，而且会与 s1-s4 等更多节点发生联系，而边缘节点 s9 无论从遍历次数，还是从邻接点的丰富程度来说都远不及节点 u，因此两者的 Embedding 自然区别很大。</p><p>如果用 DFS 进行遍历，由于遍历存在更大的不确定性，因此 s9 有更大的可能被包含在更多的序列中，并跟更多的节点发生联系，这就减弱了局部结构性的信息。类似于平滑了结构性的信息，自然是不如 BFS 更能反应 “微观结构” 了。</p><p>另一方面，<strong>为什么说 DFS 更能反应 “同质性” 呢</strong>？</p><p>这里还要对 “同质性” 也进行一个纠正，这里的 “同质性” 不是指一阶、二阶这类非常局限的同质性，而是在相对较广范围内的，能够发现一个社区、一个群、一个聚集类别的 “同质性”。要发现这类同质性，当然需要使用 DFS 进行更广范围内的探索。如果仅用 BFS 在微观范围内探索，如何发现一个社区的边界在哪里呢？</p><p>所以，<strong>DFS 相当于对网络结构进行了一次宏观扫描</strong>（macroscope view），只有在宏观的视角，才能发现大的集团、社区的聚集性，和集团内部节点的 “同质性”。</p><p>论文中最后通过实验的方式验证了 DFS 和 BFS 对于 “同质性” 和 “结构性” 的挖掘结果。颜色接近的节点代表其 Embedding 的相似性更强，节点也比较相似。</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190719170417.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190719170417.png" alt=""></p><p>其中，上部分的参数 p = 1，q = 0.5，表现为更倾向于 DFS 的结果（详细控制公式和参数见下面内容），可以看到各聚类的内部节点相似，这是网络 “同质性” 的体现；而下部分参数 p = 1，q = 2，表现为更倾向于 BFS 的结果，结构类似节点的 Embedding 更为相似，这是 “结构性” 的体现。</p><p>同时，论文给出了一个可以控制广度优先或者深度优先的方法，进而进一步权衡控制同质性和结构性相似的 Embedding 关系的学习。</p><p>其实 DFS 还是 BFS，主要还是通过节点间的跳转概率来控制的，以下图为例，我们假设<u>第一步是从 t 随机游走到 v 后，这时候我们要确定下一步的邻接节点</u>。</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190719172448.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190719172448.png" alt=""></p><p>形式化来讲，从节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-151-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2348" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.5em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2349"><span class="mi" id="MathJax-Span-2350" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-151">v</script> 跳转到下一个节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-152-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2351" style="width: 0.747em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.55em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2352"><span class="mi" id="MathJax-Span-2353" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-152">x</script> 的概率为：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-153-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-2354" style="width: 10.667em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.435em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1008.43em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2355"><span class="msubsup" id="MathJax-Span-2356"><span style="display: inline-block; position: relative; width: 1.391em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.6em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2357" style="font-family: MathJax_Math-italic;">π<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.548em;"><span class="texatom" id="MathJax-Span-2358"><span class="mrow" id="MathJax-Span-2359"><span class="mi" id="MathJax-Span-2360" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span class="mi" id="MathJax-Span-2361" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2362" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="msubsup" id="MathJax-Span-2363" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.391em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.6em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2364" style="font-family: MathJax_Math-italic;">α</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.647em;"><span class="texatom" id="MathJax-Span-2365"><span class="mrow" id="MathJax-Span-2366"><span class="mi" id="MathJax-Span-2367" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-2368" style="font-size: 70.7%; font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2369" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2370" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-2371" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-2372" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">x</span><span class="mo" id="MathJax-Span-2373" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2374" style="font-family: MathJax_Main; padding-left: 0.201em;">⋅</span><span class="msubsup" id="MathJax-Span-2375" style="padding-left: 0.201em;"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.6em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2376" style="font-family: MathJax_Math-italic;">ω</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.647em;"><span class="texatom" id="MathJax-Span-2377"><span class="mrow" id="MathJax-Span-2378"><span class="mi" id="MathJax-Span-2379" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span class="mi" id="MathJax-Span-2380" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-153">\pi_{vx}=\alpha_{pq}(t, x) \cdot \omega_{vx}</script></p><p>其中，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-154-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2381" style="width: 1.937em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.54em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001.54em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2382"><span class="msubsup" id="MathJax-Span-2383"><span style="display: inline-block; position: relative; width: 1.54em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2384" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.697em;"><span class="texatom" id="MathJax-Span-2385"><span class="mrow" id="MathJax-Span-2386"><span class="mi" id="MathJax-Span-2387" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span class="mi" id="MathJax-Span-2388" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-154">w_{vx}</script> 是边 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-155-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2389" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2390"><span class="mi" id="MathJax-Span-2391" style="font-family: MathJax_Math-italic;">v</span><span class="mi" id="MathJax-Span-2392" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-155">vx</script> 的权重，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-156-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2393" style="width: 4.467em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.524em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1003.42em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2394"><span class="msubsup" id="MathJax-Span-2395"><span style="display: inline-block; position: relative; width: 1.391em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.6em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2396" style="font-family: MathJax_Math-italic;">α</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.647em;"><span class="texatom" id="MathJax-Span-2397"><span class="mrow" id="MathJax-Span-2398"><span class="mi" id="MathJax-Span-2399" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-2400" style="font-size: 70.7%; font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2401" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2402" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-2403" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-2404" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">x</span><span class="mo" id="MathJax-Span-2405" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-156">\alpha_{pq}(t, x)</script> 的定义如下：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-157-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-2406" style="width: 14.933em; display: inline-block;"><span style="display: inline-block; position: relative; width: 11.858em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(2.284em, 1011.86em, 6.649em, -999.998em); top: -4.71em; left: 0em;"><span class="mrow" id="MathJax-Span-2407"><span class="msubsup" id="MathJax-Span-2408"><span style="display: inline-block; position: relative; width: 1.391em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.6em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2409" style="font-family: MathJax_Math-italic;">α</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.647em;"><span class="texatom" id="MathJax-Span-2410"><span class="mrow" id="MathJax-Span-2411"><span class="mi" id="MathJax-Span-2412" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span class="mi" id="MathJax-Span-2413" style="font-size: 70.7%; font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2414" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2415" style="font-family: MathJax_Math-italic;">t</span><span class="mo" id="MathJax-Span-2416" style="font-family: MathJax_Main;">,</span><span class="mi" id="MathJax-Span-2417" style="font-family: MathJax_Math-italic; padding-left: 0.151em;">x</span><span class="mo" id="MathJax-Span-2418" style="font-family: MathJax_Main;">)</span><span class="mo" id="MathJax-Span-2419" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mrow" id="MathJax-Span-2420" style="padding-left: 0.3em;"><span class="mo" id="MathJax-Span-2421" style="vertical-align: 2.284em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; font-family: MathJax_Size4; top: -3.123em; left: 0em;">⎧<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -0.791em; left: 0em;">⎩<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: MathJax_Size4; top: -1.734em; left: 0em;">⎨<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -2.825em; left: 0em;">⎪<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="font-family: MathJax_Size4; position: absolute; top: -0.791em; left: 0em;">⎪<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mtable" id="MathJax-Span-2422"><span style="display: inline-block; position: relative; width: 5.756em; height: 0px; margin-right: 0.151em; margin-left: 0.151em;"><span style="position: absolute; clip: rect(2.681em, 1000.7em, 7.046em, -999.998em); top: -5.107em; left: 0em;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px;"><span style="position: absolute; clip: rect(2.979em, 1000.7em, 4.665em, -999.998em); top: -5.454em; left: 0em;"><span class="mtd" id="MathJax-Span-2423"><span class="mrow" id="MathJax-Span-2424"><span class="mfrac" id="MathJax-Span-2425"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.425em, 1000.3em, 4.169em, -999.998em); top: -4.412em; left: 50%; margin-left: -0.196em;"><span class="mn" id="MathJax-Span-2426" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.318em, -999.998em); top: -3.668em; left: 50%; margin-left: -0.196em;"><span class="mi" id="MathJax-Span-2427" style="font-size: 70.7%; font-family: MathJax_Math-italic;">p</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1000.5em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.499em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.227em, 1000.45em, 4.169em, -999.998em); top: -3.966em; left: 0em;"><span class="mtd" id="MathJax-Span-2443"><span class="mrow" id="MathJax-Span-2444"><span class="mn" id="MathJax-Span-2445" style="font-family: MathJax_Main;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.979em, 1000.7em, 4.665em, -999.998em); top: -2.676em; left: 0em;"><span class="mtd" id="MathJax-Span-2461"><span class="mrow" id="MathJax-Span-2462"><span class="mfrac" id="MathJax-Span-2463"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.425em, 1000.3em, 4.169em, -999.998em); top: -4.412em; left: 50%; margin-left: -0.196em;"><span class="mn" id="MathJax-Span-2464" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.318em, -999.998em); top: -3.668em; left: 50%; margin-left: -0.146em;"><span class="mi" id="MathJax-Span-2465" style="font-size: 70.7%; font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1000.5em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 0.499em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 5.112em;"></span></span><span style="position: absolute; clip: rect(2.334em, 1004.02em, 6.252em, -999.998em); top: -4.611em; left: 1.739em;"><span style="display: inline-block; position: relative; width: 4.07em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1004.02em, 4.318em, -999.998em); top: -5.454em; left: 0em;"><span class="mtd" id="MathJax-Span-2428"><span class="mrow" id="MathJax-Span-2429"><span class="texatom" id="MathJax-Span-2430"><span class="mrow" id="MathJax-Span-2431"><span class="mi" id="MathJax-Span-2432" style="font-family: MathJax_Main;">i</span><span class="mi" id="MathJax-Span-2433" style="font-family: MathJax_Main;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span><span class="mspace" id="MathJax-Span-2434" style="height: 0em; vertical-align: 0em; width: 0.3em; display: inline-block; overflow: hidden;"></span><span class="msubsup" id="MathJax-Span-2435"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2436" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="texatom" id="MathJax-Span-2437"><span class="mrow" id="MathJax-Span-2438"><span class="mi" id="MathJax-Span-2439" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-2440" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2441" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-2442" style="font-family: MathJax_Main; padding-left: 0.3em;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1003.97em, 4.318em, -999.998em); top: -3.966em; left: 0em;"><span class="mtd" id="MathJax-Span-2446"><span class="mrow" id="MathJax-Span-2447"><span class="texatom" id="MathJax-Span-2448"><span class="mrow" id="MathJax-Span-2449"><span class="mi" id="MathJax-Span-2450" style="font-family: MathJax_Main;">i</span><span class="mi" id="MathJax-Span-2451" style="font-family: MathJax_Main;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span><span class="mspace" id="MathJax-Span-2452" style="height: 0em; vertical-align: 0em; width: 0.3em; display: inline-block; overflow: hidden;"></span><span class="msubsup" id="MathJax-Span-2453"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2454" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="texatom" id="MathJax-Span-2455"><span class="mrow" id="MathJax-Span-2456"><span class="mi" id="MathJax-Span-2457" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-2458" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2459" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-2460" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.177em, 1004.02em, 4.318em, -999.998em); top: -2.676em; left: 0em;"><span class="mtd" id="MathJax-Span-2466"><span class="mrow" id="MathJax-Span-2467"><span class="texatom" id="MathJax-Span-2468"><span class="mrow" id="MathJax-Span-2469"><span class="mi" id="MathJax-Span-2470" style="font-family: MathJax_Main;">i</span><span class="mi" id="MathJax-Span-2471" style="font-family: MathJax_Main;">f<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span></span><span class="mspace" id="MathJax-Span-2472" style="height: 0em; vertical-align: 0em; width: 0.3em; display: inline-block; overflow: hidden;"></span><span class="msubsup" id="MathJax-Span-2473"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2474" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="texatom" id="MathJax-Span-2475"><span class="mrow" id="MathJax-Span-2476"><span class="mi" id="MathJax-Span-2477" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-2478" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2479" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-2480" style="font-family: MathJax_Main; padding-left: 0.3em;">2</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.616em;"></span></span></span></span><span class="mo" id="MathJax-Span-2481"></span></span></span><span style="display: inline-block; width: 0px; height: 4.715em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -2.309em; border-left: 0px solid; width: 0px; height: 5.316em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-157">\alpha_{pq}(t,x)=\begin{cases}\frac{1}{p} &{\rm if}\; d_{tx}=0 \\1 &{\rm if}\; d_{tx}=1 \\\frac{1}{q} &{\rm if}\; d_{tx}=2\end{cases}</script></p><p>其中，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-158-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2482" style="width: 1.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1001.24em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2483"><span class="msubsup" id="MathJax-Span-2484"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2485" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="texatom" id="MathJax-Span-2486"><span class="mrow" id="MathJax-Span-2487"><span class="mi" id="MathJax-Span-2488" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-2489" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-158">d_{tx}</script> 指的是节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-159-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2490" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.3em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2491"><span class="mi" id="MathJax-Span-2492" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-159">t</script> 到节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-160-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2493" style="width: 0.747em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.55em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2494"><span class="mi" id="MathJax-Span-2495" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-160">x</script> 的距离，只有 0，1，2 三种取值。当 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-161-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2496" style="width: 3.971em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.127em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1003.08em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2497"><span class="msubsup" id="MathJax-Span-2498"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2499" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="texatom" id="MathJax-Span-2500"><span class="mrow" id="MathJax-Span-2501"><span class="mi" id="MathJax-Span-2502" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-2503" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2504" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-2505" style="font-family: MathJax_Main; padding-left: 0.3em;">0</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-161">d_{tx}=0</script> 时，表示 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-162-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2506" style="width: 0.747em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.55em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2507"><span class="mi" id="MathJax-Span-2508" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-162">x</script> 就是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-163-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2509" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.3em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2510"><span class="mi" id="MathJax-Span-2511" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-163">t</script> 本身，相当于下一节点选择的是 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-164-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2512" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.3em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2513"><span class="mi" id="MathJax-Span-2514" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-164">t</script>，即往回走的情况；当 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-165-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2515" style="width: 3.971em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.127em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1003.08em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2516"><span class="msubsup" id="MathJax-Span-2517"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2518" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="texatom" id="MathJax-Span-2519"><span class="mrow" id="MathJax-Span-2520"><span class="mi" id="MathJax-Span-2521" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-2522" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2523" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-2524" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-165">d_{tx}=1</script>，则表示 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-166-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2525" style="width: 0.747em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.55em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2526"><span class="mi" id="MathJax-Span-2527" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-166">x</script> 和 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-167-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2528" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.3em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2529"><span class="mi" id="MathJax-Span-2530" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-167">t</script> 直接相连，比如下一节点选图中的 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-168-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2531" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2532"><span class="msubsup" id="MathJax-Span-2533"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2534" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-2535" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-168">x_1</script>，这种情况通常会将连接的三个结点构成一个三角形，如 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-169-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2536" style="width: 4.318em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.425em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.491em, 1003.42em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2537"><span class="mi" id="MathJax-Span-2538" style="font-family: MathJax_Math-italic;">t</span><span class="texatom" id="MathJax-Span-2539"><span class="mrow" id="MathJax-Span-2540"><span class="mo" id="MathJax-Span-2541"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 79%; font-style: normal; font-weight: normal;">、</span></span></span></span><span class="mi" id="MathJax-Span-2542" style="font-family: MathJax_Math-italic;">v</span><span class="texatom" id="MathJax-Span-2543"><span class="mrow" id="MathJax-Span-2544"><span class="mo" id="MathJax-Span-2545"><span style="font-family: STIXGeneral, &quot;Arial Unicode MS&quot;, serif; font-size: 79%; font-style: normal; font-weight: normal;">、</span></span></span></span><span class="msubsup" id="MathJax-Span-2546"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2547" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-2548" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-169">t、v、x_1</script> 三个结点；当 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-170-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2549" style="width: 3.971em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.127em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1003.08em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2550"><span class="msubsup" id="MathJax-Span-2551"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2552" style="font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.499em;"><span class="texatom" id="MathJax-Span-2553"><span class="mrow" id="MathJax-Span-2554"><span class="mi" id="MathJax-Span-2555" style="font-size: 70.7%; font-family: MathJax_Math-italic;">t</span><span class="mi" id="MathJax-Span-2556" style="font-size: 70.7%; font-family: MathJax_Math-italic;">x</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2557" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mn" id="MathJax-Span-2558" style="font-family: MathJax_Main; padding-left: 0.3em;">2</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-170">d_{tx}=2</script> 时，则下一节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-171-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2559" style="width: 0.747em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.55em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2560"><span class="mi" id="MathJax-Span-2561" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-171">x</script> 和 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-172-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2562" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.3em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2563"><span class="mi" id="MathJax-Span-2564" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-172">t</script> 不直接相连，比如当 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-173-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2565" style="width: 0.747em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.55em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2566"><span class="mi" id="MathJax-Span-2567" style="font-family: MathJax_Math-italic;">x</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-173">x</script> 为图中的 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-174-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2568" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2569"><span class="msubsup" id="MathJax-Span-2570"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2571" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-2572" style="font-size: 70.7%; font-family: MathJax_Main;">2</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-174">x_2</script> 或者 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-175-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2573" style="width: 1.292em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1001em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2574"><span class="msubsup" id="MathJax-Span-2575"><span style="display: inline-block; position: relative; width: 0.995em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.55em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2576" style="font-family: MathJax_Math-italic;">x</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.598em;"><span class="mn" id="MathJax-Span-2577" style="font-size: 70.7%; font-family: MathJax_Main;">3</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 0.878em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-175">x_3</script> 时。</p><p>上式利用参数 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-176-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2578" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.5em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2579"><span class="mi" id="MathJax-Span-2580" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-176">p</script> 和 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-177-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2581" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.45em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2582"><span class="mi" id="MathJax-Span-2583" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-177">q</script> 共同控制着随机游走的倾向性，来选择 BFS 还是 DFS，从而控制对结构性或同质性网络关系的学习。</p><p>参数 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-178-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2584" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.5em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2585"><span class="mi" id="MathJax-Span-2586" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-178">p</script> 被称为<strong>返回参数（return parameter）</strong>，控制跳回到前序节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-179-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2587" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.3em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2588"><span class="mi" id="MathJax-Span-2589" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-179">t</script> 的概率，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-180-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2590" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.5em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2591"><span class="mi" id="MathJax-Span-2592" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-180">p</script> 越小，随机游走回退到节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-181-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2593" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.3em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2594"><span class="mi" id="MathJax-Span-2595" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-181">t</script> 的可能性越大，如果 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-182-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2596" style="width: 7.195em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.707em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1005.61em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2597"><span class="mi" id="MathJax-Span-2598" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-2599" style="font-family: MathJax_Main; padding-left: 0.3em;">&lt;</span><span class="mo" id="MathJax-Span-2600" style="font-family: MathJax_Main; padding-left: 0.3em;">min</span><span class="mo" id="MathJax-Span-2601" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2602" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-2603" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-2604" style="font-family: MathJax_Main; padding-left: 0.151em;">1</span><span class="mo" id="MathJax-Span-2605" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-182">p< \min(q, 1)</script>，则更倾向于搜索局部周边的节点，则产生的序列与宽度优先搜索（BFS）类似，更加擅长学习到网络的结构性；相反，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-183-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2606" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.5em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2607"><span class="mi" id="MathJax-Span-2608" style="font-family: MathJax_Math-italic;">p</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-183">p</script> 越大，游走越不会访问到之前的节点，如果 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-184-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2609" style="width: 7.443em; display: inline-block;"><span style="display: inline-block; position: relative; width: 5.905em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.54em, 1005.81em, 2.83em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2610"><span class="mi" id="MathJax-Span-2611" style="font-family: MathJax_Math-italic;">p</span><span class="mo" id="MathJax-Span-2612" style="font-family: MathJax_Main; padding-left: 0.3em;">&gt;</span><span class="mo" id="MathJax-Span-2613" style="font-family: MathJax_Main; padding-left: 0.3em;">max</span><span class="mo" id="MathJax-Span-2614" style="font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2615" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-2616" style="font-family: MathJax_Main;">,</span><span class="mn" id="MathJax-Span-2617" style="font-family: MathJax_Main; padding-left: 0.151em;">1</span><span class="mo" id="MathJax-Span-2618" style="font-family: MathJax_Main;">)</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.372em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-184">p>\max(q, 1)</script>，刚刚访问过的节点不太可能被重复访问，则更倾向于搜索更大范围，产生的序列与深度优先搜索（DFS）类似，更加擅长学习到网络的同质性。</p><p>参数 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-185-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2619" style="width: 0.598em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.45em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2620"><span class="mi" id="MathJax-Span-2621" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-185">q</script> 被称为<strong>进出参数（in-out parameter）</strong>，控制下一跳节点选择与 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-186-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2622" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.3em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2623"><span class="mi" id="MathJax-Span-2624" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-186">t</script> 不直接相连节点的概率，当 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-187-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2625" style="width: 2.979em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.334em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1002.28em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2626"><span class="mi" id="MathJax-Span-2627" style="font-family: MathJax_Math-italic;">q<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-2628" style="font-family: MathJax_Main; padding-left: 0.3em;">&gt;</span><span class="mn" id="MathJax-Span-2629" style="font-family: MathJax_Main; padding-left: 0.3em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-187">q > 1</script> 时，节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-188-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2630" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.5em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2631"><span class="mi" id="MathJax-Span-2632" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-188">v</script> 之后更倾向于访问前序节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-189-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2633" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.3em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2634"><span class="mi" id="MathJax-Span-2635" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-189">t</script> 的共同邻居，当前节点更可能在附近节点游走，产生的序列与宽度优先搜索（BFS）类似，更加擅长学习到网络的结构性；q &lt; 1 时，节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-190-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2636" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.5em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2637"><span class="mi" id="MathJax-Span-2638" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-190">v</script> 之后，更不倾向访问前序节点 t 的邻居，则随机游走到远方节点的可能性越大，产生的序列与深度优先搜索 (DFS) 类似，更加擅长学习到网络的同质性。</p><p>上面这种随机游走策略和当前节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-191-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2639" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.838em, 1000.5em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2640"><span class="mi" id="MathJax-Span-2641" style="font-family: MathJax_Math-italic;">v</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.691em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-191">v</script>，前序节点 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-192-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2642" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.3em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2643"><span class="mi" id="MathJax-Span-2644" style="font-family: MathJax_Math-italic;">t</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 0.941em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-192">t</script> 相关，其实是二阶马尔科夫。</p><p><u>一般来说，我们会从每个点开始游走 5~10 次，步长则根据点的数量 N 游走 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-193-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2645" style="width: 2.185em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.739em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.441em, 1001.74em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2646"><span class="msqrt" id="MathJax-Span-2647"><span style="display: inline-block; position: relative; width: 1.739em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.89em, 4.169em, -999.998em); top: -4.015em; left: 0.846em;"><span class="mrow" id="MathJax-Span-2648"><span class="mi" id="MathJax-Span-2649" style="font-family: MathJax_Math-italic;">N<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.89em, 3.921em, -999.998em); top: -4.561em; left: 0.846em;"><span style="display: inline-block; position: relative; width: 0.895em; height: 0px;"><span style="position: absolute; font-family: MathJax_Main; top: -4.015em; left: -0.097em;">−<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; font-family: MathJax_Main; top: -4.015em; left: 0.201em;">−<span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.078em, 1000.85em, 4.368em, -999.998em); top: -4.065em; left: 0em;"><span style="font-family: MathJax_Main;">√</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-193">\sqrt{N}</script> 步。</u><sup class="md-footnote"><a href="#dfref-footnote-9-1" name="ref-footnote-9-1">9</a></sup></p><p>Node2Vec 的算法流程：</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724111811.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724111811.png" alt=""></p><p>Node2Vec 所体现的网络的同质性和结构性在推荐系统中也是可以被很直观的解释的。<strong>同质性相同的物品很可能是同品类、同属性、或者经常被一同购买的物品</strong>，而<strong>结构性相同的物品则是各品类的爆款、各品类的最佳凑单商品等拥有类似趋势或者结构性属性的物品</strong>。毫无疑问，二者在推荐系统中都是非常重要的特征表达。由于 Node2Vec 的这种灵活性，以及发掘不同特征的能力，甚至可以把不同 Node2Vec 生成的 Embedding 融合共同输入后续深度学习网络，以保留物品的不同特征信息。</p><h3 id="EGES"><em>4.4.</em><span class="ez-toc-section" id="EGES">EGES</span></h3><p>📚 <a href="https://lumingdong.cn/go/k5dmh0" rel="nofollow,noindex noopener noreferrer" target="_blank">Billion-scale Commodity Embedding for E-commerce Recommendation in Alibaba</a></p><p>Graph Embedding 能够保留一些 CF 忽略了的复杂的高阶相似网络关系，但是它有一个致命的弱点，就是 “冷启动” 问题。如果单纯使用用户行为生成的物品相关图，固然可以生成物品的 Embedding，但是如果遇到新加入的物品，或者没有过多互动信息的长尾物品，推荐系统将出现严重的冷启动问题。<strong>为了使 “冷启动” 的商品获得 “合理” 的初始 Embedding，阿里团队通过引入了更多补充信息来丰富 Embedding 信息的来源，从而使没有历史行为记录的商品获得 Embedding。</strong></p><p>这便是 2018 年阿里公布的其在淘宝应用的 Embedding 方法 <strong>EGES（Enhanced Graph Embedding with Side Information）</strong>，其基本思想是在 DeepWalk 生成的 Graph Embedding 基础上引入 Side Information。</p><p><strong>Side Information，可以简单理解为用户或物品的相关属性信息，我们通常会称之为用户侧信息、物品侧信息</strong>，也有些地方译为边信息、辅助信息、补充信息等。</p><p><strong>在推荐系统中常用的特征源有：用户对物品的历史行为交互信息、发生交互的上下文环境信息、用户侧或者物品侧的属性信息、通过属性信息连接的拓扑结构延伸出的知识图谱信息。</strong></p><p>接下来我们简单分析一下这种方法背后的思想是什么。</p><p><strong>生成 Graph Embedding 的第一步是生成物品关系图，我们通常只是通过用户行为序列来生成物品关系图。其实我们也可以通过物品侧信息（Side Information）的相似性来建立物品之间的边，比如利用相同品牌、相同类别等信息，这样就可以生成基于内容物品关系图，有了这个物品关系图，自然可以在没有用户行为的情况下也能够学习到 Embedding，也一定程度上缓解了冷启动问题。</strong></p><p><u>基于这种物品侧属性信息生成的物品 Embedding 向量可以被称为 Side Information Embedding 向量，当然，根据使用的物品侧信息类别的不同，可以有多个 Side Information Embedding 向量。</u><sup class="md-footnote"><a href="#dfref-footnote-8-1" name="ref-footnote-8-1">8</a></sup>比如对于淘宝的商品，这些 Side Information 可以是类目、店铺、价格、品牌等等，其实就是物品在某一个方面的属性内容信息，叫 Side Information 确实也形象，<strong>Side Information 通常在排序阶段被广泛用作关键特征，但在召回阶段应用较少</strong>。</p><p><strong>GES 和 EGES 模型</strong></p><p>通过随机游走，我们可以得到 item 的游走序列，包括了之前有行为的 item 以及新加入的 item，每个 item 都对应一组 Side Information，也就意味着我们同时得到了 Side Information 序列，此时需要将 item 和 Side Information 一起加入 Skip-gram 模型进行训练学习，否则不在一个向量空间，做运算无意义。</p><p>因此，对于每个 item，最后除了会得到它对应的 item Embedding，还有有各个 Side Information 产生的 Embedding，那么如何融合一个物品的多个 Embedding 向量，使之形成物品最后的 Embedding 呢？最简单的方法是在深度神经网络中加入 average pooling 层将不同 Embedding 平均起来，用公式表示为：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-194-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-2650" style="width: 10.717em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.485em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.697em, 1008.49em, 3.772em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2651"><span class="msubsup" id="MathJax-Span-2652"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.89em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2653" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.846em;"><span class="mi" id="MathJax-Span-2654" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2655" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-2656" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 2.383em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(3.227em, 1000.45em, 4.169em, -999.998em); top: -4.71em; left: 50%; margin-left: -0.246em;"><span class="mn" id="MathJax-Span-2657" style="font-family: MathJax_Main;">1</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.227em, 1002.18em, 4.268em, -999.998em); top: -3.321em; left: 50%; margin-left: -1.138em;"><span class="mrow" id="MathJax-Span-2658"><span class="mi" id="MathJax-Span-2659" style="font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-2660" style="font-family: MathJax_Main; padding-left: 0.201em;">+</span><span class="mn" id="MathJax-Span-2661" style="font-family: MathJax_Main; padding-left: 0.201em;">1</span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1002.38em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 2.383em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="munderover" id="MathJax-Span-2662" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px;"><span style="position: absolute; clip: rect(2.929em, 1001.39em, 4.616em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-2663" style="font-family: MathJax_Size2; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.19em, 4.268em, -999.998em); top: -2.924em; left: 0.102em;"><span class="texatom" id="MathJax-Span-2664"><span class="mrow" id="MathJax-Span-2665"><span class="mi" id="MathJax-Span-2666" style="font-size: 70.7%; font-family: MathJax_Math-italic;">s</span><span class="mo" id="MathJax-Span-2667" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-2668" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.475em, 1000.4em, 4.169em, -999.998em); top: -5.156em; left: 0.499em;"><span class="mi" id="MathJax-Span-2669" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-2670" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.54em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2671" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.4em, 4.169em, -999.998em); top: -4.363em; left: 1.143em;"><span class="mi" id="MathJax-Span-2672" style="font-size: 70.7%; font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.4em, 4.169em, -999.998em); top: -3.867em; left: 0.945em;"><span class="mi" id="MathJax-Span-2673" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.559em; border-left: 0px solid; width: 0px; height: 3.628em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-194">H_v = \frac{1}{n+1} \sum_{s=0}^nW_v^s</script></p><p>其中，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-195-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2674" style="width: 1.59em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1001.24em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2675"><span class="msubsup" id="MathJax-Span-2676"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.89em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2677" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.846em;"><span class="mi" id="MathJax-Span-2678" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-195">H_v</script> 是 item v 的聚合 Embedding，我们使用 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-196-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2679" style="width: 1.342em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.044em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1001.04em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2680"><span class="mi" id="MathJax-Span-2681" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-196">W</script> 来表示 items 或者 Side Information 的 Embedding Matrix。特别的，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-197-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2682" style="width: 1.937em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.54em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.441em, 1001.54em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2683"><span class="msubsup" id="MathJax-Span-2684"><span style="display: inline-block; position: relative; width: 1.54em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2685" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.363em; left: 1.143em;"><span class="mn" id="MathJax-Span-2686" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.4em, 4.169em, -999.998em); top: -3.867em; left: 0.945em;"><span class="mi" id="MathJax-Span-2687" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-197">W_v^0</script> 表示 item v 的 Embedding，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-198-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2688" style="width: 2.086em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.639em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.441em, 1001.64em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2689"><span class="msubsup" id="MathJax-Span-2690"><span style="display: inline-block; position: relative; width: 1.639em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2691" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.375em, 1000.55em, 4.169em, -999.998em); top: -4.363em; left: 1.143em;"><span class="mi" id="MathJax-Span-2692" style="font-size: 70.7%; font-family: MathJax_Math-italic;">S<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.4em, 4.169em, -999.998em); top: -3.867em; left: 0.945em;"><span class="mi" id="MathJax-Span-2693" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-198">W_v^S</script> 表示绑定到 item v 上的第 s 个类型的 Side Information 的 Embedding。因此，对于 item v，使用 n 种类型的 Side Information，我们将有 n+1 个向量 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-199-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2694" style="width: 9.328em; display: inline-block;"><span style="display: inline-block; position: relative; width: 7.393em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.441em, 1007.39em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2695"><span class="msubsup" id="MathJax-Span-2696"><span style="display: inline-block; position: relative; width: 1.143em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.7em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2697" style="font-family: MathJax_Math-italic;">w</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.363em; left: 0.697em;"><span class="mn" id="MathJax-Span-2698" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.4em, 4.169em, -999.998em); top: -3.867em; left: 0.697em;"><span class="mi" id="MathJax-Span-2699" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2700" style="font-family: MathJax_Main;">,</span><span class="mo" id="MathJax-Span-2701" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="mo" id="MathJax-Span-2702" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="mo" id="MathJax-Span-2703" style="font-family: MathJax_Main; padding-left: 0.151em;">.</span><span class="mo" id="MathJax-Span-2704" style="font-family: MathJax_Main; padding-left: 0.151em;">,</span><span class="msubsup" id="MathJax-Span-2705" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.639em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2706" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.5em, 4.169em, -999.998em); top: -4.363em; left: 1.143em;"><span class="mi" id="MathJax-Span-2707" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.4em, 4.169em, -999.998em); top: -3.867em; left: 0.945em;"><span class="mi" id="MathJax-Span-2708" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2709" style="font-family: MathJax_Main; padding-left: 0.3em;">∈</span><span class="msubsup" id="MathJax-Span-2710" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2711" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.747em;"><span class="mi" id="MathJax-Span-2712" style="font-size: 70.7%; font-family: MathJax_Math-italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-199">w_v^0, ..., W_v^n \in R^d</script>，d 是 Embedding 的维度。注意，<strong>item Embeddings 和 Side Information Embeddings 的维度，经验上设置为相同的值。</strong></p><p>在论文中上述方法称为 GES（Graph Embedding With Side Information），<strong>通过这种简单的方法将 Side Information 加了进来，从而使具有相近 Side Information 的 item 可以在 Embedding 空间内更接近。这会使冷启动 item 的 Embedding 表征更加精准，同时因为内容属性的加入，丰富了向量表达，进一步提升了在线和离线的效果。</strong></p><p>阿里团队在上述方法的基础上，将平均进一步改为加权平均的方式，也就是最终的 EGES（增强型的 EGS，Enhance Graph Embedding With Side Information）方法，这样的改动也更加符合实际情况，因为不同类型的 Side Information 对最终的 Embedding 的贡献是不可能相等的。例如，一个购买了 IPhone 的用户，趋向于会浏览 Macbook 或者 Ipad，因为品牌都是”Apple”；而一个购买了多个不同品牌衣服的用户，出于便利和更低价格，还会在相同的淘宝店上继续购买。因此，<strong>不同类型的 Side Information 对于在用户行为中的共现 item 的贡献各不相同</strong>。</p><p>EGES 使用了一个加权平均层（weighted average layer）来结合不同的 Side Information，定义如下：</p><p><span class="MathJax_Preview" style=""></span><div class="MathJax_Display" style="text-align: center;"><span class="MathJax" id="MathJax-Element-200-Frame" tabindex="0" style="text-align: center;"><nobr><span class="math" id="MathJax-Span-2713" style="width: 10.27em; display: inline-block;"><span style="display: inline-block; position: relative; width: 8.137em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(0.35em, 1008.14em, 3.921em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2714"><span class="msubsup" id="MathJax-Span-2715"><span style="display: inline-block; position: relative; width: 1.243em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.89em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2716" style="font-family: MathJax_Math-italic;">H<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.846em;"><span class="mi" id="MathJax-Span-2717" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="mo" id="MathJax-Span-2718" style="font-family: MathJax_Main; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-2719" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 5.31em; height: 0px; margin-right: 0.102em; margin-left: 0.102em;"><span style="position: absolute; clip: rect(2.83em, 1005.16em, 4.616em, -999.998em); top: -4.908em; left: 50%; margin-left: -2.577em;"><span class="mrow" id="MathJax-Span-2720"><span class="munderover" id="MathJax-Span-2721"><span style="display: inline-block; position: relative; width: 2.334em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1001em, 4.417em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-2722" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.5em, 4.169em, -999.998em); top: -4.511em; left: 1.044em;"><span class="texatom" id="MathJax-Span-2723"><span class="mrow" id="MathJax-Span-2724"><span class="mi" id="MathJax-Span-2725" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.29em, 4.318em, -999.998em); top: -3.718em; left: 1.044em;"><span class="texatom" id="MathJax-Span-2726"><span class="mrow" id="MathJax-Span-2727"><span class="mi" id="MathJax-Span-2728" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-2729" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-2730" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-2731" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2732" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.449em;"><span class="texatom" id="MathJax-Span-2733"><span class="mrow" id="MathJax-Span-2734"><span class="msubsup" id="MathJax-Span-2735"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2736" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.25em, 4.268em, -999.998em); top: -4.363em; left: 0.399em;"><span class="mi" id="MathJax-Span-2737" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.673em, 1000.3em, 4.169em, -999.998em); top: -3.916em; left: 0.399em;"><span class="mi" id="MathJax-Span-2738" style="font-size: 50%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-2739"><span style="display: inline-block; position: relative; width: 1.491em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1001.04em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2740" style="font-family: MathJax_Math-italic;">W<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.102em;"></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.35em, 4.318em, -999.998em); top: -4.511em; left: 1.143em;"><span class="mi" id="MathJax-Span-2741" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.4em, 4.169em, -999.998em); top: -3.867em; left: 0.945em;"><span class="mi" id="MathJax-Span-2742" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(2.929em, 1003.67em, 4.616em, -999.998em); top: -3.073em; left: 50%; margin-left: -1.833em;"><span class="mrow" id="MathJax-Span-2743"><span class="munderover" id="MathJax-Span-2744"><span style="display: inline-block; position: relative; width: 2.334em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1001em, 4.417em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-2745" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.5em, 4.169em, -999.998em); top: -4.511em; left: 1.044em;"><span class="mi" id="MathJax-Span-2746" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.29em, 4.318em, -999.998em); top: -3.718em; left: 1.044em;"><span class="texatom" id="MathJax-Span-2747"><span class="mrow" id="MathJax-Span-2748"><span class="mi" id="MathJax-Span-2749" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-2750" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-2751" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-2752" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2753" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.313em; left: 0.449em;"><span class="texatom" id="MathJax-Span-2754"><span class="mrow" id="MathJax-Span-2755"><span class="msubsup" id="MathJax-Span-2756"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2757" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.25em, 4.268em, -999.998em); top: -4.363em; left: 0.399em;"><span class="mi" id="MathJax-Span-2758" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.673em, 1000.3em, 4.169em, -999.998em); top: -3.916em; left: 0.399em;"><span class="mi" id="MathJax-Span-2759" style="font-size: 50%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(0.846em, 1005.31em, 1.193em, -999.998em); top: -1.238em; left: 0em;"><span style="display: inline-block; overflow: hidden; vertical-align: 0em; border-top: 1.3px solid; width: 5.31em; height: 0px;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -1.747em; border-left: 0px solid; width: 0px; height: 4.253em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-200">H_v = \frac{\sum_{j=0}^{n} e^{a_v^j} W_v^j} {\sum_{j=0}^n e^{a_v^j}}</script></p><p>其中，设 v 是给定的一个 item，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-201-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2760" style="width: 7.889em; display: inline-block;"><span style="display: inline-block; position: relative; width: 6.252em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.391em, 1006.25em, 2.631em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2761"><span class="mi" id="MathJax-Span-2762" style="font-family: MathJax_Math-italic;">A</span><span class="mo" id="MathJax-Span-2763" style="font-family: MathJax_Main; padding-left: 0.3em;">∈</span><span class="msubsup" id="MathJax-Span-2764" style="padding-left: 0.3em;"><span style="display: inline-block; position: relative; width: 4.219em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2765" style="font-family: MathJax_Math-italic;">R</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.747em;"><span class="texatom" id="MathJax-Span-2766"><span class="mrow" id="MathJax-Span-2767"><span class="mo" id="MathJax-Span-2768" style="font-size: 70.7%; font-family: MathJax_Main;">∣</span><span class="mi" id="MathJax-Span-2769" style="font-size: 70.7%; font-family: MathJax_Math-italic;">V<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.151em;"></span></span><span class="mo" id="MathJax-Span-2770" style="font-size: 70.7%; font-family: MathJax_Main;">∣</span><span class="mo" id="MathJax-Span-2771" style="font-size: 70.7%; font-family: MathJax_Main;">×</span><span class="mo" id="MathJax-Span-2772" style="font-size: 70.7%; font-family: MathJax_Main;">(</span><span class="mi" id="MathJax-Span-2773" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span class="mo" id="MathJax-Span-2774" style="font-size: 70.7%; font-family: MathJax_Main;">+</span><span class="mn" id="MathJax-Span-2775" style="font-size: 70.7%; font-family: MathJax_Main;">1</span><span class="mo" id="MathJax-Span-2776" style="font-size: 70.7%; font-family: MathJax_Main;">)</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.122em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-201">A \in R^{\mid V \mid \times (n+1)}</script> 是权重矩阵（weight matrix），<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-202-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2777" style="width: 1.689em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.342em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1001.34em, 2.879em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2778"><span class="msubsup" id="MathJax-Span-2779"><span style="display: inline-block; position: relative; width: 1.342em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2780" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.747em;"><span class="texatom" id="MathJax-Span-2781"><span class="mrow" id="MathJax-Span-2782"><span class="mi" id="MathJax-Span-2783" style="font-size: 70.7%; font-family: MathJax_Math-italic;">i</span><span class="mi" id="MathJax-Span-2784" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.434em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-202">A_{ij}</script> 是第 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-203-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2785" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.3em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2786"><span class="mi" id="MathJax-Span-2787" style="font-family: MathJax_Math-italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-203">i</script> 个 item、第 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-204-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2788" style="width: 0.499em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.399em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.4em, 2.78em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2789"><span class="mi" id="MathJax-Span-2790" style="font-family: MathJax_Math-italic;">j</span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.309em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-204">j</script> 个类型 Side Information 的权重。注意，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-205-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2791" style="width: 1.937em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.54em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.59em, 1001.54em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2792"><span class="msubsup" id="MathJax-Span-2793"><span style="display: inline-block; position: relative; width: 1.54em; height: 0px;"><span style="position: absolute; clip: rect(3.177em, 1000.75em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2794" style="font-family: MathJax_Math-italic;">A</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -3.867em; left: 0.747em;"><span class="texatom" id="MathJax-Span-2795"><span class="mrow" id="MathJax-Span-2796"><span class="mo" id="MathJax-Span-2797" style="font-size: 70.7%; font-family: MathJax_Main;">∗</span><span class="mn" id="MathJax-Span-2798" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.253em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-205">A_{*0}</script>，即 A 的首列，表示 item v 的自身权限。出于简洁性，我们使用 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-206-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2799" style="width: 1.193em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.639em, 1000.95em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2800"><span class="msubsup" id="MathJax-Span-2801"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2802" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.4em, 4.169em, -999.998em); top: -4.363em; left: 0.548em;"><span class="mi" id="MathJax-Span-2803" style="font-size: 70.7%; font-family: MathJax_Math-italic;">s</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.4em, 4.169em, -999.998em); top: -3.867em; left: 0.548em;"><span class="mi" id="MathJax-Span-2804" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.191em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-206">a_v^s</script> 来表示关于第 v 个 item 的第 s 个类型的 Side Information 的权重，<span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-207-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2805" style="width: 1.193em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.441em, 1000.95em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2806"><span class="msubsup" id="MathJax-Span-2807"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2808" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.363em; left: 0.548em;"><span class="mn" id="MathJax-Span-2809" style="font-size: 70.7%; font-family: MathJax_Main;">0</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.4em, 4.169em, -999.998em); top: -3.867em; left: 0.548em;"><span class="mi" id="MathJax-Span-2810" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.378em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-207">a_v^0</script> 表示 item v 自身的权重。另外<strong>我们使用 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-208-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2811" style="width: 1.54em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.243em, 1001.19em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2812"><span class="msubsup" id="MathJax-Span-2813"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2814" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.449em;"><span class="texatom" id="MathJax-Span-2815"><span class="mrow" id="MathJax-Span-2816"><span class="msubsup" id="MathJax-Span-2817"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2818" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.25em, 4.268em, -999.998em); top: -4.363em; left: 0.399em;"><span class="mi" id="MathJax-Span-2819" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.673em, 1000.3em, 4.169em, -999.998em); top: -3.916em; left: 0.399em;"><span class="mi" id="MathJax-Span-2820" style="font-size: 50%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.441em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-208">e^{a_v^j}</script> 来替代 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-209-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2821" style="width: 1.193em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.342em, 1000.95em, 2.731em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2822"><span class="msubsup" id="MathJax-Span-2823"><span style="display: inline-block; position: relative; width: 0.945em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.5em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2824" style="font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1000.35em, 4.318em, -999.998em); top: -4.511em; left: 0.548em;"><span class="mi" id="MathJax-Span-2825" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.4em, 4.169em, -999.998em); top: -3.867em; left: 0.548em;"><span class="mi" id="MathJax-Span-2826" style="font-size: 70.7%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.247em; border-left: 0px solid; width: 0px; height: 1.503em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-209">a_v^j</script>，一是避免权重为 0，二是因为 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-210-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2827" style="width: 1.54em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.342em, 1001.19em, 2.582em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2828"><span class="msubsup" id="MathJax-Span-2829"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2830" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.449em;"><span class="texatom" id="MathJax-Span-2831"><span class="mrow" id="MathJax-Span-2832"><span class="msubsup" id="MathJax-Span-2833"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2834" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.263em; left: 0.399em;"><span class="mi" id="MathJax-Span-2835" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.059em; border-left: 0px solid; width: 0px; height: 1.316em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-210">e^{a^j}</script> 在梯度下降过程中有良好的数学性质。</strong>分母 <span class="MathJax_Preview" style=""></span><span class="MathJax" id="MathJax-Element-211-Frame" tabindex="0" style=""><nobr><span class="math" id="MathJax-Span-2836" style="width: 4.665em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.673em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.243em, 1003.67em, 3.028em, -999.998em); top: -2.428em; left: 0em;"><span class="mrow" id="MathJax-Span-2837"><span class="munderover" id="MathJax-Span-2838"><span style="display: inline-block; position: relative; width: 2.334em; height: 0px;"><span style="position: absolute; clip: rect(3.127em, 1001em, 4.417em, -999.998em); top: -4.015em; left: 0em;"><span class="mo" id="MathJax-Span-2839" style="font-family: MathJax_Size1; vertical-align: 0em;">∑</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.574em, 1000.5em, 4.169em, -999.998em); top: -4.511em; left: 1.044em;"><span class="mi" id="MathJax-Span-2840" style="font-size: 70.7%; font-family: MathJax_Math-italic;">n</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.425em, 1001.29em, 4.318em, -999.998em); top: -3.718em; left: 1.044em;"><span class="texatom" id="MathJax-Span-2841"><span class="mrow" id="MathJax-Span-2842"><span class="mi" id="MathJax-Span-2843" style="font-size: 70.7%; font-family: MathJax_Math-italic;">j</span><span class="mo" id="MathJax-Span-2844" style="font-size: 70.7%; font-family: MathJax_Main;">=</span><span class="mn" id="MathJax-Span-2845" style="font-size: 70.7%; font-family: MathJax_Main;">0</span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span><span class="msubsup" id="MathJax-Span-2846" style="padding-left: 0.151em;"><span style="display: inline-block; position: relative; width: 1.193em; height: 0px;"><span style="position: absolute; clip: rect(3.425em, 1000.45em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2847" style="font-family: MathJax_Math-italic;">e</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; top: -4.363em; left: 0.449em;"><span class="texatom" id="MathJax-Span-2848"><span class="mrow" id="MathJax-Span-2849"><span class="msubsup" id="MathJax-Span-2850"><span style="display: inline-block; position: relative; width: 0.647em; height: 0px;"><span style="position: absolute; clip: rect(3.574em, 1000.35em, 4.169em, -999.998em); top: -4.015em; left: 0em;"><span class="mi" id="MathJax-Span-2851" style="font-size: 70.7%; font-family: MathJax_Math-italic;">a</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.524em, 1000.25em, 4.268em, -999.998em); top: -4.363em; left: 0.399em;"><span class="mi" id="MathJax-Span-2852" style="font-size: 50%; font-family: MathJax_Math-italic;">j</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(3.673em, 1000.3em, 4.169em, -999.998em); top: -3.916em; left: 0.399em;"><span class="mi" id="MathJax-Span-2853" style="font-size: 50%; font-family: MathJax_Math-italic;">v</span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.433em;"></span></span></span><span style="display: inline-block; overflow: hidden; vertical-align: -0.622em; border-left: 0px solid; width: 0px; height: 2.003em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-211">\sum_{j=0}^n e^{a_v^j}</script> 被用于归一化不同类型 Side Information 的 Embeddings 的相关权重。</p><p><strong>EGES</strong> 的流程如下图：</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724103727.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724103727.png" alt=""></p><p>该模型将传统 Skip-gram 模型进行了改进，加入 Side Information 以及加权平均层，成为 Weighted Skip-gram 模型，其中：</p><ol start=""><li>SI 表示 Side Information，SI 0 表示 item 本身，剩下的 SI 1 ~ SI n 表示 item 对应的几种 Side Information；</li><li>Sparse Features 代表 item 和 Side Information 的 ID 信息，通常用 One-Hot 编码表示；</li><li>Dense Embeddings 表示 item 和 Side Information 的 Embedding 信息，并在 Hidden Representation 处进行加权平均聚合；</li><li>Sampled Softmax Classifier 表示使用负例采样的优化方式，N 代表采样的负样本，P 代表正样本（某个 item 周边上下 n 个 item 均为正样本，在模型中表示时不区分远近）。</li></ol><p>EGES 的算法流程：</p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724112053.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190724112053.png" alt=""></p><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184948.png" alt="" /></noscript><img class="lazyload aligncenter" src="data:image/svg+xml,%3Csvg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20%20%22%3E%3C/svg%3E" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190729184948.png" alt=""></p><p><strong>Side Information 带来的好处</strong></p><ol><li><p><strong>提升 Embedding 的表征力度</strong></p><p>Side Information 加入 Embedding 的训练，除了用到原本用户的行为信息，又加入了物品的内容属性信息，这样可以极大丰富 item Embedding 的表征力度，因为用户的偏好跟这些物品内容属性也可能有很大的关联。</p></li><li><p><strong>为解决 item 冷启动提供了便利</strong></p><p>新的 item 是没有用户交互信息的，因此也就无法训练 Embedding，没有 Embedding 也就无法有效推荐新物品，这是一个很棘手的问题。不过这个新 item 会有品牌、店铺、价格、类目等一系列内容属性信息，即 Side Information，Side information 都是有现成的训练好的 Embedding。因此，<strong>可以借用 Side Information 训练好的 Embedding 来解决 item 的冷启动问题，通常的做法是，根据 item 内容属性所关联的 Side Information，将这些 Side Information 对应的 Embedding 计算向量平均值，作为冷启动 item 的 Embedding 向量。</strong></p><p>下图是论文在获取到冷启动 item 的 Embedding 后，比较了与冷启动 item 的 Embedding 最相似的 Top 4 个物品，用来评估 Embedding 的质量。从结论来看，相似的 Embedding 确实有很多相似的 Side Information，这种冷启动方法效果还不错。</p></li></ol><p><noscript><img class="aligncenter" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190723162038.png" alt="" /></noscript><img class="aligncenter ls-is-cached lazyloaded" src="https://lumingdong.cn/wp-content/uploads/2019/07/20190723162038.png" data-src="https://lumingdong.cn/wp-content/uploads/2019/07/20190723162038.png" alt=""></p><h2 id="总结"><em>5.</em><span class="ez-toc-section" id="总结">总结</span></h2><p>文本首先深入介绍 Embedding 的相关内容，然后介绍了 Embedding 在推荐系统中几种常见的应用方法，其中，Word2Vec 可以直接作为文本解析工具来辅助完成一些基于内容的推荐，而 Item2Vec 则是 Word2Vec 在推荐系统领域的一个转化，也是最基本最常见的 Embedding 应用，Item2Vec 借助基于物品的协同过滤，得到 item 的向量化表征，从而使 item 方便获得更深层次的关联信息。最后，我们介绍了当下流行的 Graph Embedding，Graph Embedding 比 Item2Vec 能够获得更加高阶的相似和关联信息，其中 DeepWalk 使用随机游走的方式从 Graph 中获取到序列，LINE 方法则提出两种不同的相似度概念，并提出 BFS 和 DFS 的一些区别，Node2Vec 则进一步提出一种控制方案，可以通过控制游走方式呈现 BFS 还是 DFS 来平衡学习 “同质性” 和 “结构性” 的相似关系，最后我们介绍了阿里的 EGES，该方法引入了 Side Information 来缓解物品的冷启动，也通过加权平均将多种 Side Information Embedding 聚合成最终的 Embedding，使得最后的 Embedding 除了保留了用户行为序列中物品的共现性，还加入了 Side Information 中的内容关联信息，使得 item 的 Embedding 表征更加丰富。</p><h2 id="参考资料"><em>6.</em><span class="ez-toc-section" id="参考资料">参考资料</span></h2><div class="footnotes-area"><hr><div class="footnote-line"><span class="md-fn-count">1</span> <a href="https://lumingdong.cn/go/1gc03a" rel="nofollow,noindex noopener noreferrer" target="_blank">天雨粟. 理解 Word2Vec 之 Skip-Gram 模型. 知乎</a><a class="reversefootnote" title="回到文档" href="#ref-footnote-1" name="dfref-footnote-1">↩</a></div><div class="footnote-line"><span class="md-fn-count">2</span> <a href="https://lumingdong.cn/go/98z2z3" rel="nofollow,noindex noopener noreferrer" target="_blank">刘建平. word2vec 原理. cnblogs</a><a class="reversefootnote" title="回到文档" href="#ref-footnote-2" name="dfref-footnote-2">↩</a></div><div class="footnote-line"><span class="md-fn-count">3</span> <a href="https://lumingdong.cn/go/1e1uai" rel="nofollow,noindex noopener noreferrer" target="_blank">『延伸』工业界 Id 到 Embedding 主流方法是端到端学习还是预训练. 知乎</a><a class="reversefootnote" title="回到文档" href="#ref-footnote-3" name="dfref-footnote-3">↩</a></div><div class="footnote-line"><span class="md-fn-count">4</span> <a href="https://lumingdong.cn/go/o829np" rel="nofollow,noindex noopener noreferrer" target="_blank">『延伸』卢嘉颖. Item2vec 实践-MovieTaster-Open. Github</a><a class="reversefootnote" title="回到文档" href="#ref-footnote-4" name="dfref-footnote-4">↩</a></div><div class="footnote-line"><span class="md-fn-count">5</span> <a href="https://lumingdong.cn/go/736ry3" rel="nofollow,noindex noopener noreferrer" target="_blank">王喆. 万物皆 Embedding，从经典的 word2vec 到深度学习基本操作 item2vec. 知乎</a><a class="reversefootnote" title="回到文档" href="#ref-footnote-5" name="dfref-footnote-5">↩</a></div><div class="footnote-line"><span class="md-fn-count">6</span> <a href="https://lumingdong.cn/go/gscv4h" rel="nofollow,noindex noopener noreferrer" target="_blank">大海之中. Item2Vec 笔记. 51CTO</a><a class="reversefootnote" title="回到文档" href="#ref-footnote-6" name="dfref-footnote-6">↩</a></div><div class="footnote-line"><span class="md-fn-count">7</span> <a href="https://lumingdong.cn/go/ycv0mb" rel="nofollow,noindex noopener noreferrer" target="_blank">rongzijing. 词向量怎么评估好坏</a><a class="reversefootnote" title="回到文档" href="#ref-footnote-7" name="dfref-footnote-7">↩</a></div><div class="footnote-line"><span class="md-fn-count">8</span> <a href="https://lumingdong.cn/go/g6u9m3" rel="nofollow,noindex noopener noreferrer" target="_blank">王喆. 深度学习中不得不学的 Graph Embedding 方法. 知乎</a> <a class="reversefootnote" title="回到文档" href="#ref-footnote-8" name="dfref-footnote-8">↩</a><a class="reversefootnote" title="回到文档" href="#ref-footnote-8-1" name="dfref-footnote-8-1">↩</a></div><div class="footnote-line"><span class="md-fn-count">9</span> 黄昕等. 推荐系统与深度学习. 清华大学出版社<a class="reversefootnote" title="回到文档" href="#ref-footnote-9" name="dfref-footnote-9">↩</a><a class="reversefootnote" title="回到文档" href="#ref-footnote-9-1" name="dfref-footnote-9-1">↩</a></div><div class="footnote-line"><span class="md-fn-count">10</span> <a href="https://lumingdong.cn/go/4pzv3j" rel="nofollow,noindex noopener noreferrer" target="_blank">浅梦. LINE：算法原理，实现和应用. 知乎</a><a class="reversefootnote" title="回到文档" href="#ref-footnote-10" name="dfref-footnote-10">↩</a></div><div class="footnote-line"><span class="md-fn-count">11</span> <a href="https://lumingdong.cn/go/nzw186" rel="nofollow,noindex noopener noreferrer" target="_blank">王喆. 关于 Node2vec 算法中 Graph Embedding 同质性和结构性的进一步探讨. 知乎</a><a class="reversefootnote" title="回到文档" href="#ref-footnote-11" name="dfref-footnote-11">↩</a></div><div class="footnote-line"><span class="md-fn-count">12</span> <a href="https://lumingdong.cn/go/a2ruyq" rel="nofollow,noindex noopener noreferrer" target="_blank">王喆. Embedding 在深度推荐系统中的 3 大应用方向. 知乎</a><a class="reversefootnote" title="回到文档" href="#ref-footnote-12" name="dfref-footnote-12">↩</a></div></div><div style="border:1px dashed #ddd; padding:10px; margin:10px 0;line-height:26px;border-radius: 3px; "><div> © 除特别注明外，本站所有文章均为<a target="_blank" style="color:#086CA2" title="卢明冬的博客" href="https://lumingdong.cn">卢明冬的博客</a>原创 , 转载请注明作者和文章链接。<br>© 本文链接：<a target="_blank" style="color:#086CA2" href="https://lumingdong.cn/application-practice-of-embedding-in-recommendation-system.html" title="推荐系统的中 Embedding 的应用实践">https://lumingdong.cn/application-practice-of-embedding-in-recommendation-system.html</a></div><div></div></div><div class="reading-position-indicator-end"></div></div><div class="clearfix"></div><div class="post-share-view"><div class="post-meta"><div><i class="fa fa-eye"></i><span>5115 </span>Views</div><div class="post-tags"> <i class="fa fa-tags"></i> <a href="https://lumingdong.cn/tag/%e5%b7%a5%e7%a8%8b%e5%ae%9e%e8%b7%b5" rel="tag">工程实践</a> , <a href="https://lumingdong.cn/tag/%e8%ae%ba%e6%96%87%e8%a7%a3%e8%af%bb" rel="tag">论文解读</a></div></div></div><div class="clearfix"></div></div>



